import{an as Y0,ao as X0,ap as Z0,aq as e1,ar as t1,as as r1,at as qc,au as gr,av as Ef,aw as ce,ax as If,ay as Fo,az as i1,aA as xf,aB as Oc,aC as n1,aD as s1,aE as o1,aF as On,aG as a1,aH as Sf,aI as Hr,a6 as Pf,aa as c1}from"./index-1959a7a0.js";import{e as $r,$ as zc}from"./events-2846bd7b.js";function sr(s,t="utf8"){const r=Y0[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(s.buffer,s.byteOffset,s.byteLength).toString("utf8"):r.encoder.encode(s).substring(1)}var rl=globalThis&&globalThis.__spreadArray||function(s,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,h;n<a;n++)(h||!(n in t))&&(h||(h=Array.prototype.slice.call(t,0,n)),h[n]=t[n]);return s.concat(h||Array.prototype.slice.call(t))},u1=function(){function s(t,r,n){this.name=t,this.version=r,this.os=n,this.type="browser"}return s}(),h1=function(){function s(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return s}(),l1=function(){function s(t,r,n,a){this.name=t,this.version=r,this.os=n,this.bot=a,this.type="bot-device"}return s}(),f1=function(){function s(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return s}(),d1=function(){function s(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return s}(),p1=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,g1=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,il=3,y1=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",p1]],nl=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function m1(s){return s?sl(s):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new d1:typeof navigator<"u"?sl(navigator.userAgent):b1()}function v1(s){return s!==""&&y1.reduce(function(t,r){var n=r[0],a=r[1];if(t)return t;var h=a.exec(s);return!!h&&[n,h]},!1)}function sl(s){var t=v1(s);if(!t)return null;var r=t[0],n=t[1];if(r==="searchbot")return new f1;var a=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);a?a.length<il&&(a=rl(rl([],a,!0),_1(il-a.length),!0)):a=[];var h=a.join("."),f=w1(s),g=g1.exec(s);return g&&g[1]?new l1(r,h,f,g[1]):new u1(r,h,f)}function w1(s){for(var t=0,r=nl.length;t<r;t++){var n=nl[t],a=n[0],h=n[1],f=h.exec(s);if(f)return a}return null}function b1(){var s=typeof process<"u"&&process.version;return s?new h1(process.version.slice(1)):null}function _1(s){for(var t=[],r=0;r<s;r++)t.push("0");return t}const E1={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};var cs={};(function(s){const t=e1,r=t1,n=X0,a=Z0,h=C=>C==null,f=Symbol("encodeFragmentIdentifier");function g(C){switch(C.arrayFormat){case"index":return F=>(q,U)=>{const x=q.length;return U===void 0||C.skipNull&&U===null||C.skipEmptyString&&U===""?q:U===null?[...q,[_(F,C),"[",x,"]"].join("")]:[...q,[_(F,C),"[",_(x,C),"]=",_(U,C)].join("")]};case"bracket":return F=>(q,U)=>U===void 0||C.skipNull&&U===null||C.skipEmptyString&&U===""?q:U===null?[...q,[_(F,C),"[]"].join("")]:[...q,[_(F,C),"[]=",_(U,C)].join("")];case"colon-list-separator":return F=>(q,U)=>U===void 0||C.skipNull&&U===null||C.skipEmptyString&&U===""?q:U===null?[...q,[_(F,C),":list="].join("")]:[...q,[_(F,C),":list=",_(U,C)].join("")];case"comma":case"separator":case"bracket-separator":{const F=C.arrayFormat==="bracket-separator"?"[]=":"=";return q=>(U,x)=>x===void 0||C.skipNull&&x===null||C.skipEmptyString&&x===""?U:(x=x===null?"":x,U.length===0?[[_(q,C),F,_(x,C)].join("")]:[[U,_(x,C)].join(C.arrayFormatSeparator)])}default:return F=>(q,U)=>U===void 0||C.skipNull&&U===null||C.skipEmptyString&&U===""?q:U===null?[...q,_(F,C)]:[...q,[_(F,C),"=",_(U,C)].join("")]}}function b(C){let F;switch(C.arrayFormat){case"index":return(q,U,x)=>{if(F=/\[(\d*)\]$/.exec(q),q=q.replace(/\[\d*\]$/,""),!F){x[q]=U;return}x[q]===void 0&&(x[q]={}),x[q][F[1]]=U};case"bracket":return(q,U,x)=>{if(F=/(\[\])$/.exec(q),q=q.replace(/\[\]$/,""),!F){x[q]=U;return}if(x[q]===void 0){x[q]=[U];return}x[q]=[].concat(x[q],U)};case"colon-list-separator":return(q,U,x)=>{if(F=/(:list)$/.exec(q),q=q.replace(/:list$/,""),!F){x[q]=U;return}if(x[q]===void 0){x[q]=[U];return}x[q]=[].concat(x[q],U)};case"comma":case"separator":return(q,U,x)=>{const j=typeof U=="string"&&U.includes(C.arrayFormatSeparator),k=typeof U=="string"&&!j&&P(U,C).includes(C.arrayFormatSeparator);U=k?P(U,C):U;const ue=j||k?U.split(C.arrayFormatSeparator).map(ae=>P(ae,C)):U===null?U:P(U,C);x[q]=ue};case"bracket-separator":return(q,U,x)=>{const j=/(\[\])$/.test(q);if(q=q.replace(/\[\]$/,""),!j){x[q]=U&&P(U,C);return}const k=U===null?[]:U.split(C.arrayFormatSeparator).map(ue=>P(ue,C));if(x[q]===void 0){x[q]=k;return}x[q]=[].concat(x[q],k)};default:return(q,U,x)=>{if(x[q]===void 0){x[q]=U;return}x[q]=[].concat(x[q],U)}}}function y(C){if(typeof C!="string"||C.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function _(C,F){return F.encode?F.strict?t(C):encodeURIComponent(C):C}function P(C,F){return F.decode?r(C):C}function N(C){return Array.isArray(C)?C.sort():typeof C=="object"?N(Object.keys(C)).sort((F,q)=>Number(F)-Number(q)).map(F=>C[F]):C}function H(C){const F=C.indexOf("#");return F!==-1&&(C=C.slice(0,F)),C}function $(C){let F="";const q=C.indexOf("#");return q!==-1&&(F=C.slice(q)),F}function Q(C){C=H(C);const F=C.indexOf("?");return F===-1?"":C.slice(F+1)}function se(C,F){return F.parseNumbers&&!Number.isNaN(Number(C))&&typeof C=="string"&&C.trim()!==""?C=Number(C):F.parseBooleans&&C!==null&&(C.toLowerCase()==="true"||C.toLowerCase()==="false")&&(C=C.toLowerCase()==="true"),C}function le(C,F){F=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},F),y(F.arrayFormatSeparator);const q=b(F),U=Object.create(null);if(typeof C!="string"||(C=C.trim().replace(/^[?#&]/,""),!C))return U;for(const x of C.split("&")){if(x==="")continue;let[j,k]=n(F.decode?x.replace(/\+/g," "):x,"=");k=k===void 0?null:["comma","separator","bracket-separator"].includes(F.arrayFormat)?k:P(k,F),q(P(j,F),k,U)}for(const x of Object.keys(U)){const j=U[x];if(typeof j=="object"&&j!==null)for(const k of Object.keys(j))j[k]=se(j[k],F);else U[x]=se(j,F)}return F.sort===!1?U:(F.sort===!0?Object.keys(U).sort():Object.keys(U).sort(F.sort)).reduce((x,j)=>{const k=U[j];return k&&typeof k=="object"&&!Array.isArray(k)?x[j]=N(k):x[j]=k,x},Object.create(null))}s.extract=Q,s.parse=le,s.stringify=(C,F)=>{if(!C)return"";F=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},F),y(F.arrayFormatSeparator);const q=k=>F.skipNull&&h(C[k])||F.skipEmptyString&&C[k]==="",U=g(F),x={};for(const k of Object.keys(C))q(k)||(x[k]=C[k]);const j=Object.keys(x);return F.sort!==!1&&j.sort(F.sort),j.map(k=>{const ue=C[k];return ue===void 0?"":ue===null?_(k,F):Array.isArray(ue)?ue.length===0&&F.arrayFormat==="bracket-separator"?_(k,F)+"[]":ue.reduce(U(k),[]).join("&"):_(k,F)+"="+_(ue,F)}).filter(k=>k.length>0).join("&")},s.parseUrl=(C,F)=>{F=Object.assign({decode:!0},F);const[q,U]=n(C,"#");return Object.assign({url:q.split("?")[0]||"",query:le(Q(C),F)},F&&F.parseFragmentIdentifier&&U?{fragmentIdentifier:P(U,F)}:{})},s.stringifyUrl=(C,F)=>{F=Object.assign({encode:!0,strict:!0,[f]:!0},F);const q=H(C.url).split("?")[0]||"",U=s.extract(C.url),x=s.parse(U,{sort:!1}),j=Object.assign(x,C.query);let k=s.stringify(j,F);k&&(k=`?${k}`);let ue=$(C.url);return C.fragmentIdentifier&&(ue=`#${F[f]?_(C.fragmentIdentifier,F):C.fragmentIdentifier}`),`${q}${k}${ue}`},s.pick=(C,F,q)=>{q=Object.assign({parseFragmentIdentifier:!0,[f]:!1},q);const{url:U,query:x,fragmentIdentifier:j}=s.parseUrl(C,q);return s.stringifyUrl({url:U,query:a(x,F),fragmentIdentifier:j},q)},s.exclude=(C,F,q)=>{const U=Array.isArray(F)?x=>!F.includes(x):(x,j)=>!F(x,j);return s.pick(C,U,q)}})(cs);const I1=":";function x1(s){const[t,r]=s.split(I1);return{namespace:t,reference:r}}function S1(s,t=[]){const r=[];return Object.keys(s).forEach(n=>{if(t.length&&!t.includes(n))return;const a=s[n];r.push(...a.accounts)}),r}function Of(s,t){return s.includes(":")?[s]:t.chains||[]}const Af="base10",nr="base16",Ac="base64pad",kc="utf8",Rf=0,Yi=1,P1=0,ol=1,Rc=12,Hc=32;function O1(){const s=If.generateKeyPair();return{privateKey:sr(s.secretKey,nr),publicKey:sr(s.publicKey,nr)}}function Cc(){const s=Fo.randomBytes(Hc);return sr(s,nr)}function A1(s,t){const r=If.sharedKey(gr(s,nr),gr(t,nr),!0),n=new i1(qc.SHA256,r).expand(Hc);return sr(n,nr)}function R1(s){const t=qc.hash(gr(s,nr));return sr(t,nr)}function xn(s){const t=qc.hash(gr(s,kc));return sr(t,nr)}function C1(s){return gr(`${s}`,Af)}function hs(s){return Number(sr(s,Af))}function T1(s){const t=C1(typeof s.type<"u"?s.type:Rf);if(hs(t)===Yi&&typeof s.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof s.senderPublicKey<"u"?gr(s.senderPublicKey,nr):void 0,n=typeof s.iv<"u"?gr(s.iv,nr):Fo.randomBytes(Rc),a=new xf.ChaCha20Poly1305(gr(s.symKey,nr)).seal(n,gr(s.message,kc));return $1({type:t,sealed:a,iv:n,senderPublicKey:r})}function N1(s){const t=new xf.ChaCha20Poly1305(gr(s.symKey,nr)),{sealed:r,iv:n}=Co(s.encoded),a=t.open(n,r);if(a===null)throw new Error("Failed to decrypt");return sr(a,kc)}function $1(s){if(hs(s.type)===Yi){if(typeof s.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return sr(Oc([s.type,s.senderPublicKey,s.iv,s.sealed]),Ac)}return sr(Oc([s.type,s.iv,s.sealed]),Ac)}function Co(s){const t=gr(s,Ac),r=t.slice(P1,ol),n=ol;if(hs(r)===Yi){const g=n+Hc,b=g+Rc,y=t.slice(n,g),_=t.slice(g,b),P=t.slice(b);return{type:r,sealed:P,iv:_,senderPublicKey:y}}const a=n+Rc,h=t.slice(n,a),f=t.slice(a);return{type:r,sealed:f,iv:h}}function D1(s,t){const r=Co(s);return Cf({type:hs(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?sr(r.senderPublicKey,nr):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function Cf(s){const t=(s==null?void 0:s.type)||Rf;if(t===Yi){if(typeof(s==null?void 0:s.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(s==null?void 0:s.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:s==null?void 0:s.senderPublicKey,receiverPublicKey:s==null?void 0:s.receiverPublicKey}}function al(s){return s.type===Yi&&typeof s.senderPublicKey=="string"&&typeof s.receiverPublicKey=="string"}var F1=Object.defineProperty,cl=Object.getOwnPropertySymbols,L1=Object.prototype.hasOwnProperty,j1=Object.prototype.propertyIsEnumerable,ul=(s,t,r)=>t in s?F1(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,hl=(s,t)=>{for(var r in t||(t={}))L1.call(t,r)&&ul(s,r,t[r]);if(cl)for(var r of cl(t))j1.call(t,r)&&ul(s,r,t[r]);return s};const M1="ReactNative",Er={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},U1="js";function Bc(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function An(){return!n1()&&!!Ef()&&navigator.product===M1}function Rn(){return!Bc()&&!!Ef()}function ls(){return An()?Er.reactNative:Bc()?Er.node:Rn()?Er.browser:Er.unknown}function q1(){var s;try{return An()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(s=global.Application)==null?void 0:s.applicationId:void 0}catch{return}}function z1(s,t){let r=cs.parse(s);return r=hl(hl({},r),t),s=cs.stringify(r),s}function k1(){return r1()||{name:"",description:"",url:"",icons:[""]}}function H1(){if(ls()===Er.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const s=m1();if(s===null)return"unknown";const t=s.os?s.os.replace(" ","").toLowerCase():"unknown";return s.type==="browser"?[t,s.name,s.version].join("-"):[t,s.version].join("-")}function B1(){var s;const t=ls();return t===Er.browser?[t,((s=s1())==null?void 0:s.host)||"unknown"].join(":"):t}function K1(s,t,r){const n=H1(),a=B1();return[[s,t].join("-"),[U1,r].join("-"),n,a].join("/")}function V1({protocol:s,version:t,relayUrl:r,sdkVersion:n,auth:a,projectId:h,useOnCloseEvent:f,bundleId:g}){const b=r.split("?"),y=K1(s,t,n),_={auth:a,ua:y,projectId:h,useOnCloseEvent:f||void 0,origin:g||void 0},P=z1(b[1]||"",_);return b[0]+"?"+P}function Ji(s,t){return s.filter(r=>t.includes(r)).length===s.length}function Tf(s){return Object.fromEntries(s.entries())}function Nf(s){return new Map(Object.entries(s))}function En(s=ce.FIVE_MINUTES,t){const r=ce.toMiliseconds(s||ce.FIVE_MINUTES);let n,a,h;return{resolve:f=>{h&&n&&(clearTimeout(h),n(f))},reject:f=>{h&&a&&(clearTimeout(h),a(f))},done:()=>new Promise((f,g)=>{h=setTimeout(()=>{g(new Error(t))},r),n=f,a=g})}}function us(s,t,r){return new Promise(async(n,a)=>{const h=setTimeout(()=>a(new Error(r)),t);try{const f=await s;n(f)}catch(f){a(f)}clearTimeout(h)})}function $f(s,t){if(typeof t=="string"&&t.startsWith(`${s}:`))return t;if(s.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(s.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${s}`)}function G1(s){return $f("topic",s)}function W1(s){return $f("id",s)}function Df(s){const[t,r]=s.split(":"),n={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")n.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return n}function zr(s,t){return ce.fromMiliseconds((t||Date.now())+ce.toMiliseconds(s))}function Ri(s){return Date.now()>=ce.toMiliseconds(s)}function Dt(s,t){return`${s}${t?`:${t}`:""}`}function hc(s=[],t=[]){return[...new Set([...s,...t])]}async function J1({id:s,topic:t,wcDeepLink:r}){try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r;let a=n==null?void 0:n.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const h=`${a}/wc?requestId=${s}&sessionTopic=${t}`,f=ls();f===Er.browser?h.startsWith("https://")?window.open(h,"_blank","noreferrer noopener"):window.open(h,"_self","noreferrer noopener"):f===Er.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(h)}catch(n){console.error(n)}}async function Q1(s,t){try{return await s.getItem(t)||(Rn()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}const Y1="irn";function Tc(s){return(s==null?void 0:s.relay)||{protocol:Y1}}function Po(s){const t=E1[s];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${s}`);return t}var X1=Object.defineProperty,ll=Object.getOwnPropertySymbols,Z1=Object.prototype.hasOwnProperty,ew=Object.prototype.propertyIsEnumerable,fl=(s,t,r)=>t in s?X1(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,tw=(s,t)=>{for(var r in t||(t={}))Z1.call(t,r)&&fl(s,r,t[r]);if(ll)for(var r of ll(t))ew.call(t,r)&&fl(s,r,t[r]);return s};function rw(s,t="-"){const r={},n="relay"+t;return Object.keys(s).forEach(a=>{if(a.startsWith(n)){const h=a.replace(n,""),f=s[a];r[h]=f}}),r}function dl(s){s=s.includes("wc://")?s.replace("wc://",""):s,s=s.includes("wc:")?s.replace("wc:",""):s;const t=s.indexOf(":"),r=s.indexOf("?")!==-1?s.indexOf("?"):void 0,n=s.substring(0,t),a=s.substring(t+1,r).split("@"),h=typeof r<"u"?s.substring(r):"",f=cs.parse(h);return{protocol:n,topic:iw(a[0]),version:parseInt(a[1],10),symKey:f.symKey,relay:rw(f)}}function iw(s){return s.startsWith("//")?s.substring(2):s}function nw(s,t="-"){const r="relay",n={};return Object.keys(s).forEach(a=>{const h=r+t+a;s[a]&&(n[h]=s[a])}),n}function sw(s){return`${s.protocol}:${s.topic}@${s.version}?`+cs.stringify(tw({symKey:s.symKey},nw(s.relay)))}function Cn(s){const t=[];return s.forEach(r=>{const[n,a]=r.split(":");t.push(`${n}:${a}`)}),t}function ow(s){const t=[];return Object.values(s).forEach(r=>{t.push(...Cn(r.accounts))}),t}function aw(s,t){const r=[];return Object.values(s).forEach(n=>{Cn(n.accounts).includes(t)&&r.push(...n.methods)}),r}function cw(s,t){const r=[];return Object.values(s).forEach(n=>{Cn(n.accounts).includes(t)&&r.push(...n.events)}),r}function uw(s,t){const r=Oo(s,t);if(r)throw new Error(r.message);const n={};for(const[a,h]of Object.entries(s))n[a]={methods:h.methods,events:h.events,chains:h.accounts.map(f=>`${f.split(":")[0]}:${f.split(":")[1]}`)};return n}function Kc(s){return s.includes(":")}function ns(s){return Kc(s)?s.split(":")[0]:s}const hw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},lw={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Z(s,t){const{message:r,code:n}=lw[s];return{message:t?`${r} ${t}`:r,code:n}}function It(s,t){const{message:r,code:n}=hw[s];return{message:t?`${r} ${t}`:r,code:n}}function Xr(s,t){return Array.isArray(s)?typeof t<"u"&&s.length?s.every(t):!0:!1}function Sn(s){return Object.getPrototypeOf(s)===Object.prototype&&Object.keys(s).length}function ir(s){return typeof s>"u"}function kt(s,t){return t&&ir(s)?!0:typeof s=="string"&&!!s.trim().length}function Vc(s,t){return t&&ir(s)?!0:typeof s=="number"&&!isNaN(s)}function fw(s,t){const{requiredNamespaces:r}=t,n=Object.keys(s.namespaces),a=Object.keys(r);let h=!0;return Ji(a,n)?(n.forEach(f=>{const{accounts:g,methods:b,events:y}=s.namespaces[f],_=Cn(g),P=r[f];(!Ji(Of(f,P),_)||!Ji(P.methods,b)||!Ji(P.events,y))&&(h=!1)}),h):!1}function To(s){return kt(s,!1)&&s.includes(":")?s.split(":").length===2:!1}function dw(s){if(kt(s,!1)&&s.includes(":")){const t=s.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&To(r)}}return!1}function pw(s){if(kt(s,!1))try{return typeof new URL(s)<"u"}catch{return!1}return!1}function gw(s){var t;return(t=s==null?void 0:s.proposer)==null?void 0:t.publicKey}function yw(s){return s==null?void 0:s.topic}function mw(s,t){let r=null;return kt(s==null?void 0:s.publicKey,!1)||(r=Z("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function pl(s){let t=!0;return Xr(s)?s.length&&(t=s.every(r=>kt(r,!1))):t=!1,t}function vw(s,t,r){let n=null;return Xr(t)&&t.length?t.forEach(a=>{n||To(a)||(n=It("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):To(s)||(n=It("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function ww(s,t,r){let n=null;return Object.entries(s).forEach(([a,h])=>{if(n)return;const f=vw(a,Of(a,h),`${t} ${r}`);f&&(n=f)}),n}function bw(s,t){let r=null;return Xr(s)?s.forEach(n=>{r||dw(n)||(r=It("UNSUPPORTED_ACCOUNTS",`${t}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=It("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function _w(s,t){let r=null;return Object.values(s).forEach(n=>{if(r)return;const a=bw(n==null?void 0:n.accounts,`${t} namespace`);a&&(r=a)}),r}function Ew(s,t){let r=null;return pl(s==null?void 0:s.methods)?pl(s==null?void 0:s.events)||(r=It("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=It("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function Ff(s,t){let r=null;return Object.values(s).forEach(n=>{if(r)return;const a=Ew(n,`${t}, namespace`);a&&(r=a)}),r}function Iw(s,t,r){let n=null;if(s&&Sn(s)){const a=Ff(s,t);a&&(n=a);const h=ww(s,t,r);h&&(n=h)}else n=Z("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return n}function Oo(s,t){let r=null;if(s&&Sn(s)){const n=Ff(s,t);n&&(r=n);const a=_w(s,t);a&&(r=a)}else r=Z("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function Lf(s){return kt(s.protocol,!0)}function xw(s,t){let r=!1;return t&&!s?r=!0:s&&Xr(s)&&s.length&&s.forEach(n=>{r=Lf(n)}),r}function Sw(s){return typeof s=="number"}function pr(s){return typeof s<"u"&&typeof s!==null}function Pw(s){return!(!s||typeof s!="object"||!s.code||!Vc(s.code,!1)||!s.message||!kt(s.message,!1))}function Ow(s){return!(ir(s)||!kt(s.method,!1))}function Aw(s){return!(ir(s)||ir(s.result)&&ir(s.error)||!Vc(s.id,!1)||!kt(s.jsonrpc,!1))}function Rw(s){return!(ir(s)||!kt(s.name,!1))}function gl(s,t){return!(!To(t)||!ow(s).includes(t))}function Cw(s,t,r){return kt(r,!1)?aw(s,t).includes(r):!1}function Tw(s,t,r){return kt(r,!1)?cw(s,t).includes(r):!1}function yl(s,t,r){let n=null;const a=Nw(s),h=$w(t),f=Object.keys(a),g=Object.keys(h),b=ml(Object.keys(s)),y=ml(Object.keys(t)),_=b.filter(P=>!y.includes(P));return _.length&&(n=Z("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${_.toString()}
      Received: ${Object.keys(t).toString()}`)),Ji(f,g)||(n=Z("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${f.toString()}
      Approved: ${g.toString()}`)),Object.keys(t).forEach(P=>{if(!P.includes(":")||n)return;const N=Cn(t[P].accounts);N.includes(P)||(n=Z("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${P}
        Required: ${P}
        Approved: ${N.toString()}`))}),f.forEach(P=>{n||(Ji(a[P].methods,h[P].methods)?Ji(a[P].events,h[P].events)||(n=Z("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${P}`)):n=Z("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${P}`))}),n}function Nw(s){const t={};return Object.keys(s).forEach(r=>{var n;r.includes(":")?t[r]=s[r]:(n=s[r].chains)==null||n.forEach(a=>{t[a]={methods:s[r].methods,events:s[r].events}})}),t}function ml(s){return[...new Set(s.map(t=>t.includes(":")?t.split(":")[0]:t))]}function $w(s){const t={};return Object.keys(s).forEach(r=>{if(r.includes(":"))t[r]=s[r];else{const n=Cn(s[r].accounts);n==null||n.forEach(a=>{t[a]={accounts:s[r].accounts.filter(h=>h.includes(`${a}:`)),methods:s[r].methods,events:s[r].events}})}}),t}function Dw(s,t){return Vc(s,!1)&&s<=t.max&&s>=t.min}function vl(){const s=ls();return new Promise(t=>{switch(s){case Er.browser:t(Fw());break;case Er.reactNative:t(Lw());break;case Er.node:t(jw());break;default:t(!0)}})}function Fw(){return Rn()&&(navigator==null?void 0:navigator.onLine)}async function Lw(){if(An()&&typeof global<"u"&&global!=null&&global.NetInfo){const s=await(global==null?void 0:global.NetInfo.fetch());return s==null?void 0:s.isConnected}return!0}function jw(){return!0}function Mw(s){switch(ls()){case Er.browser:Uw(s);break;case Er.reactNative:qw(s);break}}function Uw(s){!An()&&Rn()&&(window.addEventListener("online",()=>s(!0)),window.addEventListener("offline",()=>s(!1)))}function qw(s){An()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(t=>s(t==null?void 0:t.isConnected)))}const lc={};let bo=class{static get(t){return lc[t]}static set(t,r){lc[t]=r}static delete(t){delete lc[t]}};const zw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,kw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Hw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Bw(s,t){if(s==="__proto__"||s==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Kw(s);return}return t}function Kw(s){console.warn(`[destr] Dropping "${s}" key to prevent prototype pollution.`)}function _o(s,t={}){if(typeof s!="string")return s;const r=s.trim();if(s[0]==='"'&&s.at(-1)==='"'&&!s.includes("\\"))return r.slice(1,-1);if(r.length<=9){const n=r.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!Hw.test(s)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return s}try{if(zw.test(s)||kw.test(s)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(s,Bw)}return JSON.parse(s)}catch(n){if(t.strict)throw n;return s}}function Vw(s){return!s||typeof s.then!="function"?Promise.resolve(s):s}function zt(s,...t){try{return Vw(s(...t))}catch(r){return Promise.reject(r)}}function Gw(s){const t=typeof s;return s===null||t!=="object"&&t!=="function"}function Ww(s){const t=Object.getPrototypeOf(s);return!t||t.isPrototypeOf(Object)}function Ao(s){if(Gw(s))return String(s);if(Ww(s)||Array.isArray(s))return JSON.stringify(s);if(typeof s.toJSON=="function")return Ao(s.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function jf(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const Nc="base64:";function Jw(s){if(typeof s=="string")return s;jf();const t=Buffer.from(s).toString("base64");return Nc+t}function Qw(s){return typeof s!="string"||!s.startsWith(Nc)?s:(jf(),Buffer.from(s.slice(Nc.length),"base64"))}function dr(s){return s?s.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function Yw(...s){return dr(s.join(":"))}function Eo(s){return s=dr(s),s?s+":":""}const Xw="memory",Zw=()=>{const s=new Map;return{name:Xw,options:{},hasItem(t){return s.has(t)},getItem(t){return s.get(t)??null},getItemRaw(t){return s.get(t)??null},setItem(t,r){s.set(t,r)},setItemRaw(t,r){s.set(t,r)},removeItem(t){s.delete(t)},getKeys(){return Array.from(s.keys())},clear(){s.clear()},dispose(){s.clear()}}};function eb(s={}){const t={mounts:{"":s.driver||Zw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=y=>{for(const _ of t.mountpoints)if(y.startsWith(_))return{base:_,relativeKey:y.slice(_.length),driver:t.mounts[_]};return{base:"",relativeKey:y,driver:t.mounts[""]}},n=(y,_)=>t.mountpoints.filter(P=>P.startsWith(y)||_&&y.startsWith(P)).map(P=>({relativeBase:y.length>P.length?y.slice(P.length):void 0,mountpoint:P,driver:t.mounts[P]})),a=(y,_)=>{if(t.watching){_=dr(_);for(const P of t.watchListeners)P(y,_)}},h=async()=>{if(!t.watching){t.watching=!0;for(const y in t.mounts)t.unwatch[y]=await wl(t.mounts[y],a,y)}},f=async()=>{if(t.watching){for(const y in t.unwatch)await t.unwatch[y]();t.unwatch={},t.watching=!1}},g=(y,_,P)=>{const N=new Map,H=$=>{let Q=N.get($.base);return Q||(Q={driver:$.driver,base:$.base,items:[]},N.set($.base,Q)),Q};for(const $ of y){const Q=typeof $=="string",se=dr(Q?$:$.key),le=Q?void 0:$.value,C=Q||!$.options?_:{..._,...$.options},F=r(se);H(F).items.push({key:se,value:le,relativeKey:F.relativeKey,options:C})}return Promise.all([...N.values()].map($=>P($))).then($=>$.flat())},b={hasItem(y,_={}){y=dr(y);const{relativeKey:P,driver:N}=r(y);return zt(N.hasItem,P,_)},getItem(y,_={}){y=dr(y);const{relativeKey:P,driver:N}=r(y);return zt(N.getItem,P,_).then(H=>_o(H))},getItems(y,_){return g(y,_,P=>P.driver.getItems?zt(P.driver.getItems,P.items.map(N=>({key:N.relativeKey,options:N.options})),_).then(N=>N.map(H=>({key:Yw(P.base,H.key),value:_o(H.value)}))):Promise.all(P.items.map(N=>zt(P.driver.getItem,N.relativeKey,N.options).then(H=>({key:N.key,value:_o(H)})))))},getItemRaw(y,_={}){y=dr(y);const{relativeKey:P,driver:N}=r(y);return N.getItemRaw?zt(N.getItemRaw,P,_):zt(N.getItem,P,_).then(H=>Qw(H))},async setItem(y,_,P={}){if(_===void 0)return b.removeItem(y);y=dr(y);const{relativeKey:N,driver:H}=r(y);H.setItem&&(await zt(H.setItem,N,Ao(_),P),H.watch||a("update",y))},async setItems(y,_){await g(y,_,async P=>{P.driver.setItems&&await zt(P.driver.setItems,P.items.map(N=>({key:N.relativeKey,value:Ao(N.value),options:N.options})),_),P.driver.setItem&&await Promise.all(P.items.map(N=>zt(P.driver.setItem,N.relativeKey,Ao(N.value),N.options)))})},async setItemRaw(y,_,P={}){if(_===void 0)return b.removeItem(y,P);y=dr(y);const{relativeKey:N,driver:H}=r(y);if(H.setItemRaw)await zt(H.setItemRaw,N,_,P);else if(H.setItem)await zt(H.setItem,N,Jw(_),P);else return;H.watch||a("update",y)},async removeItem(y,_={}){typeof _=="boolean"&&(_={removeMeta:_}),y=dr(y);const{relativeKey:P,driver:N}=r(y);N.removeItem&&(await zt(N.removeItem,P,_),(_.removeMeta||_.removeMata)&&await zt(N.removeItem,P+"$",_),N.watch||a("remove",y))},async getMeta(y,_={}){typeof _=="boolean"&&(_={nativeOnly:_}),y=dr(y);const{relativeKey:P,driver:N}=r(y),H=Object.create(null);if(N.getMeta&&Object.assign(H,await zt(N.getMeta,P,_)),!_.nativeOnly){const $=await zt(N.getItem,P+"$",_).then(Q=>_o(Q));$&&typeof $=="object"&&(typeof $.atime=="string"&&($.atime=new Date($.atime)),typeof $.mtime=="string"&&($.mtime=new Date($.mtime)),Object.assign(H,$))}return H},setMeta(y,_,P={}){return this.setItem(y+"$",_,P)},removeMeta(y,_={}){return this.removeItem(y+"$",_)},async getKeys(y,_={}){y=Eo(y);const P=n(y,!0);let N=[];const H=[];for(const $ of P){const se=(await zt($.driver.getKeys,$.relativeBase,_)).map(le=>$.mountpoint+dr(le)).filter(le=>!N.some(C=>le.startsWith(C)));H.push(...se),N=[$.mountpoint,...N.filter(le=>!le.startsWith($.mountpoint))]}return y?H.filter($=>$.startsWith(y)&&!$.endsWith("$")):H.filter($=>!$.endsWith("$"))},async clear(y,_={}){y=Eo(y),await Promise.all(n(y,!1).map(async P=>{if(P.driver.clear)return zt(P.driver.clear,P.relativeBase,_);if(P.driver.removeItem){const N=await P.driver.getKeys(P.relativeBase||"",_);return Promise.all(N.map(H=>P.driver.removeItem(H,_)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(y=>bl(y)))},async watch(y){return await h(),t.watchListeners.push(y),async()=>{t.watchListeners=t.watchListeners.filter(_=>_!==y),t.watchListeners.length===0&&await f()}},async unwatch(){t.watchListeners=[],await f()},mount(y,_){if(y=Eo(y),y&&t.mounts[y])throw new Error(`already mounted at ${y}`);return y&&(t.mountpoints.push(y),t.mountpoints.sort((P,N)=>N.length-P.length)),t.mounts[y]=_,t.watching&&Promise.resolve(wl(_,a,y)).then(P=>{t.unwatch[y]=P}).catch(console.error),b},async unmount(y,_=!0){y=Eo(y),!(!y||!t.mounts[y])&&(t.watching&&y in t.unwatch&&(t.unwatch[y](),delete t.unwatch[y]),_&&await bl(t.mounts[y]),t.mountpoints=t.mountpoints.filter(P=>P!==y),delete t.mounts[y])},getMount(y=""){y=dr(y)+":";const _=r(y);return{driver:_.driver,base:_.base}},getMounts(y="",_={}){return y=dr(y),n(y,_.parents).map(N=>({driver:N.driver,base:N.mountpoint}))}};return b}function wl(s,t,r){return s.watch?s.watch((n,a)=>t(n,r+a)):()=>{}}async function bl(s){typeof s.dispose=="function"&&await zt(s.dispose)}function Xi(s){return new Promise((t,r)=>{s.oncomplete=s.onsuccess=()=>t(s.result),s.onabort=s.onerror=()=>r(s.error)})}function Mf(s,t){const r=indexedDB.open(s);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=Xi(r);return(a,h)=>n.then(f=>h(f.transaction(t,a).objectStore(t)))}let fc;function fs(){return fc||(fc=Mf("keyval-store","keyval")),fc}function _l(s,t=fs()){return t("readonly",r=>Xi(r.get(s)))}function tb(s,t,r=fs()){return r("readwrite",n=>(n.put(t,s),Xi(n.transaction)))}function rb(s,t=fs()){return t("readwrite",r=>(r.delete(s),Xi(r.transaction)))}function ib(s=fs()){return s("readwrite",t=>(t.clear(),Xi(t.transaction)))}function nb(s,t){return s.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Xi(s.transaction)}function sb(s=fs()){return s("readonly",t=>{if(t.getAllKeys)return Xi(t.getAllKeys());const r=[];return nb(t,n=>r.push(n.key)).then(()=>r)})}const ob=s=>JSON.stringify(s,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),ab=s=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=s.replace(t,'$1"$2n"$3');return JSON.parse(r,(n,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function ds(s){if(typeof s!="string")throw new Error(`Cannot safe json parse value of type ${typeof s}`);try{return ab(s)}catch{return s}}function Qi(s){return typeof s=="string"?s:ob(s)||""}const cb="idb-keyval";var ub=(s={})=>{const t=s.base&&s.base.length>0?`${s.base}:`:"",r=a=>t+a;let n;return s.dbName&&s.storeName&&(n=Mf(s.dbName,s.storeName)),{name:cb,options:s,async hasItem(a){return!(typeof await _l(r(a),n)>"u")},async getItem(a){return await _l(r(a),n)??null},setItem(a,h){return tb(r(a),h,n)},removeItem(a){return rb(r(a),n)},getKeys(){return sb(n)},clear(){return ib(n)}}};const hb="WALLET_CONNECT_V2_INDEXED_DB",lb="keyvaluestorage";let fb=class{constructor(){this.indexedDb=eb({driver:ub({dbName:hb,storeName:lb})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Qi(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var dc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ro={exports:{}};(function(){let s;function t(){}s=t,s.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},s.prototype.setItem=function(r,n){this[r]=String(n)},s.prototype.removeItem=function(r){delete this[r]},s.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},s.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},s.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof dc<"u"&&dc.localStorage?Ro.exports=dc.localStorage:typeof window<"u"&&window.localStorage?Ro.exports=window.localStorage:Ro.exports=new t})();function db(s){var t;return[s[0],ds((t=s[1])!=null?t:"")]}class pb{constructor(){this.localStorage=Ro.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(db)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return ds(r)}async setItem(t,r){this.localStorage.setItem(t,Qi(r))}async removeItem(t){this.localStorage.removeItem(t)}}const gb="wc_storage_version",El=1,yb=async(s,t,r)=>{const n=gb,a=await t.getItem(n);if(a&&a>=El){r(t);return}const h=await s.getKeys();if(!h.length){r(t);return}const f=[];for(;h.length;){const g=h.shift();if(!g)continue;const b=g.toLowerCase();if(b.includes("wc@")||b.includes("walletconnect")||b.includes("wc_")||b.includes("wallet_connect")){const y=await s.getItem(g);await t.setItem(g,y),f.push(g)}}await t.setItem(n,El),r(t),mb(s,f)},mb=async(s,t)=>{t.length&&t.forEach(async r=>{await s.removeItem(r)})};let vb=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new pb;this.storage=t;try{const r=new fb;yb(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var Tn={},Yn={},pc={},Xn={};let Zi=class{};const wb=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Zi},Symbol.toStringTag,{value:"Module"})),bb=o1(wb);var Il;function _b(){if(Il)return Xn;Il=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.IHeartBeat=void 0;const s=bb;class t extends s.IEvents{constructor(n){super()}}return Xn.IHeartBeat=t,Xn}var xl;function Uf(){return xl||(xl=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),On.__exportStar(_b(),s)}(pc)),pc}var gc={},Gi={},Sl;function Eb(){if(Sl)return Gi;Sl=1,Object.defineProperty(Gi,"__esModule",{value:!0}),Gi.HEARTBEAT_EVENTS=Gi.HEARTBEAT_INTERVAL=void 0;const s=ce;return Gi.HEARTBEAT_INTERVAL=s.FIVE_SECONDS,Gi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Gi}var Pl;function qf(){return Pl||(Pl=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),On.__exportStar(Eb(),s)}(gc)),gc}var Ol;function Ib(){if(Ol)return Yn;Ol=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.HeartBeat=void 0;const s=On,t=$r,r=ce,n=Uf(),a=qf();class h extends n.IHeartBeat{constructor(g){super(g),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||a.HEARTBEAT_INTERVAL}static init(g){return s.__awaiter(this,void 0,void 0,function*(){const b=new h(g);return yield b.init(),b})}init(){return s.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,b){this.events.on(g,b)}once(g,b){this.events.once(g,b)}off(g,b){this.events.off(g,b)}removeListener(g,b){this.events.removeListener(g,b)}initialize(){return s.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Yn.HeartBeat=h,Yn}(function(s){Object.defineProperty(s,"__esModule",{value:!0});const t=On;t.__exportStar(Ib(),s),t.__exportStar(Uf(),s),t.__exportStar(qf(),s)})(Tn);var Ce={},yc,Al;function xb(){if(Al)return yc;Al=1;function s(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}yc=t;function t(r,n,a){var h=a&&a.stringify||s,f=1;if(typeof r=="object"&&r!==null){var g=n.length+f;if(g===1)return r;var b=new Array(g);b[0]=h(r);for(var y=1;y<g;y++)b[y]=h(n[y]);return b.join(" ")}if(typeof r!="string")return r;var _=n.length;if(_===0)return r;for(var P="",N=1-f,H=-1,$=r&&r.length||0,Q=0;Q<$;){if(r.charCodeAt(Q)===37&&Q+1<$){switch(H=H>-1?H:0,r.charCodeAt(Q+1)){case 100:case 102:if(N>=_||n[N]==null)break;H<Q&&(P+=r.slice(H,Q)),P+=Number(n[N]),H=Q+2,Q++;break;case 105:if(N>=_||n[N]==null)break;H<Q&&(P+=r.slice(H,Q)),P+=Math.floor(Number(n[N])),H=Q+2,Q++;break;case 79:case 111:case 106:if(N>=_||n[N]===void 0)break;H<Q&&(P+=r.slice(H,Q));var se=typeof n[N];if(se==="string"){P+="'"+n[N]+"'",H=Q+2,Q++;break}if(se==="function"){P+=n[N].name||"<anonymous>",H=Q+2,Q++;break}P+=h(n[N]),H=Q+2,Q++;break;case 115:if(N>=_)break;H<Q&&(P+=r.slice(H,Q)),P+=String(n[N]),H=Q+2,Q++;break;case 37:H<Q&&(P+=r.slice(H,Q)),P+="%",H=Q+2,Q++,N--;break}++N}++Q}return H===-1?r:(H<$&&(P+=r.slice(H)),P)}return yc}var mc,Rl;function Sb(){if(Rl)return mc;Rl=1;const s=xb();mc=a;const t=U().console||{},r={mapHttpRequest:$,mapHttpResponse:$,wrapRequestSerializer:Q,wrapResponseSerializer:Q,wrapErrorSerializer:Q,req:$,res:$,err:N};function n(x,j){return Array.isArray(x)?x.filter(function(ue){return ue!=="!stdSerializers.err"}):x===!0?Object.keys(j):!1}function a(x){x=x||{},x.browser=x.browser||{};const j=x.browser.transmit;if(j&&typeof j.send!="function")throw Error("pino: transmit option must have a send function");const k=x.browser.write||t;x.browser.write&&(x.browser.asObject=!0);const ue=x.serializers||{},ae=n(x.browser.serialize,ue);let ge=x.browser.serialize;Array.isArray(x.browser.serialize)&&x.browser.serialize.indexOf("!stdSerializers.err")>-1&&(ge=!1);const Te=["error","fatal","warn","info","debug","trace"];typeof k=="function"&&(k.error=k.fatal=k.warn=k.info=k.debug=k.trace=k),x.enabled===!1&&(x.level="silent");const qe=x.level||"info",v=Object.create(k);v.log||(v.log=se),Object.defineProperty(v,"levelVal",{get:re}),Object.defineProperty(v,"level",{get:pe,set:Y});const S={transmit:j,serialize:ae,asObject:x.browser.asObject,levels:Te,timestamp:H(x)};v.levels=a.levels,v.level=qe,v.setMaxListeners=v.getMaxListeners=v.emit=v.addListener=v.on=v.prependListener=v.once=v.prependOnceListener=v.removeListener=v.removeAllListeners=v.listeners=v.listenerCount=v.eventNames=v.write=v.flush=se,v.serializers=ue,v._serialize=ae,v._stdErrSerialize=ge,v.child=G,j&&(v._logEvent=P());function re(){return this.level==="silent"?1/0:this.levels.values[this.level]}function pe(){return this._level}function Y(J){if(J!=="silent"&&!this.levels.values[J])throw Error("unknown level "+J);this._level=J,h(S,v,"error","log"),h(S,v,"fatal","error"),h(S,v,"warn","error"),h(S,v,"info","log"),h(S,v,"debug","log"),h(S,v,"trace","log")}function G(J,X){if(!J)throw new Error("missing bindings for child Pino");X=X||{},ae&&J.serializers&&(X.serializers=J.serializers);const Je=X.serializers;if(ae&&Je){var He=Object.assign({},ue,Je),Br=x.browser.serialize===!0?Object.keys(He):ae;delete J.serializers,b([J],Br,He,this._stdErrSerialize)}function Ie(xt){this._childLevel=(xt._childLevel|0)+1,this.error=y(xt,J,"error"),this.fatal=y(xt,J,"fatal"),this.warn=y(xt,J,"warn"),this.info=y(xt,J,"info"),this.debug=y(xt,J,"debug"),this.trace=y(xt,J,"trace"),He&&(this.serializers=He,this._serialize=Br),j&&(this._logEvent=P([].concat(xt._logEvent.bindings,J)))}return Ie.prototype=this,new Ie(this)}return v}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=r,a.stdTimeFunctions=Object.assign({},{nullTime:le,epochTime:C,unixTime:F,isoTime:q});function h(x,j,k,ue){const ae=Object.getPrototypeOf(j);j[k]=j.levelVal>j.levels.values[k]?se:ae[k]?ae[k]:t[k]||t[ue]||se,f(x,j,k)}function f(x,j,k){!x.transmit&&j[k]===se||(j[k]=function(ue){return function(){const ge=x.timestamp(),Te=new Array(arguments.length),qe=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var v=0;v<Te.length;v++)Te[v]=arguments[v];if(x.serialize&&!x.asObject&&b(Te,this._serialize,this.serializers,this._stdErrSerialize),x.asObject?ue.call(qe,g(this,k,Te,ge)):ue.apply(qe,Te),x.transmit){const S=x.transmit.level||j.level,re=a.levels.values[S],pe=a.levels.values[k];if(pe<re)return;_(this,{ts:ge,methodLevel:k,methodValue:pe,transmitLevel:S,transmitValue:a.levels.values[x.transmit.level||j.level],send:x.transmit.send,val:j.levelVal},Te)}}}(j[k]))}function g(x,j,k,ue){x._serialize&&b(k,x._serialize,x.serializers,x._stdErrSerialize);const ae=k.slice();let ge=ae[0];const Te={};ue&&(Te.time=ue),Te.level=a.levels.values[j];let qe=(x._childLevel|0)+1;if(qe<1&&(qe=1),ge!==null&&typeof ge=="object"){for(;qe--&&typeof ae[0]=="object";)Object.assign(Te,ae.shift());ge=ae.length?s(ae.shift(),ae):void 0}else typeof ge=="string"&&(ge=s(ae.shift(),ae));return ge!==void 0&&(Te.msg=ge),Te}function b(x,j,k,ue){for(const ae in x)if(ue&&x[ae]instanceof Error)x[ae]=a.stdSerializers.err(x[ae]);else if(typeof x[ae]=="object"&&!Array.isArray(x[ae]))for(const ge in x[ae])j&&j.indexOf(ge)>-1&&ge in k&&(x[ae][ge]=k[ge](x[ae][ge]))}function y(x,j,k){return function(){const ue=new Array(1+arguments.length);ue[0]=j;for(var ae=1;ae<ue.length;ae++)ue[ae]=arguments[ae-1];return x[k].apply(this,ue)}}function _(x,j,k){const ue=j.send,ae=j.ts,ge=j.methodLevel,Te=j.methodValue,qe=j.val,v=x._logEvent.bindings;b(k,x._serialize||Object.keys(x.serializers),x.serializers,x._stdErrSerialize===void 0?!0:x._stdErrSerialize),x._logEvent.ts=ae,x._logEvent.messages=k.filter(function(S){return v.indexOf(S)===-1}),x._logEvent.level.label=ge,x._logEvent.level.value=Te,ue(ge,x._logEvent,qe),x._logEvent=P(v)}function P(x){return{ts:0,messages:[],bindings:x||[],level:{label:"",value:0}}}function N(x){const j={type:x.constructor.name,msg:x.message,stack:x.stack};for(const k in x)j[k]===void 0&&(j[k]=x[k]);return j}function H(x){return typeof x.timestamp=="function"?x.timestamp:x.timestamp===!1?le:C}function $(){return{}}function Q(x){return x}function se(){}function le(){return!1}function C(){return Date.now()}function F(){return Math.round(Date.now()/1e3)}function q(){return new Date(Date.now()).toISOString()}function U(){function x(j){return typeof j<"u"&&j}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return x(self)||x(window)||x(this)||{}}}return mc}var Wi={},Cl;function zf(){return Cl||(Cl=1,Object.defineProperty(Wi,"__esModule",{value:!0}),Wi.PINO_CUSTOM_CONTEXT_KEY=Wi.PINO_LOGGER_DEFAULTS=void 0,Wi.PINO_LOGGER_DEFAULTS={level:"info"},Wi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Wi}var rr={},Tl;function Pb(){if(Tl)return rr;Tl=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.generateChildLogger=rr.formatChildLoggerContext=rr.getLoggerContext=rr.setBrowserLoggerContext=rr.getBrowserLoggerContext=rr.getDefaultLoggerOptions=void 0;const s=zf();function t(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||s.PINO_LOGGER_DEFAULTS.level})}rr.getDefaultLoggerOptions=t;function r(g,b=s.PINO_CUSTOM_CONTEXT_KEY){return g[b]||""}rr.getBrowserLoggerContext=r;function n(g,b,y=s.PINO_CUSTOM_CONTEXT_KEY){return g[y]=b,g}rr.setBrowserLoggerContext=n;function a(g,b=s.PINO_CUSTOM_CONTEXT_KEY){let y="";return typeof g.bindings>"u"?y=r(g,b):y=g.bindings().context||"",y}rr.getLoggerContext=a;function h(g,b,y=s.PINO_CUSTOM_CONTEXT_KEY){const _=a(g,y);return _.trim()?`${_}/${b}`:b}rr.formatChildLoggerContext=h;function f(g,b,y=s.PINO_CUSTOM_CONTEXT_KEY){const _=h(g,b,y),P=g.child({context:_});return n(P,_,y)}return rr.generateChildLogger=f,rr}(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.pino=void 0;const t=On,r=t.__importDefault(Sb());Object.defineProperty(s,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(zf(),s),t.__exportStar(Pb(),s)})(Ce);class Ob extends Zi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let Ab=class extends Zi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},Rb=class{constructor(t,r){this.logger=t,this.core=r}},Cb=class extends Zi{constructor(t,r){super(),this.relayer=t,this.logger=r}},Tb=class extends Zi{constructor(t){super()}},Nb=class{constructor(t,r,n,a){this.core=t,this.logger=r,this.name=n}};class $b extends Zi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let Db=class extends Zi{constructor(t,r){super(),this.core=t,this.logger=r}},Fb=class{constructor(t,r){this.projectId=t,this.logger=r}},Lb=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},jb=class{constructor(t){this.client=t}};var Gc={},kf={};(function(s){Object.defineProperty(s,"__esModule",{value:!0});var t=a1,r=Sf;s.DIGEST_LENGTH=64,s.BLOCK_SIZE=128;var n=function(){function g(){this.digestLength=s.DIGEST_LENGTH,this.blockSize=s.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},g.prototype.update=function(b,y){if(y===void 0&&(y=b.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var _=0;if(this._bytesHashed+=y,this._bufferLength>0){for(;this._bufferLength<s.BLOCK_SIZE&&y>0;)this._buffer[this._bufferLength++]=b[_++],y--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(y>=this.blockSize&&(_=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,b,_,y),y%=this.blockSize);y>0;)this._buffer[this._bufferLength++]=b[_++],y--;return this},g.prototype.finish=function(b){if(!this._finished){var y=this._bytesHashed,_=this._bufferLength,P=y/536870912|0,N=y<<3,H=y%128<112?128:256;this._buffer[_]=128;for(var $=_+1;$<H-8;$++)this._buffer[$]=0;t.writeUint32BE(P,this._buffer,H-8),t.writeUint32BE(N,this._buffer,H-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,H),this._finished=!0}for(var $=0;$<this.digestLength/8;$++)t.writeUint32BE(this._stateHi[$],b,$*8),t.writeUint32BE(this._stateLo[$],b,$*8+4);return this},g.prototype.digest=function(){var b=new Uint8Array(this.digestLength);return this.finish(b),b},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(b){return this._stateHi.set(b.stateHi),this._stateLo.set(b.stateLo),this._bufferLength=b.bufferLength,b.buffer&&this._buffer.set(b.buffer),this._bytesHashed=b.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(b){r.wipe(b.stateHi),r.wipe(b.stateLo),b.buffer&&r.wipe(b.buffer),b.bufferLength=0,b.bytesHashed=0},g}();s.SHA512=n;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(g,b,y,_,P,N,H){for(var $=y[0],Q=y[1],se=y[2],le=y[3],C=y[4],F=y[5],q=y[6],U=y[7],x=_[0],j=_[1],k=_[2],ue=_[3],ae=_[4],ge=_[5],Te=_[6],qe=_[7],v,S,re,pe,Y,G,J,X;H>=128;){for(var Je=0;Je<16;Je++){var He=8*Je+N;g[Je]=t.readUint32BE(P,He),b[Je]=t.readUint32BE(P,He+4)}for(var Je=0;Je<80;Je++){var Br=$,Ie=Q,xt=se,M=le,L=C,T=F,u=q,I=U,ne=x,ye=j,_e=k,Ne=ue,De=ae,Pe=ge,St=Te,vt=qe;if(v=U,S=qe,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=(C>>>14|ae<<32-14)^(C>>>18|ae<<32-18)^(ae>>>41-32|C<<32-(41-32)),S=(ae>>>14|C<<32-14)^(ae>>>18|C<<32-18)^(C>>>41-32|ae<<32-(41-32)),Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,v=C&F^~C&q,S=ae&ge^~ae&Te,Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,v=a[Je*2],S=a[Je*2+1],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,v=g[Je%16],S=b[Je%16],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,re=J&65535|X<<16,pe=Y&65535|G<<16,v=re,S=pe,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=($>>>28|x<<32-28)^(x>>>34-32|$<<32-(34-32))^(x>>>39-32|$<<32-(39-32)),S=(x>>>28|$<<32-28)^($>>>34-32|x<<32-(34-32))^($>>>39-32|x<<32-(39-32)),Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,v=$&Q^$&se^Q&se,S=x&j^x&k^j&k,Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,I=J&65535|X<<16,vt=Y&65535|G<<16,v=M,S=Ne,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=re,S=pe,Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,M=J&65535|X<<16,Ne=Y&65535|G<<16,Q=Br,se=Ie,le=xt,C=M,F=L,q=T,U=u,$=I,j=ne,k=ye,ue=_e,ae=Ne,ge=De,Te=Pe,qe=St,x=vt,Je%16===15)for(var He=0;He<16;He++)v=g[He],S=b[He],Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=g[(He+9)%16],S=b[(He+9)%16],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,re=g[(He+1)%16],pe=b[(He+1)%16],v=(re>>>1|pe<<32-1)^(re>>>8|pe<<32-8)^re>>>7,S=(pe>>>1|re<<32-1)^(pe>>>8|re<<32-8)^(pe>>>7|re<<32-7),Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,re=g[(He+14)%16],pe=b[(He+14)%16],v=(re>>>19|pe<<32-19)^(pe>>>61-32|re<<32-(61-32))^re>>>6,S=(pe>>>19|re<<32-19)^(re>>>61-32|pe<<32-(61-32))^(pe>>>6|re<<32-6),Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,g[He]=J&65535|X<<16,b[He]=Y&65535|G<<16}v=$,S=x,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=y[0],S=_[0],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,y[0]=$=J&65535|X<<16,_[0]=x=Y&65535|G<<16,v=Q,S=j,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=y[1],S=_[1],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,y[1]=Q=J&65535|X<<16,_[1]=j=Y&65535|G<<16,v=se,S=k,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=y[2],S=_[2],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,y[2]=se=J&65535|X<<16,_[2]=k=Y&65535|G<<16,v=le,S=ue,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=y[3],S=_[3],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,y[3]=le=J&65535|X<<16,_[3]=ue=Y&65535|G<<16,v=C,S=ae,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=y[4],S=_[4],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,y[4]=C=J&65535|X<<16,_[4]=ae=Y&65535|G<<16,v=F,S=ge,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=y[5],S=_[5],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,y[5]=F=J&65535|X<<16,_[5]=ge=Y&65535|G<<16,v=q,S=Te,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=y[6],S=_[6],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,y[6]=q=J&65535|X<<16,_[6]=Te=Y&65535|G<<16,v=U,S=qe,Y=S&65535,G=S>>>16,J=v&65535,X=v>>>16,v=y[7],S=_[7],Y+=S&65535,G+=S>>>16,J+=v&65535,X+=v>>>16,G+=Y>>>16,J+=G>>>16,X+=J>>>16,y[7]=U=J&65535|X<<16,_[7]=qe=Y&65535|G<<16,N+=128,H-=128}return N}function f(g){var b=new n;b.update(g);var y=b.digest();return b.clean(),y}s.hash=f})(kf);(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.convertSecretKeyToX25519=s.convertPublicKeyToX25519=s.verify=s.sign=s.extractPublicKeyFromSecretKey=s.generateKeyPair=s.generateKeyPairFromSeed=s.SEED_LENGTH=s.SECRET_KEY_LENGTH=s.PUBLIC_KEY_LENGTH=s.SIGNATURE_LENGTH=void 0;const t=Fo,r=kf,n=Sf;s.SIGNATURE_LENGTH=64,s.PUBLIC_KEY_LENGTH=32,s.SECRET_KEY_LENGTH=64,s.SEED_LENGTH=32;function a(M){const L=new Float64Array(16);if(M)for(let T=0;T<M.length;T++)L[T]=M[T];return L}const h=new Uint8Array(32);h[0]=9;const f=a(),g=a([1]),b=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),y=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),_=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),P=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function H(M,L){for(let T=0;T<16;T++)M[T]=L[T]|0}function $(M){let L=1;for(let T=0;T<16;T++){let u=M[T]+L+65535;L=Math.floor(u/65536),M[T]=u-L*65536}M[0]+=L-1+37*(L-1)}function Q(M,L,T){const u=~(T-1);for(let I=0;I<16;I++){const ne=u&(M[I]^L[I]);M[I]^=ne,L[I]^=ne}}function se(M,L){const T=a(),u=a();for(let I=0;I<16;I++)u[I]=L[I];$(u),$(u),$(u);for(let I=0;I<2;I++){T[0]=u[0]-65517;for(let ye=1;ye<15;ye++)T[ye]=u[ye]-65535-(T[ye-1]>>16&1),T[ye-1]&=65535;T[15]=u[15]-32767-(T[14]>>16&1);const ne=T[15]>>16&1;T[14]&=65535,Q(u,T,1-ne)}for(let I=0;I<16;I++)M[2*I]=u[I]&255,M[2*I+1]=u[I]>>8}function le(M,L){let T=0;for(let u=0;u<32;u++)T|=M[u]^L[u];return(1&T-1>>>8)-1}function C(M,L){const T=new Uint8Array(32),u=new Uint8Array(32);return se(T,M),se(u,L),le(T,u)}function F(M){const L=new Uint8Array(32);return se(L,M),L[0]&1}function q(M,L){for(let T=0;T<16;T++)M[T]=L[2*T]+(L[2*T+1]<<8);M[15]&=32767}function U(M,L,T){for(let u=0;u<16;u++)M[u]=L[u]+T[u]}function x(M,L,T){for(let u=0;u<16;u++)M[u]=L[u]-T[u]}function j(M,L,T){let u,I,ne=0,ye=0,_e=0,Ne=0,De=0,Pe=0,St=0,vt=0,ot=0,Le=0,Ye=0,Xe=0,at=0,ze=0,Ze=0,$e=0,Be=0,ht=0,Me=0,Pt=0,Ft=0,Ht=0,Bt=0,Mt=0,Qt=0,or=0,Kr=0,Yt=0,Zr=0,vi=0,$i=0,lt=T[0],rt=T[1],ft=T[2],dt=T[3],ct=T[4],it=T[5],Ot=T[6],At=T[7],pt=T[8],Rt=T[9],gt=T[10],wt=T[11],yt=T[12],Qe=T[13],Ct=T[14],Tt=T[15];u=L[0],ne+=u*lt,ye+=u*rt,_e+=u*ft,Ne+=u*dt,De+=u*ct,Pe+=u*it,St+=u*Ot,vt+=u*At,ot+=u*pt,Le+=u*Rt,Ye+=u*gt,Xe+=u*wt,at+=u*yt,ze+=u*Qe,Ze+=u*Ct,$e+=u*Tt,u=L[1],ye+=u*lt,_e+=u*rt,Ne+=u*ft,De+=u*dt,Pe+=u*ct,St+=u*it,vt+=u*Ot,ot+=u*At,Le+=u*pt,Ye+=u*Rt,Xe+=u*gt,at+=u*wt,ze+=u*yt,Ze+=u*Qe,$e+=u*Ct,Be+=u*Tt,u=L[2],_e+=u*lt,Ne+=u*rt,De+=u*ft,Pe+=u*dt,St+=u*ct,vt+=u*it,ot+=u*Ot,Le+=u*At,Ye+=u*pt,Xe+=u*Rt,at+=u*gt,ze+=u*wt,Ze+=u*yt,$e+=u*Qe,Be+=u*Ct,ht+=u*Tt,u=L[3],Ne+=u*lt,De+=u*rt,Pe+=u*ft,St+=u*dt,vt+=u*ct,ot+=u*it,Le+=u*Ot,Ye+=u*At,Xe+=u*pt,at+=u*Rt,ze+=u*gt,Ze+=u*wt,$e+=u*yt,Be+=u*Qe,ht+=u*Ct,Me+=u*Tt,u=L[4],De+=u*lt,Pe+=u*rt,St+=u*ft,vt+=u*dt,ot+=u*ct,Le+=u*it,Ye+=u*Ot,Xe+=u*At,at+=u*pt,ze+=u*Rt,Ze+=u*gt,$e+=u*wt,Be+=u*yt,ht+=u*Qe,Me+=u*Ct,Pt+=u*Tt,u=L[5],Pe+=u*lt,St+=u*rt,vt+=u*ft,ot+=u*dt,Le+=u*ct,Ye+=u*it,Xe+=u*Ot,at+=u*At,ze+=u*pt,Ze+=u*Rt,$e+=u*gt,Be+=u*wt,ht+=u*yt,Me+=u*Qe,Pt+=u*Ct,Ft+=u*Tt,u=L[6],St+=u*lt,vt+=u*rt,ot+=u*ft,Le+=u*dt,Ye+=u*ct,Xe+=u*it,at+=u*Ot,ze+=u*At,Ze+=u*pt,$e+=u*Rt,Be+=u*gt,ht+=u*wt,Me+=u*yt,Pt+=u*Qe,Ft+=u*Ct,Ht+=u*Tt,u=L[7],vt+=u*lt,ot+=u*rt,Le+=u*ft,Ye+=u*dt,Xe+=u*ct,at+=u*it,ze+=u*Ot,Ze+=u*At,$e+=u*pt,Be+=u*Rt,ht+=u*gt,Me+=u*wt,Pt+=u*yt,Ft+=u*Qe,Ht+=u*Ct,Bt+=u*Tt,u=L[8],ot+=u*lt,Le+=u*rt,Ye+=u*ft,Xe+=u*dt,at+=u*ct,ze+=u*it,Ze+=u*Ot,$e+=u*At,Be+=u*pt,ht+=u*Rt,Me+=u*gt,Pt+=u*wt,Ft+=u*yt,Ht+=u*Qe,Bt+=u*Ct,Mt+=u*Tt,u=L[9],Le+=u*lt,Ye+=u*rt,Xe+=u*ft,at+=u*dt,ze+=u*ct,Ze+=u*it,$e+=u*Ot,Be+=u*At,ht+=u*pt,Me+=u*Rt,Pt+=u*gt,Ft+=u*wt,Ht+=u*yt,Bt+=u*Qe,Mt+=u*Ct,Qt+=u*Tt,u=L[10],Ye+=u*lt,Xe+=u*rt,at+=u*ft,ze+=u*dt,Ze+=u*ct,$e+=u*it,Be+=u*Ot,ht+=u*At,Me+=u*pt,Pt+=u*Rt,Ft+=u*gt,Ht+=u*wt,Bt+=u*yt,Mt+=u*Qe,Qt+=u*Ct,or+=u*Tt,u=L[11],Xe+=u*lt,at+=u*rt,ze+=u*ft,Ze+=u*dt,$e+=u*ct,Be+=u*it,ht+=u*Ot,Me+=u*At,Pt+=u*pt,Ft+=u*Rt,Ht+=u*gt,Bt+=u*wt,Mt+=u*yt,Qt+=u*Qe,or+=u*Ct,Kr+=u*Tt,u=L[12],at+=u*lt,ze+=u*rt,Ze+=u*ft,$e+=u*dt,Be+=u*ct,ht+=u*it,Me+=u*Ot,Pt+=u*At,Ft+=u*pt,Ht+=u*Rt,Bt+=u*gt,Mt+=u*wt,Qt+=u*yt,or+=u*Qe,Kr+=u*Ct,Yt+=u*Tt,u=L[13],ze+=u*lt,Ze+=u*rt,$e+=u*ft,Be+=u*dt,ht+=u*ct,Me+=u*it,Pt+=u*Ot,Ft+=u*At,Ht+=u*pt,Bt+=u*Rt,Mt+=u*gt,Qt+=u*wt,or+=u*yt,Kr+=u*Qe,Yt+=u*Ct,Zr+=u*Tt,u=L[14],Ze+=u*lt,$e+=u*rt,Be+=u*ft,ht+=u*dt,Me+=u*ct,Pt+=u*it,Ft+=u*Ot,Ht+=u*At,Bt+=u*pt,Mt+=u*Rt,Qt+=u*gt,or+=u*wt,Kr+=u*yt,Yt+=u*Qe,Zr+=u*Ct,vi+=u*Tt,u=L[15],$e+=u*lt,Be+=u*rt,ht+=u*ft,Me+=u*dt,Pt+=u*ct,Ft+=u*it,Ht+=u*Ot,Bt+=u*At,Mt+=u*pt,Qt+=u*Rt,or+=u*gt,Kr+=u*wt,Yt+=u*yt,Zr+=u*Qe,vi+=u*Ct,$i+=u*Tt,ne+=38*Be,ye+=38*ht,_e+=38*Me,Ne+=38*Pt,De+=38*Ft,Pe+=38*Ht,St+=38*Bt,vt+=38*Mt,ot+=38*Qt,Le+=38*or,Ye+=38*Kr,Xe+=38*Yt,at+=38*Zr,ze+=38*vi,Ze+=38*$i,I=1,u=ne+I+65535,I=Math.floor(u/65536),ne=u-I*65536,u=ye+I+65535,I=Math.floor(u/65536),ye=u-I*65536,u=_e+I+65535,I=Math.floor(u/65536),_e=u-I*65536,u=Ne+I+65535,I=Math.floor(u/65536),Ne=u-I*65536,u=De+I+65535,I=Math.floor(u/65536),De=u-I*65536,u=Pe+I+65535,I=Math.floor(u/65536),Pe=u-I*65536,u=St+I+65535,I=Math.floor(u/65536),St=u-I*65536,u=vt+I+65535,I=Math.floor(u/65536),vt=u-I*65536,u=ot+I+65535,I=Math.floor(u/65536),ot=u-I*65536,u=Le+I+65535,I=Math.floor(u/65536),Le=u-I*65536,u=Ye+I+65535,I=Math.floor(u/65536),Ye=u-I*65536,u=Xe+I+65535,I=Math.floor(u/65536),Xe=u-I*65536,u=at+I+65535,I=Math.floor(u/65536),at=u-I*65536,u=ze+I+65535,I=Math.floor(u/65536),ze=u-I*65536,u=Ze+I+65535,I=Math.floor(u/65536),Ze=u-I*65536,u=$e+I+65535,I=Math.floor(u/65536),$e=u-I*65536,ne+=I-1+37*(I-1),I=1,u=ne+I+65535,I=Math.floor(u/65536),ne=u-I*65536,u=ye+I+65535,I=Math.floor(u/65536),ye=u-I*65536,u=_e+I+65535,I=Math.floor(u/65536),_e=u-I*65536,u=Ne+I+65535,I=Math.floor(u/65536),Ne=u-I*65536,u=De+I+65535,I=Math.floor(u/65536),De=u-I*65536,u=Pe+I+65535,I=Math.floor(u/65536),Pe=u-I*65536,u=St+I+65535,I=Math.floor(u/65536),St=u-I*65536,u=vt+I+65535,I=Math.floor(u/65536),vt=u-I*65536,u=ot+I+65535,I=Math.floor(u/65536),ot=u-I*65536,u=Le+I+65535,I=Math.floor(u/65536),Le=u-I*65536,u=Ye+I+65535,I=Math.floor(u/65536),Ye=u-I*65536,u=Xe+I+65535,I=Math.floor(u/65536),Xe=u-I*65536,u=at+I+65535,I=Math.floor(u/65536),at=u-I*65536,u=ze+I+65535,I=Math.floor(u/65536),ze=u-I*65536,u=Ze+I+65535,I=Math.floor(u/65536),Ze=u-I*65536,u=$e+I+65535,I=Math.floor(u/65536),$e=u-I*65536,ne+=I-1+37*(I-1),M[0]=ne,M[1]=ye,M[2]=_e,M[3]=Ne,M[4]=De,M[5]=Pe,M[6]=St,M[7]=vt,M[8]=ot,M[9]=Le,M[10]=Ye,M[11]=Xe,M[12]=at,M[13]=ze,M[14]=Ze,M[15]=$e}function k(M,L){j(M,L,L)}function ue(M,L){const T=a();let u;for(u=0;u<16;u++)T[u]=L[u];for(u=253;u>=0;u--)k(T,T),u!==2&&u!==4&&j(T,T,L);for(u=0;u<16;u++)M[u]=T[u]}function ae(M,L){const T=a();let u;for(u=0;u<16;u++)T[u]=L[u];for(u=250;u>=0;u--)k(T,T),u!==1&&j(T,T,L);for(u=0;u<16;u++)M[u]=T[u]}function ge(M,L){const T=a(),u=a(),I=a(),ne=a(),ye=a(),_e=a(),Ne=a(),De=a(),Pe=a();x(T,M[1],M[0]),x(Pe,L[1],L[0]),j(T,T,Pe),U(u,M[0],M[1]),U(Pe,L[0],L[1]),j(u,u,Pe),j(I,M[3],L[3]),j(I,I,y),j(ne,M[2],L[2]),U(ne,ne,ne),x(ye,u,T),x(_e,ne,I),U(Ne,ne,I),U(De,u,T),j(M[0],ye,_e),j(M[1],De,Ne),j(M[2],Ne,_e),j(M[3],ye,De)}function Te(M,L,T){for(let u=0;u<4;u++)Q(M[u],L[u],T)}function qe(M,L){const T=a(),u=a(),I=a();ue(I,L[2]),j(T,L[0],I),j(u,L[1],I),se(M,u),M[31]^=F(T)<<7}function v(M,L,T){H(M[0],f),H(M[1],g),H(M[2],g),H(M[3],f);for(let u=255;u>=0;--u){const I=T[u/8|0]>>(u&7)&1;Te(M,L,I),ge(L,M),ge(M,M),Te(M,L,I)}}function S(M,L){const T=[a(),a(),a(),a()];H(T[0],_),H(T[1],P),H(T[2],g),j(T[3],_,P),v(M,T,L)}function re(M){if(M.length!==s.SEED_LENGTH)throw new Error(`ed25519: seed must be ${s.SEED_LENGTH} bytes`);const L=(0,r.hash)(M);L[0]&=248,L[31]&=127,L[31]|=64;const T=new Uint8Array(32),u=[a(),a(),a(),a()];S(u,L),qe(T,u);const I=new Uint8Array(64);return I.set(M),I.set(T,32),{publicKey:T,secretKey:I}}s.generateKeyPairFromSeed=re;function pe(M){const L=(0,t.randomBytes)(32,M),T=re(L);return(0,n.wipe)(L),T}s.generateKeyPair=pe;function Y(M){if(M.length!==s.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${s.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(M.subarray(32))}s.extractPublicKeyFromSecretKey=Y;const G=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function J(M,L){let T,u,I,ne;for(u=63;u>=32;--u){for(T=0,I=u-32,ne=u-12;I<ne;++I)L[I]+=T-16*L[u]*G[I-(u-32)],T=Math.floor((L[I]+128)/256),L[I]-=T*256;L[I]+=T,L[u]=0}for(T=0,I=0;I<32;I++)L[I]+=T-(L[31]>>4)*G[I],T=L[I]>>8,L[I]&=255;for(I=0;I<32;I++)L[I]-=T*G[I];for(u=0;u<32;u++)L[u+1]+=L[u]>>8,M[u]=L[u]&255}function X(M){const L=new Float64Array(64);for(let T=0;T<64;T++)L[T]=M[T];for(let T=0;T<64;T++)M[T]=0;J(M,L)}function Je(M,L){const T=new Float64Array(64),u=[a(),a(),a(),a()],I=(0,r.hash)(M.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const ne=new Uint8Array(64);ne.set(I.subarray(32),32);const ye=new r.SHA512;ye.update(ne.subarray(32)),ye.update(L);const _e=ye.digest();ye.clean(),X(_e),S(u,_e),qe(ne,u),ye.reset(),ye.update(ne.subarray(0,32)),ye.update(M.subarray(32)),ye.update(L);const Ne=ye.digest();X(Ne);for(let De=0;De<32;De++)T[De]=_e[De];for(let De=0;De<32;De++)for(let Pe=0;Pe<32;Pe++)T[De+Pe]+=Ne[De]*I[Pe];return J(ne.subarray(32),T),ne}s.sign=Je;function He(M,L){const T=a(),u=a(),I=a(),ne=a(),ye=a(),_e=a(),Ne=a();return H(M[2],g),q(M[1],L),k(I,M[1]),j(ne,I,b),x(I,I,M[2]),U(ne,M[2],ne),k(ye,ne),k(_e,ye),j(Ne,_e,ye),j(T,Ne,I),j(T,T,ne),ae(T,T),j(T,T,I),j(T,T,ne),j(T,T,ne),j(M[0],T,ne),k(u,M[0]),j(u,u,ne),C(u,I)&&j(M[0],M[0],N),k(u,M[0]),j(u,u,ne),C(u,I)?-1:(F(M[0])===L[31]>>7&&x(M[0],f,M[0]),j(M[3],M[0],M[1]),0)}function Br(M,L,T){const u=new Uint8Array(32),I=[a(),a(),a(),a()],ne=[a(),a(),a(),a()];if(T.length!==s.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${s.SIGNATURE_LENGTH} bytes`);if(He(ne,M))return!1;const ye=new r.SHA512;ye.update(T.subarray(0,32)),ye.update(M),ye.update(L);const _e=ye.digest();return X(_e),v(I,ne,_e),S(ne,T.subarray(32)),ge(I,ne),qe(u,I),!le(T,u)}s.verify=Br;function Ie(M){let L=[a(),a(),a(),a()];if(He(L,M))throw new Error("Ed25519: invalid public key");let T=a(),u=a(),I=L[1];U(T,g,I),x(u,g,I),ue(u,u),j(T,T,u);let ne=new Uint8Array(32);return se(ne,T),ne}s.convertPublicKeyToX25519=Ie;function xt(M){const L=(0,r.hash)(M.subarray(0,32));L[0]&=248,L[31]&=127,L[31]|=64;const T=new Uint8Array(L.subarray(0,32));return(0,n.wipe)(L),T}s.convertSecretKeyToX25519=xt})(Gc);const Mb="EdDSA",Ub="JWT",Hf=".",Bf="base64url",qb="utf8",zb="utf8",kb=":",Hb="did",Bb="key",Nl="base58btc",Kb="z",Vb="K36",Gb=32;function No(s){return sr(gr(Qi(s),qb),Bf)}function Kf(s){const t=gr(Vb,Nl),r=Kb+sr(Oc([t,s]),Nl);return[Hb,Bb,r].join(kb)}function Wb(s){return sr(s,Bf)}function Jb(s){return gr([No(s.header),No(s.payload)].join(Hf),zb)}function Qb(s){return[No(s.header),No(s.payload),Wb(s.signature)].join(Hf)}function $l(s=Fo.randomBytes(Gb)){return Gc.generateKeyPairFromSeed(s)}async function Yb(s,t,r,n,a=ce.fromMiliseconds(Date.now())){const h={alg:Mb,typ:Ub},f=Kf(n.publicKey),g=a+r,b={iss:f,sub:s,aud:t,iat:a,exp:g},y=Jb({header:h,payload:b}),_=Gc.sign(n.secretKey,y);return Qb({header:h,payload:b,signature:_})}const Xb="PARSE_ERROR",Zb="INVALID_REQUEST",e_="METHOD_NOT_FOUND",t_="INVALID_PARAMS",Vf="INTERNAL_ERROR",Wc="SERVER_ERROR",r_=[-32700,-32600,-32601,-32602,-32603],as={[Xb]:{code:-32700,message:"Parse error"},[Zb]:{code:-32600,message:"Invalid Request"},[e_]:{code:-32601,message:"Method not found"},[t_]:{code:-32602,message:"Invalid params"},[Vf]:{code:-32603,message:"Internal error"},[Wc]:{code:-32e3,message:"Server error"}},Gf=Wc;function i_(s){return r_.includes(s)}function Dl(s){return Object.keys(as).includes(s)?as[s]:as[Gf]}function n_(s){const t=Object.values(as).find(r=>r.code===s);return t||as[Gf]}function Wf(s,t,r){return s.message.includes("getaddrinfo ENOTFOUND")||s.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):s}var Jf={},li={},Fl;function s_(){if(Fl)return li;Fl=1,Object.defineProperty(li,"__esModule",{value:!0}),li.isBrowserCryptoAvailable=li.getSubtleCrypto=li.getBrowerCrypto=void 0;function s(){return(Hr===null||Hr===void 0?void 0:Hr.crypto)||(Hr===null||Hr===void 0?void 0:Hr.msCrypto)||{}}li.getBrowerCrypto=s;function t(){const n=s();return n.subtle||n.webkitSubtle}li.getSubtleCrypto=t;function r(){return!!s()&&!!t()}return li.isBrowserCryptoAvailable=r,li}var fi={},Ll;function o_(){if(Ll)return fi;Ll=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.isBrowser=fi.isNode=fi.isReactNative=void 0;function s(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}fi.isReactNative=s;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}fi.isNode=t;function r(){return!s()&&!t()}return fi.isBrowser=r,fi}(function(s){Object.defineProperty(s,"__esModule",{value:!0});const t=On;t.__exportStar(s_(),s),t.__exportStar(o_(),s)})(Jf);function Jc(s=3){const t=Date.now()*Math.pow(10,s),r=Math.floor(Math.random()*Math.pow(10,s));return t+r}function Qf(s=6){return BigInt(Jc(s))}function Pn(s,t,r){return{id:r||Jc(),jsonrpc:"2.0",method:s,params:t}}function Qc(s,t){return{id:s,jsonrpc:"2.0",result:t}}function Lo(s,t,r){return{id:s,jsonrpc:"2.0",error:a_(t,r)}}function a_(s,t){return typeof s>"u"?Dl(Vf):(typeof s=="string"&&(s=Object.assign(Object.assign({},Dl(Wc)),{message:s})),typeof t<"u"&&(s.data=t),i_(s.code)&&(s=n_(s.code)),s)}class c_{}class u_ extends c_{constructor(){super()}}class h_ extends u_{constructor(t){super()}}const l_="^https?:",f_="^wss?:";function d_(s){const t=s.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function Yf(s,t){const r=d_(s);return typeof r>"u"?!1:new RegExp(t).test(r)}function jl(s){return Yf(s,l_)}function Ml(s){return Yf(s,f_)}function p_(s){return new RegExp("wss?://localhost(:d{2,5})?").test(s)}function Xf(s){return typeof s=="object"&&"id"in s&&"jsonrpc"in s&&s.jsonrpc==="2.0"}function Yc(s){return Xf(s)&&"method"in s}function jo(s){return Xf(s)&&(gi(s)||kr(s))}function gi(s){return"result"in s}function kr(s){return"error"in s}class yi extends h_{constructor(t){super(t),this.events=new $r.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Pn(t.method,t.params||[],t.id||Qf().toString()),r)}async requestStrict(t,r){return new Promise(async(n,a)=>{if(!this.connection.connected)try{await this.open()}catch(h){a(h)}this.events.on(`${t.id}`,h=>{kr(h)?a(h.error):n(h.result)});try{await this.connection.send(t,r)}catch(h){a(h)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),jo(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const g_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),y_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Ul=s=>s.split("?")[0],ql=10,m_=g_();let v_=class{constructor(t){if(this.url=t,this.events=new $r.EventEmitter,this.registering=!1,!Ml(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Qi(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Ml(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,a)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),a(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const a=new URLSearchParams(t).get("origin"),h=Jf.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!p_(t)},f=new m_(t,[],h);y_()?f.onerror=g=>{const b=g;n(this.emitError(b.error))}:f.on("error",g=>{n(this.emitError(g))}),f.onopen=()=>{this.onOpen(f),r(f)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?ds(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),a=n.message||n.toString(),h=Lo(t,a);this.events.emit("payload",h)}parseError(t,r=this.url){return Wf(t,Ul(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ql&&this.events.setMaxListeners(ql)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Ul(this.url)}`));return this.events.emit("register_error",r),r}};var $o={exports:{}};$o.exports;(function(s,t){var r=200,n="__lodash_hash_undefined__",a=1,h=2,f=9007199254740991,g="[object Arguments]",b="[object Array]",y="[object AsyncFunction]",_="[object Boolean]",P="[object Date]",N="[object Error]",H="[object Function]",$="[object GeneratorFunction]",Q="[object Map]",se="[object Number]",le="[object Null]",C="[object Object]",F="[object Promise]",q="[object Proxy]",U="[object RegExp]",x="[object Set]",j="[object String]",k="[object Symbol]",ue="[object Undefined]",ae="[object WeakMap]",ge="[object ArrayBuffer]",Te="[object DataView]",qe="[object Float32Array]",v="[object Float64Array]",S="[object Int8Array]",re="[object Int16Array]",pe="[object Int32Array]",Y="[object Uint8Array]",G="[object Uint8ClampedArray]",J="[object Uint16Array]",X="[object Uint32Array]",Je=/[\\^$.*+?()[\]{}|]/g,He=/^\[object .+?Constructor\]$/,Br=/^(?:0|[1-9]\d*)$/,Ie={};Ie[qe]=Ie[v]=Ie[S]=Ie[re]=Ie[pe]=Ie[Y]=Ie[G]=Ie[J]=Ie[X]=!0,Ie[g]=Ie[b]=Ie[ge]=Ie[_]=Ie[Te]=Ie[P]=Ie[N]=Ie[H]=Ie[Q]=Ie[se]=Ie[C]=Ie[U]=Ie[x]=Ie[j]=Ie[ae]=!1;var xt=typeof Hr=="object"&&Hr&&Hr.Object===Object&&Hr,M=typeof self=="object"&&self&&self.Object===Object&&self,L=xt||M||Function("return this")(),T=t&&!t.nodeType&&t,u=T&&!0&&s&&!s.nodeType&&s,I=u&&u.exports===T,ne=I&&xt.process,ye=function(){try{return ne&&ne.binding&&ne.binding("util")}catch{}}(),_e=ye&&ye.isTypedArray;function Ne(m,O){for(var V=-1,te=m==null?0:m.length,Ve=0,ve=[];++V<te;){var et=m[V];O(et,V,m)&&(ve[Ve++]=et)}return ve}function De(m,O){for(var V=-1,te=O.length,Ve=m.length;++V<te;)m[Ve+V]=O[V];return m}function Pe(m,O){for(var V=-1,te=m==null?0:m.length;++V<te;)if(O(m[V],V,m))return!0;return!1}function St(m,O){for(var V=-1,te=Array(m);++V<m;)te[V]=O(V);return te}function vt(m){return function(O){return m(O)}}function ot(m,O){return m.has(O)}function Le(m,O){return m==null?void 0:m[O]}function Ye(m){var O=-1,V=Array(m.size);return m.forEach(function(te,Ve){V[++O]=[Ve,te]}),V}function Xe(m,O){return function(V){return m(O(V))}}function at(m){var O=-1,V=Array(m.size);return m.forEach(function(te){V[++O]=te}),V}var ze=Array.prototype,Ze=Function.prototype,$e=Object.prototype,Be=L["__core-js_shared__"],ht=Ze.toString,Me=$e.hasOwnProperty,Pt=function(){var m=/[^.]+$/.exec(Be&&Be.keys&&Be.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),Ft=$e.toString,Ht=RegExp("^"+ht.call(Me).replace(Je,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bt=I?L.Buffer:void 0,Mt=L.Symbol,Qt=L.Uint8Array,or=$e.propertyIsEnumerable,Kr=ze.splice,Yt=Mt?Mt.toStringTag:void 0,Zr=Object.getOwnPropertySymbols,vi=Bt?Bt.isBuffer:void 0,$i=Xe(Object.keys,Object),lt=yr(L,"DataView"),rt=yr(L,"Map"),ft=yr(L,"Promise"),dt=yr(L,"Set"),ct=yr(L,"WeakMap"),it=yr(Object,"create"),Ot=ti(lt),At=ti(rt),pt=ti(ft),Rt=ti(dt),gt=ti(ct),wt=Mt?Mt.prototype:void 0,yt=wt?wt.valueOf:void 0;function Qe(m){var O=-1,V=m==null?0:m.length;for(this.clear();++O<V;){var te=m[O];this.set(te[0],te[1])}}function Ct(){this.__data__=it?it(null):{},this.size=0}function Tt(m){var O=this.has(m)&&delete this.__data__[m];return this.size-=O?1:0,O}function qo(m){var O=this.__data__;if(it){var V=O[m];return V===n?void 0:V}return Me.call(O,m)?O[m]:void 0}function zo(m){var O=this.__data__;return it?O[m]!==void 0:Me.call(O,m)}function ko(m,O){var V=this.__data__;return this.size+=this.has(m)?0:1,V[m]=it&&O===void 0?n:O,this}Qe.prototype.clear=Ct,Qe.prototype.delete=Tt,Qe.prototype.get=qo,Qe.prototype.has=zo,Qe.prototype.set=ko;function Ir(m){var O=-1,V=m==null?0:m.length;for(this.clear();++O<V;){var te=m[O];this.set(te[0],te[1])}}function Ho(){this.__data__=[],this.size=0}function Bo(m){var O=this.__data__,V=Di(O,m);if(V<0)return!1;var te=O.length-1;return V==te?O.pop():Kr.call(O,V,1),--this.size,!0}function Ko(m){var O=this.__data__,V=Di(O,m);return V<0?void 0:O[V][1]}function Vo(m){return Di(this.__data__,m)>-1}function Go(m,O){var V=this.__data__,te=Di(V,m);return te<0?(++this.size,V.push([m,O])):V[te][1]=O,this}Ir.prototype.clear=Ho,Ir.prototype.delete=Bo,Ir.prototype.get=Ko,Ir.prototype.has=Vo,Ir.prototype.set=Go;function ei(m){var O=-1,V=m==null?0:m.length;for(this.clear();++O<V;){var te=m[O];this.set(te[0],te[1])}}function tn(){this.size=0,this.__data__={hash:new Qe,map:new(rt||Ir),string:new Qe}}function Wo(m){var O=wi(this,m).delete(m);return this.size-=O?1:0,O}function rn(m){return wi(this,m).get(m)}function Jo(m){return wi(this,m).has(m)}function Qo(m,O){var V=wi(this,m),te=V.size;return V.set(m,O),this.size+=V.size==te?0:1,this}ei.prototype.clear=tn,ei.prototype.delete=Wo,ei.prototype.get=rn,ei.prototype.has=Jo,ei.prototype.set=Qo;function nn(m){var O=-1,V=m==null?0:m.length;for(this.__data__=new ei;++O<V;)this.add(m[O])}function gs(m){return this.__data__.set(m,n),this}function ys(m){return this.__data__.has(m)}nn.prototype.add=nn.prototype.push=gs,nn.prototype.has=ys;function Dr(m){var O=this.__data__=new Ir(m);this.size=O.size}function Yo(){this.__data__=new Ir,this.size=0}function Xo(m){var O=this.__data__,V=O.delete(m);return this.size=O.size,V}function Zo(m){return this.__data__.get(m)}function ea(m){return this.__data__.has(m)}function ms(m,O){var V=this.__data__;if(V instanceof Ir){var te=V.__data__;if(!rt||te.length<r-1)return te.push([m,O]),this.size=++V.size,this;V=this.__data__=new ei(te)}return V.set(m,O),this.size=V.size,this}Dr.prototype.clear=Yo,Dr.prototype.delete=Xo,Dr.prototype.get=Zo,Dr.prototype.has=ea,Dr.prototype.set=ms;function vs(m,O){var V=an(m),te=!V&&Cs(m),Ve=!V&&!te&&Dn(m),ve=!V&&!te&&!Ve&&$s(m),et=V||te||Ve||ve,Nt=et?St(m.length,String):[],Ae=Nt.length;for(var Ge in m)(O||Me.call(m,Ge))&&!(et&&(Ge=="length"||Ve&&(Ge=="offset"||Ge=="parent")||ve&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||Ss(Ge,Ae)))&&Nt.push(Ge);return Nt}function Di(m,O){for(var V=m.length;V--;)if(Rs(m[V][0],O))return V;return-1}function Nn(m,O,V){var te=O(m);return an(m)?te:De(te,V(m))}function Fi(m){return m==null?m===void 0?ue:le:Yt&&Yt in Object(m)?Is(m):ia(m)}function $n(m){return ji(m)&&Fi(m)==g}function Li(m,O,V,te,Ve){return m===O?!0:m==null||O==null||!ji(m)&&!ji(O)?m!==m&&O!==O:ws(m,O,V,te,Li,Ve)}function ws(m,O,V,te,Ve,ve){var et=an(m),Nt=an(O),Ae=et?b:Vr(m),Ge=Nt?b:Vr(O);Ae=Ae==g?C:Ae,Ge=Ge==g?C:Ge;var bt=Ae==C,ar=Ge==C,$t=Ae==Ge;if($t&&Dn(m)){if(!Dn(O))return!1;et=!0,bt=!1}if($t&&!bt)return ve||(ve=new Dr),et||$s(m)?sn(m,O,V,te,Ve,ve):ra(m,O,Ae,V,te,Ve,ve);if(!(V&a)){var tt=bt&&Me.call(m,"__wrapped__"),Xt=ar&&Me.call(O,"__wrapped__");if(tt||Xt){var Fr=tt?m.value():m,xr=Xt?O.value():O;return ve||(ve=new Dr),Ve(Fr,xr,V,te,ve)}}return $t?(ve||(ve=new Dr),Es(m,O,V,te,Ve,ve)):!1}function ta(m){if(!Ns(m)||Os(m))return!1;var O=cn(m)?Ht:He;return O.test(ti(m))}function bs(m){return ji(m)&&Ts(m.length)&&!!Ie[Fi(m)]}function _s(m){if(!As(m))return $i(m);var O=[];for(var V in Object(m))Me.call(m,V)&&V!="constructor"&&O.push(V);return O}function sn(m,O,V,te,Ve,ve){var et=V&a,Nt=m.length,Ae=O.length;if(Nt!=Ae&&!(et&&Ae>Nt))return!1;var Ge=ve.get(m);if(Ge&&ve.get(O))return Ge==O;var bt=-1,ar=!0,$t=V&h?new nn:void 0;for(ve.set(m,O),ve.set(O,m);++bt<Nt;){var tt=m[bt],Xt=O[bt];if(te)var Fr=et?te(Xt,tt,bt,O,m,ve):te(tt,Xt,bt,m,O,ve);if(Fr!==void 0){if(Fr)continue;ar=!1;break}if($t){if(!Pe(O,function(xr,Gr){if(!ot($t,Gr)&&(tt===xr||Ve(tt,xr,V,te,ve)))return $t.push(Gr)})){ar=!1;break}}else if(!(tt===Xt||Ve(tt,Xt,V,te,ve))){ar=!1;break}}return ve.delete(m),ve.delete(O),ar}function ra(m,O,V,te,Ve,ve,et){switch(V){case Te:if(m.byteLength!=O.byteLength||m.byteOffset!=O.byteOffset)return!1;m=m.buffer,O=O.buffer;case ge:return!(m.byteLength!=O.byteLength||!ve(new Qt(m),new Qt(O)));case _:case P:case se:return Rs(+m,+O);case N:return m.name==O.name&&m.message==O.message;case U:case j:return m==O+"";case Q:var Nt=Ye;case x:var Ae=te&a;if(Nt||(Nt=at),m.size!=O.size&&!Ae)return!1;var Ge=et.get(m);if(Ge)return Ge==O;te|=h,et.set(m,O);var bt=sn(Nt(m),Nt(O),te,Ve,ve,et);return et.delete(m),bt;case k:if(yt)return yt.call(m)==yt.call(O)}return!1}function Es(m,O,V,te,Ve,ve){var et=V&a,Nt=on(m),Ae=Nt.length,Ge=on(O),bt=Ge.length;if(Ae!=bt&&!et)return!1;for(var ar=Ae;ar--;){var $t=Nt[ar];if(!(et?$t in O:Me.call(O,$t)))return!1}var tt=ve.get(m);if(tt&&ve.get(O))return tt==O;var Xt=!0;ve.set(m,O),ve.set(O,m);for(var Fr=et;++ar<Ae;){$t=Nt[ar];var xr=m[$t],Gr=O[$t];if(te)var Fn=et?te(Gr,xr,$t,O,m,ve):te(xr,Gr,$t,m,O,ve);if(!(Fn===void 0?xr===Gr||Ve(xr,Gr,V,te,ve):Fn)){Xt=!1;break}Fr||(Fr=$t=="constructor")}if(Xt&&!Fr){var Mi=m.constructor,Ut=O.constructor;Mi!=Ut&&"constructor"in m&&"constructor"in O&&!(typeof Mi=="function"&&Mi instanceof Mi&&typeof Ut=="function"&&Ut instanceof Ut)&&(Xt=!1)}return ve.delete(m),ve.delete(O),Xt}function on(m){return Nn(m,oa,xs)}function wi(m,O){var V=m.__data__;return Ps(O)?V[typeof O=="string"?"string":"hash"]:V.map}function yr(m,O){var V=Le(m,O);return ta(V)?V:void 0}function Is(m){var O=Me.call(m,Yt),V=m[Yt];try{m[Yt]=void 0;var te=!0}catch{}var Ve=Ft.call(m);return te&&(O?m[Yt]=V:delete m[Yt]),Ve}var xs=Zr?function(m){return m==null?[]:(m=Object(m),Ne(Zr(m),function(O){return or.call(m,O)}))}:Ke,Vr=Fi;(lt&&Vr(new lt(new ArrayBuffer(1)))!=Te||rt&&Vr(new rt)!=Q||ft&&Vr(ft.resolve())!=F||dt&&Vr(new dt)!=x||ct&&Vr(new ct)!=ae)&&(Vr=function(m){var O=Fi(m),V=O==C?m.constructor:void 0,te=V?ti(V):"";if(te)switch(te){case Ot:return Te;case At:return Q;case pt:return F;case Rt:return x;case gt:return ae}return O});function Ss(m,O){return O=O??f,!!O&&(typeof m=="number"||Br.test(m))&&m>-1&&m%1==0&&m<O}function Ps(m){var O=typeof m;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?m!=="__proto__":m===null}function Os(m){return!!Pt&&Pt in m}function As(m){var O=m&&m.constructor,V=typeof O=="function"&&O.prototype||$e;return m===V}function ia(m){return Ft.call(m)}function ti(m){if(m!=null){try{return ht.call(m)}catch{}try{return m+""}catch{}}return""}function Rs(m,O){return m===O||m!==m&&O!==O}var Cs=$n(function(){return arguments}())?$n:function(m){return ji(m)&&Me.call(m,"callee")&&!or.call(m,"callee")},an=Array.isArray;function na(m){return m!=null&&Ts(m.length)&&!cn(m)}var Dn=vi||ke;function sa(m,O){return Li(m,O)}function cn(m){if(!Ns(m))return!1;var O=Fi(m);return O==H||O==$||O==y||O==q}function Ts(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=f}function Ns(m){var O=typeof m;return m!=null&&(O=="object"||O=="function")}function ji(m){return m!=null&&typeof m=="object"}var $s=_e?vt(_e):bs;function oa(m){return na(m)?vs(m):_s(m)}function Ke(){return[]}function ke(){return!1}s.exports=sa})($o,$o.exports);var w_=$o.exports;const b_=Pf(w_);function __(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var a=0;a<s.length;a++){var h=s.charAt(a),f=h.charCodeAt(0);if(r[f]!==255)throw new TypeError(h+" is ambiguous");r[f]=a}var g=s.length,b=s.charAt(0),y=Math.log(g)/Math.log(256),_=Math.log(256)/Math.log(g);function P($){if($ instanceof Uint8Array||(ArrayBuffer.isView($)?$=new Uint8Array($.buffer,$.byteOffset,$.byteLength):Array.isArray($)&&($=Uint8Array.from($))),!($ instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if($.length===0)return"";for(var Q=0,se=0,le=0,C=$.length;le!==C&&$[le]===0;)le++,Q++;for(var F=(C-le)*_+1>>>0,q=new Uint8Array(F);le!==C;){for(var U=$[le],x=0,j=F-1;(U!==0||x<se)&&j!==-1;j--,x++)U+=256*q[j]>>>0,q[j]=U%g>>>0,U=U/g>>>0;if(U!==0)throw new Error("Non-zero carry");se=x,le++}for(var k=F-se;k!==F&&q[k]===0;)k++;for(var ue=b.repeat(Q);k<F;++k)ue+=s.charAt(q[k]);return ue}function N($){if(typeof $!="string")throw new TypeError("Expected String");if($.length===0)return new Uint8Array;var Q=0;if($[Q]!==" "){for(var se=0,le=0;$[Q]===b;)se++,Q++;for(var C=($.length-Q)*y+1>>>0,F=new Uint8Array(C);$[Q];){var q=r[$.charCodeAt(Q)];if(q===255)return;for(var U=0,x=C-1;(q!==0||U<le)&&x!==-1;x--,U++)q+=g*F[x]>>>0,F[x]=q%256>>>0,q=q/256>>>0;if(q!==0)throw new Error("Non-zero carry");le=U,Q++}if($[Q]!==" "){for(var j=C-le;j!==C&&F[j]===0;)j++;for(var k=new Uint8Array(se+(C-j)),ue=se;j!==C;)k[ue++]=F[j++];return k}}}function H($){var Q=N($);if(Q)return Q;throw new Error(`Non-${t} character`)}return{encode:P,decodeUnsafe:N,decode:H}}var E_=__,I_=E_;const Zf=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},x_=s=>new TextEncoder().encode(s),S_=s=>new TextDecoder().decode(s);class P_{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class O_{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return ed(this,t)}}let A_=class{constructor(t){this.decoders=t}or(t){return ed(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const ed=(s,t)=>new A_({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});class R_{constructor(t,r,n,a){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=a,this.encoder=new P_(t,r,n),this.decoder=new O_(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Mo=({name:s,prefix:t,encode:r,decode:n})=>new R_(s,t,r,n),ps=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:a}=I_(r,t);return Mo({prefix:s,name:t,encode:n,decode:h=>Zf(a(h))})},C_=(s,t,r,n)=>{const a={};for(let _=0;_<t.length;++_)a[t[_]]=_;let h=s.length;for(;s[h-1]==="=";)--h;const f=new Uint8Array(h*r/8|0);let g=0,b=0,y=0;for(let _=0;_<h;++_){const P=a[s[_]];if(P===void 0)throw new SyntaxError(`Non-${n} character`);b=b<<r|P,g+=r,g>=8&&(g-=8,f[y++]=255&b>>g)}if(g>=r||255&b<<8-g)throw new SyntaxError("Unexpected end of data");return f},T_=(s,t,r)=>{const n=t[t.length-1]==="=",a=(1<<r)-1;let h="",f=0,g=0;for(let b=0;b<s.length;++b)for(g=g<<8|s[b],f+=8;f>r;)f-=r,h+=t[a&g>>f];if(f&&(h+=t[a&g<<r-f]),n)for(;h.length*r&7;)h+="=";return h},Vt=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>Mo({prefix:t,name:s,encode(a){return T_(a,n,r)},decode(a){return C_(a,n,r,s)}}),N_=Mo({prefix:"\0",name:"identity",encode:s=>S_(s),decode:s=>x_(s)});var $_=Object.freeze({__proto__:null,identity:N_});const D_=Vt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var F_=Object.freeze({__proto__:null,base2:D_});const L_=Vt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var j_=Object.freeze({__proto__:null,base8:L_});const M_=ps({prefix:"9",name:"base10",alphabet:"0123456789"});var U_=Object.freeze({__proto__:null,base10:M_});const q_=Vt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),z_=Vt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var k_=Object.freeze({__proto__:null,base16:q_,base16upper:z_});const H_=Vt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),B_=Vt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),K_=Vt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),V_=Vt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),G_=Vt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),W_=Vt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),J_=Vt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Q_=Vt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Y_=Vt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var X_=Object.freeze({__proto__:null,base32:H_,base32upper:B_,base32pad:K_,base32padupper:V_,base32hex:G_,base32hexupper:W_,base32hexpad:J_,base32hexpadupper:Q_,base32z:Y_});const Z_=ps({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),eE=ps({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var tE=Object.freeze({__proto__:null,base36:Z_,base36upper:eE});const rE=ps({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),iE=ps({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var nE=Object.freeze({__proto__:null,base58btc:rE,base58flickr:iE});const sE=Vt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),oE=Vt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),aE=Vt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),cE=Vt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var uE=Object.freeze({__proto__:null,base64:sE,base64pad:oE,base64url:aE,base64urlpad:cE});const td=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),hE=td.reduce((s,t,r)=>(s[r]=t,s),[]),lE=td.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function fE(s){return s.reduce((t,r)=>(t+=hE[r],t),"")}function dE(s){const t=[];for(const r of s){const n=lE[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const pE=Mo({prefix:"🚀",name:"base256emoji",encode:fE,decode:dE});var gE=Object.freeze({__proto__:null,base256emoji:pE}),yE=rd,zl=128,mE=127,vE=~mE,wE=Math.pow(2,31);function rd(s,t,r){t=t||[],r=r||0;for(var n=r;s>=wE;)t[r++]=s&255|zl,s/=128;for(;s&vE;)t[r++]=s&255|zl,s>>>=7;return t[r]=s|0,rd.bytes=r-n+1,t}var bE=$c,_E=128,kl=127;function $c(s,n){var r=0,n=n||0,a=0,h=n,f,g=s.length;do{if(h>=g)throw $c.bytes=0,new RangeError("Could not decode varint");f=s[h++],r+=a<28?(f&kl)<<a:(f&kl)*Math.pow(2,a),a+=7}while(f>=_E);return $c.bytes=h-n,r}var EE=Math.pow(2,7),IE=Math.pow(2,14),xE=Math.pow(2,21),SE=Math.pow(2,28),PE=Math.pow(2,35),OE=Math.pow(2,42),AE=Math.pow(2,49),RE=Math.pow(2,56),CE=Math.pow(2,63),TE=function(s){return s<EE?1:s<IE?2:s<xE?3:s<SE?4:s<PE?5:s<OE?6:s<AE?7:s<RE?8:s<CE?9:10},NE={encode:yE,decode:bE,encodingLength:TE},id=NE;const Hl=(s,t,r=0)=>(id.encode(s,t,r),t),Bl=s=>id.encodingLength(s),Dc=(s,t)=>{const r=t.byteLength,n=Bl(s),a=n+Bl(r),h=new Uint8Array(a+r);return Hl(s,h,0),Hl(r,h,n),h.set(t,a),new $E(s,r,t,h)};class $E{constructor(t,r,n,a){this.code=t,this.size=r,this.digest=n,this.bytes=a}}const nd=({name:s,code:t,encode:r})=>new DE(s,t,r);class DE{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Dc(this.code,r):r.then(n=>Dc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const sd=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),FE=nd({name:"sha2-256",code:18,encode:sd("SHA-256")}),LE=nd({name:"sha2-512",code:19,encode:sd("SHA-512")});var jE=Object.freeze({__proto__:null,sha256:FE,sha512:LE});const od=0,ME="identity",ad=Zf,UE=s=>Dc(od,ad(s)),qE={code:od,name:ME,encode:ad,digest:UE};var zE=Object.freeze({__proto__:null,identity:qE});new TextEncoder,new TextDecoder;const Kl={...$_,...F_,...j_,...U_,...k_,...X_,...tE,...nE,...uE,...gE};({...jE,...zE});function cd(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function kE(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?cd(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function ud(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const Vl=ud("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),vc=ud("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=kE(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),HE={utf8:Vl,"utf-8":Vl,hex:Kl.base16,latin1:vc,ascii:vc,binary:vc,...Kl};function BE(s,t="utf8"){const r=HE[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?cd(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}const hd="wc",KE=2,Xc="core",Ci=`${hd}@2:${Xc}:`,VE={name:Xc,logger:"error"},GE={database:":memory:"},WE="crypto",Gl="client_ed25519_seed",JE=ce.ONE_DAY,QE="keychain",YE="0.3",XE="messages",ZE="0.3",eI=ce.SIX_HOURS,tI="publisher",ld="irn",rI="error",fd="wss://relay.walletconnect.com",Wl="wss://relay.walletconnect.org",iI="relayer",Jt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},nI="_subscription",di={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},sI=ce.ONE_SECOND,oI="2.10.6",aI=1e4,cI="0.3",uI="WALLETCONNECT_CLIENT_ID",qr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},hI="subscription",lI="0.3",fI=ce.FIVE_SECONDS*1e3,dI="pairing",pI="0.3",Zn={wc_pairingDelete:{req:{ttl:ce.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ce.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ce.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ce.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ce.ONE_DAY,prompt:!1,tag:0},res:{ttl:ce.ONE_DAY,prompt:!1,tag:0}}},ss={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Yr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},gI="history",yI="0.3",mI="expirer",Nr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},vI="0.3",wc="verify-api",In="https://verify.walletconnect.com",Fc="https://verify.walletconnect.org",wI=[In,Fc];class bI{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=QE,this.version=YE,this.initialized=!1,this.storagePrefix=Ci,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,a)=>{this.isInitialized(),this.keychain.set(n,a),await this.persist()},this.get=n=>{this.isInitialized();const a=this.keychain.get(n);if(typeof a>"u"){const{message:h}=Z("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(h)}return a},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Tf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Nf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class _I{constructor(t,r,n){this.core=t,this.logger=r,this.name=WE,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),h=$l(a);return Kf(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=O1();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const h=await this.getClientSeed(),f=$l(h),g=Cc();return await Yb(g,a,JE,f)},this.generateSharedKey=(a,h,f)=>{this.isInitialized();const g=this.getPrivateKey(a),b=A1(g,h);return this.setSymKey(b,f)},this.setSymKey=async(a,h)=>{this.isInitialized();const f=h||R1(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,h,f)=>{this.isInitialized();const g=Cf(f),b=Qi(h);if(al(g)){const N=g.senderPublicKey,H=g.receiverPublicKey;a=await this.generateSharedKey(N,H)}const y=this.getSymKey(a),{type:_,senderPublicKey:P}=g;return T1({type:_,symKey:y,message:b,senderPublicKey:P})},this.decode=async(a,h,f)=>{this.isInitialized();const g=D1(h,f);if(al(g)){const b=g.receiverPublicKey,y=g.senderPublicKey;a=await this.generateSharedKey(b,y)}try{const b=this.getSymKey(a),y=N1({symKey:b,encoded:h});return ds(y)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}},this.getPayloadType=a=>{const h=Co(a);return hs(h.type)},this.getPayloadSenderPublicKey=a=>{const h=Co(a);return h.senderPublicKey?sr(h.senderPublicKey,nr):void 0},this.core=t,this.logger=Ce.generateChildLogger(r,this.name),this.keychain=n||new bI(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Gl)}catch{t=Cc(),await this.keychain.set(Gl,t)}return BE(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class EI extends Rb{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=XE,this.version=ZE,this.initialized=!1,this.storagePrefix=Ci,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,a)=>{this.isInitialized();const h=xn(a);let f=this.messages.get(n);return typeof f>"u"&&(f={}),typeof f[h]<"u"||(f[h]=a,this.messages.set(n,f),await this.persist()),h},this.get=n=>{this.isInitialized();let a=this.messages.get(n);return typeof a>"u"&&(a={}),a},this.has=(n,a)=>{this.isInitialized();const h=this.get(n),f=xn(a);return typeof h[f]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ce.generateChildLogger(t,this.name),this.core=r}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Tf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Nf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class II extends Cb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new $r.EventEmitter,this.name=tI,this.queue=new Map,this.publishTimeout=ce.toMiliseconds(ce.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,a,h)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:h}});try{const g=(h==null?void 0:h.ttl)||eI,b=Tc(h),y=(h==null?void 0:h.prompt)||!1,_=(h==null?void 0:h.tag)||0,P=(h==null?void 0:h.id)||Qf().toString(),N={topic:n,message:a,opts:{ttl:g,relay:b,prompt:y,tag:_,id:P}},H=setTimeout(()=>this.queue.set(P,N),this.publishTimeout);try{await await us(this.rpcPublish(n,a,g,b,y,_,P),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(P),this.relayer.events.emit(Jt.publish,N)}catch($){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=h==null?void 0:h.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(P),$;return}finally{clearTimeout(H)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:h}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.relayer=t,this.logger=Ce.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(t,r,n,a,h,f,g){var b,y,_,P;const N={method:Po(a.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:h,tag:f},id:g};return ir((b=N.params)==null?void 0:b.prompt)&&((y=N.params)==null||delete y.prompt),ir((_=N.params)==null?void 0:_.tag)&&((P=N.params)==null||delete P.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:a}=t;await this.publish(r,n,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Tn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Jt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Jt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class xI{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const a=n.filter(h=>h!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var SI=Object.defineProperty,PI=Object.defineProperties,OI=Object.getOwnPropertyDescriptors,Jl=Object.getOwnPropertySymbols,AI=Object.prototype.hasOwnProperty,RI=Object.prototype.propertyIsEnumerable,Ql=(s,t,r)=>t in s?SI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,es=(s,t)=>{for(var r in t||(t={}))AI.call(t,r)&&Ql(s,r,t[r]);if(Jl)for(var r of Jl(t))RI.call(t,r)&&Ql(s,r,t[r]);return s},bc=(s,t)=>PI(s,OI(t));class CI extends $b{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new xI,this.events=new $r.EventEmitter,this.name=hI,this.version=lI,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Ci,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}});try{const h=Tc(a),f={topic:n,relay:h};this.pending.set(n,f);const g=await this.rpcSubscribe(n,h);return this.onSubscribe(g,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}}),g}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(n,a.id,a):await this.unsubscribeByTopic(n,a)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((a,h)=>{const f=new ce.Watch;f.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(g),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=fI&&(clearInterval(g),f.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Ce.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const a=Tc(n);await this.rpcUnsubscribe(t,r,a);const h=It("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const n={method:Po(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await us(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Jt.connection_stalled)}return xn(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:Po(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await us(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Jt.connection_stalled)}}rpcUnsubscribe(t,r,n){const a={method:Po(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,bc(es({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,es({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,es({},r)),this.topicMap.set(r.topic,t),this.events.emit(qr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(qr.deleted,bc(es({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(qr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(qr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);Xr(r)&&this.onBatchSubscribe(r.map((n,a)=>bc(es({},t[a]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(Tn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Jt.connect,async()=>{await this.onConnect()}),this.relayer.on(Jt.disconnect,()=>{this.onDisconnect()}),this.events.on(qr.created,async t=>{const r=qr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(qr.deleted,async t=>{const r=qr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var TI=Object.defineProperty,Yl=Object.getOwnPropertySymbols,NI=Object.prototype.hasOwnProperty,$I=Object.prototype.propertyIsEnumerable,Xl=(s,t,r)=>t in s?TI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,DI=(s,t)=>{for(var r in t||(t={}))NI.call(t,r)&&Xl(s,r,t[r]);if(Yl)for(var r of Yl(t))$I.call(t,r)&&Xl(s,r,t[r]);return s};class FI extends Tb{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new $r.EventEmitter,this.name=iI,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Jt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Jt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(di.payload,this.onPayloadHandler),this.provider.on(di.connect,this.onConnectHandler),this.provider.on(di.disconnect,this.onDisconnectHandler),this.provider.on(di.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ce.generateChildLogger(t.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:t.logger||rI})),this.messages=new EI(this.logger,t.core),this.subscriber=new CI(this,this.logger),this.publisher=new II(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||fd,this.projectId=t.projectId,this.bundleId=q1(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Wl}...`),await this.restartTransport(Wl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},aI)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let a=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"";if(a)return a;let h;const f=g=>{g.topic===t&&(this.subscriber.off(qr.created,f),h())};return await Promise.all([new Promise(g=>{h=g,this.subscriber.on(qr.created,f)}),new Promise(async g=>{a=await this.subscriber.subscribe(t,r),g()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await us(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(qr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await us(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){n(a);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(di.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await vl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new yi(new v_(V1({sdkVersion:oI,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,n);return a&&this.logger.debug(`Ignoring duplicate message: ${n}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Yc(t)){if(!t.method.endsWith(nI))return;const r=t.params,{topic:n,message:a,publishedAt:h}=r.data,f={topic:n,message:a,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(DI({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(t),await this.onMessageEvent(f)}else jo(t)&&this.events.emit(Jt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Jt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Qc(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(di.payload,this.onPayloadHandler),this.provider.off(di.connect,this.onConnectHandler),this.provider.off(di.disconnect,this.onDisconnectHandler),this.provider.off(di.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Jt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await vl();Mw(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Jt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},ce.toMiliseconds(sI)))}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var LI=Object.defineProperty,Zl=Object.getOwnPropertySymbols,jI=Object.prototype.hasOwnProperty,MI=Object.prototype.propertyIsEnumerable,ef=(s,t,r)=>t in s?LI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,tf=(s,t)=>{for(var r in t||(t={}))jI.call(t,r)&&ef(s,r,t[r]);if(Zl)for(var r of Zl(t))MI.call(t,r)&&ef(s,r,t[r]);return s};class Uo extends Nb{constructor(t,r,n,a=Ci,h=void 0){super(t,r,n,a),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=cI,this.cached=[],this.initialized=!1,this.storagePrefix=Ci,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!ir(f)?this.map.set(this.getKey(f),f):gw(f)?this.map.set(f.id,f):yw(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,g)=>{this.isInitialized(),this.map.has(f)?await this.update(f,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:g}),this.map.set(f,g),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(g=>Object.keys(f).every(b=>b_(g[b],f[b]))):this.values),this.update=async(f,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:g});const b=tf(tf({},this.getData(f)),g);this.map.set(f,b),await this.persist()},this.delete=async(f,g)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:g}),this.map.delete(f),await this.persist())},this.logger=Ce.generateChildLogger(r,this.name),this.storagePrefix=a,this.getKey=h}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class UI{constructor(t,r){this.core=t,this.logger=r,this.name=dI,this.version=pI,this.events=new zc,this.initialized=!1,this.storagePrefix=Ci,this.ignoredPayloadTypes=[Yi],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Cc(),a=await this.core.crypto.setSymKey(n),h=zr(ce.FIVE_MINUTES),f={protocol:ld},g={topic:a,expiry:h,relay:f,active:!1},b=sw({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:n,relay:f});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,h),{topic:a,uri:b}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:a,symKey:h,relay:f}=dl(n.uri);let g;if(this.pairings.keys.includes(a)&&(g=this.pairings.get(a),g.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const b=zr(ce.FIVE_MINUTES),y={topic:a,relay:f,expiry:b,active:!1};return await this.pairings.set(a,y),this.core.expirer.set(a,b),n.activatePairing&&await this.activate({topic:a}),this.events.emit(ss.create,y),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(h,a),await this.core.relayer.subscribe(a,{relay:f})),y},this.activate=async({topic:n})=>{this.isInitialized();const a=zr(ce.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:a}),this.core.expirer.set(n,a)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:a}=n;if(this.pairings.keys.includes(a)){const h=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:g,reject:b}=En();this.events.once(Dt("pairing_ping",h),({error:y})=>{y?b(y):g()}),await f()}},this.updateExpiry=async({topic:n,expiry:a})=>{this.isInitialized(),await this.pairings.update(n,{expiry:a})},this.updateMetadata=async({topic:n,metadata:a})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:a}=n;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",It("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(n,a,h)=>{const f=Pn(a,h),g=await this.core.crypto.encode(n,f),b=Zn[a].req;return this.core.history.set(n,f),this.core.relayer.publish(n,g,b),f.id},this.sendResult=async(n,a,h)=>{const f=Qc(n,h),g=await this.core.crypto.encode(a,f),b=await this.core.history.get(a,n),y=Zn[b.request.method].res;await this.core.relayer.publish(a,g,y),await this.core.history.resolve(f)},this.sendError=async(n,a,h)=>{const f=Lo(n,h),g=await this.core.crypto.encode(a,f),b=await this.core.history.get(a,n),y=Zn[b.request.method]?Zn[b.request.method].res:Zn.unregistered_method.res;await this.core.relayer.publish(a,g,y),await this.core.history.resolve(f)},this.deletePairing=async(n,a)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,It("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),a?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(a=>Ri(a.expiry));await Promise.all(n.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=n=>{const{topic:a,payload:h}=n;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(a,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,h);default:return this.onUnknownRpcMethodRequest(a,h)}},this.onRelayEventResponse=async n=>{const{topic:a,payload:h}=n,f=(await this.core.history.get(a,h.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,h);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(n,a)=>{const{id:h}=a;try{this.isValidPing({topic:n}),await this.sendResult(h,n,!0),this.events.emit(ss.ping,{id:h,topic:n})}catch(f){await this.sendError(h,n,f),this.logger.error(f)}},this.onPairingPingResponse=(n,a)=>{const{id:h}=a;setTimeout(()=>{gi(a)?this.events.emit(Dt("pairing_ping",h),{}):kr(a)&&this.events.emit(Dt("pairing_ping",h),{error:a.error})},500)},this.onPairingDeleteRequest=async(n,a)=>{const{id:h}=a;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(ss.delete,{id:h,topic:n})}catch(f){await this.sendError(h,n,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(n,a)=>{const{id:h,method:f}=a;try{if(this.registeredMethods.includes(f))return;const g=It("WC_METHOD_UNSUPPORTED",f);await this.sendError(h,n,g),this.logger.error(g)}catch(g){await this.sendError(h,n,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(It("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var a;if(!pr(n)){const{message:f}=Z("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(f)}if(!pw(n.uri)){const{message:f}=Z("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(f)}const h=dl(n.uri);if(!((a=h==null?void 0:h.relay)!=null&&a.protocol)){const{message:f}=Z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(h!=null&&h.symKey)){const{message:f}=Z("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}},this.isValidPing=async n=>{if(!pr(n)){const{message:h}=Z("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(h)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidDisconnect=async n=>{if(!pr(n)){const{message:h}=Z("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(h)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async n=>{if(!kt(n,!1)){const{message:a}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(a)}if(!this.pairings.keys.includes(n)){const{message:a}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(a)}if(Ri(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:a}=Z("EXPIRED",`pairing topic: ${n}`);throw new Error(a)}},this.core=t,this.logger=Ce.generateChildLogger(r,this.name),this.pairings=new Uo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Jt.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const a=await this.core.crypto.decode(r,n);try{Yc(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):jo(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Nr.expired,async t=>{const{topic:r}=Df(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(ss.expire,{topic:r}))})}}class qI extends Ab{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new $r.EventEmitter,this.name=gI,this.version=yI,this.cached=[],this.initialized=!1,this.storagePrefix=Ci,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,a,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:a,chainId:h}),this.records.has(a.id))return;const f={id:a.id,topic:n,request:{method:a.method,params:a.params||null},chainId:h,expiry:zr(ce.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(Yr.created,f)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const a=await this.getRecord(n.id);typeof a.response>"u"&&(a.response=kr(n)?{error:n.error}:{result:n.result},this.records.set(a.id,a),this.events.emit(Yr.updated,a))},this.get=async(n,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:a}),await this.getRecord(a)),this.delete=(n,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(h=>{if(h.topic===n){if(typeof a<"u"&&h.id!==a)return;this.records.delete(h.id),this.events.emit(Yr.deleted,h)}})},this.exists=async(n,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===n:!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:Pn(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Yr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Yr.created,t=>{const r=Yr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Yr.updated,t=>{const r=Yr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Yr.deleted,t=>{const r=Yr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(Tn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{ce.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class zI extends Db{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new $r.EventEmitter,this.name=mI,this.version=vI,this.cached=[],this.initialized=!1,this.storagePrefix=Ci,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const a=this.formatTarget(n);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(n,a)=>{this.isInitialized();const h=this.formatTarget(n),f={target:h,expiry:a};this.expirations.set(h,f),this.checkExpiry(h,f),this.events.emit(Nr.created,{target:h,expiration:f})},this.get=n=>{this.isInitialized();const a=this.formatTarget(n);return this.getExpiration(a)},this.del=n=>{if(this.isInitialized(),this.has(n)){const a=this.formatTarget(n),h=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Nr.deleted,{target:a,expiration:h})}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return G1(t);if(typeof t=="number")return W1(t);const{message:r}=Z("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Nr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;ce.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Nr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(Tn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Nr.created,t=>{const r=Nr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Nr.expired,t=>{const r=Nr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Nr.deleted,t=>{const r=Nr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class kI extends Fb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=wc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||An()||!Rn())return;const a=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Fc;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let h;try{h=await this.fetchAttestation(n.attestationId,a)}catch(f){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${a}`),this.logger.info(f),h=await this.fetchAttestation(n.attestationId,Fc)}return h},this.fetchAttestation=async(n,a)=>{this.logger.info(`resolving attestation: ${n} from url: ${a}`);const h=this.startAbortTimer(ce.ONE_SECOND*2),f=await fetch(`${a}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(h),f.status===200?await f.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const a=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),n())};await Promise.race([new Promise(h=>{if(document.getElementById(wc))return h();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=wc,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,n=h}),new Promise((h,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},ce.toMiliseconds(ce.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let a=n||In;return wI.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${In}`),a=In),a},this.logger=Ce.generateChildLogger(r,this.name),this.verifyUrl=In,this.abortController=new AbortController,this.isDevEnv=Bc()&&{}.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ce.toMiliseconds(t))}}var HI=Object.defineProperty,rf=Object.getOwnPropertySymbols,BI=Object.prototype.hasOwnProperty,KI=Object.prototype.propertyIsEnumerable,nf=(s,t,r)=>t in s?HI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,sf=(s,t)=>{for(var r in t||(t={}))BI.call(t,r)&&nf(s,r,t[r]);if(rf)for(var r of rf(t))KI.call(t,r)&&nf(s,r,t[r]);return s};class Zc extends Ob{constructor(t){super(t),this.protocol=hd,this.version=KE,this.name=Xc,this.events=new $r.EventEmitter,this.initialized=!1,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||fd,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||VE.logger}));this.logger=Ce.generateChildLogger(r,this.name),this.heartbeat=new Tn.HeartBeat,this.crypto=new _I(this,this.logger,t==null?void 0:t.keychain),this.history=new qI(this,this.logger),this.expirer=new zI(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new vb(sf(sf({},GE),t==null?void 0:t.storageOptions)),this.relayer=new FI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new UI(this,this.logger),this.verify=new kI(this.projectId||"",this.logger)}static async init(t){const r=new Zc(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(uI,n),r}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const VI=Zc,dd="wc",pd=2,gd="client",eu=`${dd}@${pd}:${gd}:`,_c={name:gd,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},of="WALLETCONNECT_DEEPLINK_CHOICE",GI="proposal",yd="Proposal expired",WI="session",Io=ce.SEVEN_DAYS,JI="engine",ts={wc_sessionPropose:{req:{ttl:ce.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ce.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ce.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ce.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ce.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ce.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ce.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ce.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ce.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ce.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ce.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ce.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ce.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ce.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ce.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ce.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ec={min:ce.FIVE_MINUTES,max:ce.SEVEN_DAYS},pi={idle:"IDLE",active:"ACTIVE"},QI="request",YI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var XI=Object.defineProperty,ZI=Object.defineProperties,ex=Object.getOwnPropertyDescriptors,af=Object.getOwnPropertySymbols,tx=Object.prototype.hasOwnProperty,rx=Object.prototype.propertyIsEnumerable,cf=(s,t,r)=>t in s?XI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,fr=(s,t)=>{for(var r in t||(t={}))tx.call(t,r)&&cf(s,r,t[r]);if(af)for(var r of af(t))rx.call(t,r)&&cf(s,r,t[r]);return s},rs=(s,t)=>ZI(s,ex(t));class ix extends jb{constructor(t){super(t),this.name=JI,this.events=new zc,this.initialized=!1,this.ignoredPayloadTypes=[Yi],this.requestQueue={state:pi.idle,queue:[]},this.sessionRequestQueue={state:pi.idle,queue:[]},this.requestQueueDelay=ce.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(ts)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ce.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=rs(fr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:a,requiredNamespaces:h,optionalNamespaces:f,sessionProperties:g,relays:b}=n;let y=a,_,P=!1;if(y&&(P=this.client.core.pairing.pairings.get(y).active),!y||!P){const{topic:F,uri:q}=await this.client.core.pairing.create();y=F,_=q}const N=await this.client.core.crypto.generateKeyPair(),H=fr({requiredNamespaces:h,optionalNamespaces:f,relays:b??[{protocol:ld}],proposer:{publicKey:N,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:$,resolve:Q,done:se}=En(ce.FIVE_MINUTES,yd);if(this.events.once(Dt("session_connect"),async({error:F,session:q})=>{if(F)$(F);else if(q){q.self.publicKey=N;const U=rs(fr({},q),{requiredNamespaces:q.requiredNamespaces,optionalNamespaces:q.optionalNamespaces});await this.client.session.set(q.topic,U),await this.setExpiry(q.topic,q.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:q.peer.metadata}),Q(U)}}),!y){const{message:F}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error(F)}const le=await this.sendRequest({topic:y,method:"wc_sessionPropose",params:H}),C=zr(ce.FIVE_MINUTES);return await this.setProposal(le,fr({id:le,expiry:C},H)),{uri:_,approval:se}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:a,namespaces:h,sessionProperties:f}=r,g=this.client.proposal.get(n);let{pairingTopic:b,proposer:y,requiredNamespaces:_,optionalNamespaces:P}=g;b=b||"",Sn(_)||(_=uw(h,"approve()"));const N=await this.client.core.crypto.generateKeyPair(),H=y.publicKey,$=await this.client.core.crypto.generateSharedKey(N,H);b&&n&&(await this.client.core.pairing.updateMetadata({topic:b,metadata:y.metadata}),await this.sendResult({id:n,topic:b,result:{relay:{protocol:a??"irn"},responderPublicKey:N}}),await this.client.proposal.delete(n,It("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:b}));const Q=fr({relay:{protocol:a??"irn"},namespaces:h,requiredNamespaces:_,optionalNamespaces:P,pairingTopic:b,controller:{publicKey:N,metadata:this.client.metadata},expiry:zr(Io)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe($),await this.sendRequest({topic:$,method:"wc_sessionSettle",params:Q,throwOnFailedPublish:!0});const se=rs(fr({},Q),{topic:$,pairingTopic:b,acknowledged:!1,self:Q.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:N});return await this.client.session.set($,se),await this.setExpiry($,zr(Io)),{topic:$,acknowledged:()=>new Promise(le=>setTimeout(()=>le(this.client.session.get($)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:a}=r,{pairingTopic:h}=this.client.proposal.get(n);h&&(await this.sendError(n,h,a),await this.client.proposal.delete(n,It("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:a}=r,h=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:g,reject:b}=En();return this.events.once(Dt("session_update",h),({error:y})=>{y?b(y):g()}),await this.client.session.update(n,{namespaces:a}),{acknowledged:f}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,a=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:h,resolve:f,reject:g}=En();return this.events.once(Dt("session_extend",a),({error:b})=>{b?g(b):f()}),await this.setExpiry(n,zr(Io)),{acknowledged:h}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:a,topic:h,expiry:f}=r,g=Jc(),{done:b,resolve:y,reject:_}=En(f,"Request expired. Please try again.");return this.events.once(Dt("session_request",g),({error:P,result:N})=>{P?_(P):y(N)}),await Promise.all([new Promise(async P=>{await this.sendRequest({clientRpcId:g,topic:h,method:"wc_sessionRequest",params:{request:a,chainId:n},expiry:f,throwOnFailedPublish:!0}).catch(N=>_(N)),this.client.events.emit("session_request_sent",{topic:h,request:a,chainId:n,id:g}),P()}),new Promise(async P=>{const N=await Q1(this.client.core.storage,of);J1({id:g,topic:h,wcDeepLink:N}),P()}),b()]).then(P=>P[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:a}=r,{id:h}=a;gi(a)?await this.sendResult({id:h,topic:n,result:a.result,throwOnFailedPublish:!0}):kr(a)&&await this.sendError(h,n,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const a=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:h,resolve:f,reject:g}=En();this.events.once(Dt("session_ping",a),({error:b})=>{b?g(b):f()}),await h()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:a,chainId:h}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:a,chainId:h}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:It("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>fw(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(h=>{var f,g;return((f=h.peerMetadata)==null?void 0:f.url)&&((g=h.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&h.topic&&h.topic!==n.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,It("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(of).catch(h=>this.client.logger.warn(h))},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,It("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==r),a&&(this.sessionRequestQueue.state=pi.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=ts.wc_sessionRequest.req.ttl,{id:a,topic:h,params:f,verifyContext:g}=r;await this.client.pendingRequest.set(a,{id:a,topic:h,params:f,verifyContext:g}),n&&this.client.core.expirer.set(a,zr(n))},this.sendRequest=async r=>{const{topic:n,method:a,params:h,expiry:f,relayRpcId:g,clientRpcId:b,throwOnFailedPublish:y}=r,_=Pn(a,h,b);if(Rn()&&YI.includes(a)){const H=xn(JSON.stringify(_));this.client.core.verify.register({attestationId:H})}const P=await this.client.core.crypto.encode(n,_),N=ts[a].req;return f&&(N.ttl=f),g&&(N.id=g),this.client.core.history.set(n,_),y?(N.internal=rs(fr({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,P,N)):this.client.core.relayer.publish(n,P,N).catch(H=>this.client.logger.error(H)),_.id},this.sendResult=async r=>{const{id:n,topic:a,result:h,throwOnFailedPublish:f}=r,g=Qc(n,h),b=await this.client.core.crypto.encode(a,g),y=await this.client.core.history.get(a,n),_=ts[y.request.method].res;f?(_.internal=rs(fr({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,b,_)):this.client.core.relayer.publish(a,b,_).catch(P=>this.client.logger.error(P)),await this.client.core.history.resolve(g)},this.sendError=async(r,n,a)=>{const h=Lo(r,a),f=await this.client.core.crypto.encode(n,h),g=await this.client.core.history.get(n,r),b=ts[g.request.method].res;this.client.core.relayer.publish(n,f,b),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(a=>{Ri(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Ri(a.expiry)&&n.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...n.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===pi.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=pi.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=pi.idle},this.processRequest=r=>{const{topic:n,payload:a}=r,h=a.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(n,a);case"wc_sessionSettle":return this.onSessionSettleRequest(n,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,a);case"wc_sessionExtend":return this.onSessionExtendRequest(n,a);case"wc_sessionPing":return this.onSessionPingRequest(n,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,a);case"wc_sessionRequest":return this.onSessionRequest(n,a);case"wc_sessionEvent":return this.onSessionEventRequest(n,a);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:a}=r,h=(await this.client.core.history.get(n,a.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(n,a);case"wc_sessionSettle":return this.onSessionSettleResponse(n,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,a);case"wc_sessionExtend":return this.onSessionExtendResponse(n,a);case"wc_sessionPing":return this.onSessionPingResponse(n,a);case"wc_sessionRequest":return this.onSessionRequestResponse(n,a);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:a}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,n)=>{const{params:a,id:h}=n;try{this.isValidConnect(fr({},n.params));const f=zr(ce.FIVE_MINUTES),g=fr({id:h,pairingTopic:r,expiry:f},a);await this.setProposal(h,g);const b=xn(JSON.stringify(n)),y=await this.getVerifyContext(b,g.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:g,verifyContext:y})}catch(f){await this.sendError(h,r,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(r,n)=>{const{id:a}=n;if(gi(n)){const{result:h}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const b=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:b});const y=await this.client.core.crypto.generateSharedKey(g,b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:y});const _=await this.client.core.relayer.subscribe(y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:_}),await this.client.core.pairing.activate({topic:r})}else kr(n)&&(await this.client.proposal.delete(a,It("USER_DISCONNECTED")),this.events.emit(Dt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:a,params:h}=n;try{this.isValidSessionSettleRequest(h);const{relay:f,controller:g,expiry:b,namespaces:y,requiredNamespaces:_,optionalNamespaces:P,sessionProperties:N,pairingTopic:H}=n.params,$=fr({topic:r,relay:f,expiry:b,namespaces:y,acknowledged:!0,pairingTopic:H,requiredNamespaces:_,optionalNamespaces:P,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},N&&{sessionProperties:N});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Dt("session_connect"),{session:$}),this.cleanupDuplicatePairings($)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(r,n)=>{const{id:a}=n;gi(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Dt("session_approve",a),{})):kr(n)&&(await this.client.session.delete(r,It("USER_DISCONNECTED")),this.events.emit(Dt("session_approve",a),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:a,id:h}=n;try{const f=`${r}_session_update`,g=bo.get(f);if(g&&this.isRequestOutOfSync(g,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(fr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:h,topic:r,result:!0}),this.client.events.emit("session_update",{id:h,topic:r,params:a}),bo.set(f,h)}catch(f){await this.sendError(h,r,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:a}=n;gi(n)?this.events.emit(Dt("session_update",a),{}):kr(n)&&this.events.emit(Dt("session_update",a),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:a}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,zr(Io)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(r,n)=>{const{id:a}=n;gi(n)?this.events.emit(Dt("session_extend",a),{}):kr(n)&&this.events.emit(Dt("session_extend",a),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:a}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionPingResponse=(r,n)=>{const{id:a}=n;setTimeout(()=>{gi(n)?this.events.emit(Dt("session_ping",a),{}):kr(n)&&this.events.emit(Dt("session_ping",a),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:a}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Jt.publish,async()=>{h(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(r,n)=>{const{id:a,params:h}=n;try{this.isValidRequest(fr({topic:r},h));const f=xn(JSON.stringify(Pn("wc_sessionRequest",h,a))),g=this.client.session.get(r),b=await this.getVerifyContext(f,g.peer.metadata),y={id:a,topic:r,params:h,verifyContext:b};await this.setPendingSessionRequest(y),this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue()}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(r,n)=>{const{id:a}=n;gi(n)?this.events.emit(Dt("session_request",a),{result:n.result}):kr(n)&&this.events.emit(Dt("session_request",a),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:a,params:h}=n;try{const f=`${r}_session_event_${h.event.name}`,g=bo.get(f);if(g&&this.isRequestOutOfSync(g,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(fr({topic:r},h)),this.client.events.emit("session_event",{id:a,topic:r,params:h}),bo.set(f,a)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=pi.idle,this.processSessionRequestQueue()},ce.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===pi.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=pi.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,Pn("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async r=>{if(!pr(r)){const{message:b}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(b)}const{pairingTopic:n,requiredNamespaces:a,optionalNamespaces:h,sessionProperties:f,relays:g}=r;if(ir(n)||await this.isValidPairingTopic(n),!xw(g,!0)){const{message:b}=Z("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(b)}!ir(a)&&Sn(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!ir(h)&&Sn(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),ir(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(r,n)=>{const a=Iw(r,"connect()",n);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!pr(r))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:a,relayProtocol:h,sessionProperties:f}=r;await this.isValidProposalId(n);const g=this.client.proposal.get(n),b=Oo(a,"approve()");if(b)throw new Error(b.message);const y=yl(g.requiredNamespaces,a,"approve()");if(y)throw new Error(y.message);if(!kt(h,!0)){const{message:_}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(_)}ir(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async r=>{if(!pr(r)){const{message:h}=Z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(h)}const{id:n,reason:a}=r;if(await this.isValidProposalId(n),!Pw(a)){const{message:h}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidSessionSettleRequest=r=>{if(!pr(r)){const{message:y}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(y)}const{relay:n,controller:a,namespaces:h,expiry:f}=r;if(!Lf(n)){const{message:y}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(y)}const g=mw(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const b=Oo(h,"onSessionSettleRequest()");if(b)throw new Error(b.message);if(Ri(f)){const{message:y}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(y)}},this.isValidUpdate=async r=>{if(!pr(r)){const{message:b}=Z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(b)}const{topic:n,namespaces:a}=r;await this.isValidSessionTopic(n);const h=this.client.session.get(n),f=Oo(a,"update()");if(f)throw new Error(f.message);const g=yl(h.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!pr(r)){const{message:a}=Z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!pr(r)){const{message:b}=Z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(b)}const{topic:n,request:a,chainId:h,expiry:f}=r;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!gl(g,h)){const{message:b}=Z("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(b)}if(!Ow(a)){const{message:b}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(b)}if(!Cw(g,h,a.method)){const{message:b}=Z("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(b)}if(f&&!Dw(f,Ec)){const{message:b}=Z("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${Ec.min} and ${Ec.max}`);throw new Error(b)}},this.isValidRespond=async r=>{if(!pr(r)){const{message:h}=Z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:n,response:a}=r;if(await this.isValidSessionTopic(n),!Aw(a)){const{message:h}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!pr(r)){const{message:a}=Z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!pr(r)){const{message:g}=Z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:n,event:a,chainId:h}=r;await this.isValidSessionTopic(n);const{namespaces:f}=this.client.session.get(n);if(!gl(f,h)){const{message:g}=Z("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(g)}if(!Rw(a)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!Tw(f,h,a.name)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!pr(r)){const{message:a}=Z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const a={verified:{verifyUrl:n.verifyUrl||In,validation:"UNKNOWN",origin:n.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});h&&(a.verified.origin=h.origin,a.verified.isScam=h.isScam,a.verified.validation=h.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(a=>{if(!kt(a,!1)){const{message:h}=Z("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Jt.message,async t=>{const{topic:r,message:n}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const a=await this.client.core.crypto.decode(r,n);try{Yc(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):jo(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Nr.expired,async t=>{const{topic:r,id:n}=Df(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(ss.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!kt(t,!1)){const{message:r}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Ri(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=Z("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!kt(t,!1)){const{message:r}=Z("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Ri(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=Z("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(kt(t,!1)){const{message:r}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!Sw(t)){const{message:r}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Ri(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=Z("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class nx extends Uo{constructor(t,r){super(t,r,GI,eu),this.core=t,this.logger=r}}class sx extends Uo{constructor(t,r){super(t,r,WI,eu),this.core=t,this.logger=r}}class ox extends Uo{constructor(t,r){super(t,r,QI,eu,n=>n.id),this.core=t,this.logger=r}}let ax=class md extends Lb{constructor(t){super(t),this.protocol=dd,this.version=pd,this.name=_c.name,this.events=new $r.EventEmitter,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(a){throw this.logger.error(a.message),a}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(a){throw this.logger.error(a.message),a}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(a){throw this.logger.error(a.message),a}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(a){throw this.logger.error(a.message),a}},this.update=async n=>{try{return await this.engine.update(n)}catch(a){throw this.logger.error(a.message),a}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(a){throw this.logger.error(a.message),a}},this.request=async n=>{try{return await this.engine.request(n)}catch(a){throw this.logger.error(a.message),a}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(a){throw this.logger.error(a.message),a}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(a){throw this.logger.error(a.message),a}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(a){throw this.logger.error(a.message),a}},this.find=n=>{try{return this.engine.find(n)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(t==null?void 0:t.name)||_c.name,this.metadata=(t==null?void 0:t.metadata)||k1();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||_c.logger}));this.core=(t==null?void 0:t.core)||new VI(t),this.logger=Ce.generateChildLogger(r,this.name),this.session=new sx(this.core,this.logger),this.proposal=new nx(this.core,this.logger),this.pendingRequest=new ox(this.core,this.logger),this.engine=new ix(this)}static async init(t){const r=new md(t);return await r.initialize(),r}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var Lc={exports:{}};(function(s,t){var r=typeof self<"u"?self:Hr,n=function(){function h(){this.fetch=!1,this.DOMException=r.DOMException}return h.prototype=r,new h}();(function(h){(function(f){var g={searchParams:"URLSearchParams"in h,iterable:"Symbol"in h&&"iterator"in Symbol,blob:"FileReader"in h&&"Blob"in h&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in h,arrayBuffer:"ArrayBuffer"in h};function b(v){return v&&DataView.prototype.isPrototypeOf(v)}if(g.arrayBuffer)var y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],_=ArrayBuffer.isView||function(v){return v&&y.indexOf(Object.prototype.toString.call(v))>-1};function P(v){if(typeof v!="string"&&(v=String(v)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(v))throw new TypeError("Invalid character in header field name");return v.toLowerCase()}function N(v){return typeof v!="string"&&(v=String(v)),v}function H(v){var S={next:function(){var re=v.shift();return{done:re===void 0,value:re}}};return g.iterable&&(S[Symbol.iterator]=function(){return S}),S}function $(v){this.map={},v instanceof $?v.forEach(function(S,re){this.append(re,S)},this):Array.isArray(v)?v.forEach(function(S){this.append(S[0],S[1])},this):v&&Object.getOwnPropertyNames(v).forEach(function(S){this.append(S,v[S])},this)}$.prototype.append=function(v,S){v=P(v),S=N(S);var re=this.map[v];this.map[v]=re?re+", "+S:S},$.prototype.delete=function(v){delete this.map[P(v)]},$.prototype.get=function(v){return v=P(v),this.has(v)?this.map[v]:null},$.prototype.has=function(v){return this.map.hasOwnProperty(P(v))},$.prototype.set=function(v,S){this.map[P(v)]=N(S)},$.prototype.forEach=function(v,S){for(var re in this.map)this.map.hasOwnProperty(re)&&v.call(S,this.map[re],re,this)},$.prototype.keys=function(){var v=[];return this.forEach(function(S,re){v.push(re)}),H(v)},$.prototype.values=function(){var v=[];return this.forEach(function(S){v.push(S)}),H(v)},$.prototype.entries=function(){var v=[];return this.forEach(function(S,re){v.push([re,S])}),H(v)},g.iterable&&($.prototype[Symbol.iterator]=$.prototype.entries);function Q(v){if(v.bodyUsed)return Promise.reject(new TypeError("Already read"));v.bodyUsed=!0}function se(v){return new Promise(function(S,re){v.onload=function(){S(v.result)},v.onerror=function(){re(v.error)}})}function le(v){var S=new FileReader,re=se(S);return S.readAsArrayBuffer(v),re}function C(v){var S=new FileReader,re=se(S);return S.readAsText(v),re}function F(v){for(var S=new Uint8Array(v),re=new Array(S.length),pe=0;pe<S.length;pe++)re[pe]=String.fromCharCode(S[pe]);return re.join("")}function q(v){if(v.slice)return v.slice(0);var S=new Uint8Array(v.byteLength);return S.set(new Uint8Array(v)),S.buffer}function U(){return this.bodyUsed=!1,this._initBody=function(v){this._bodyInit=v,v?typeof v=="string"?this._bodyText=v:g.blob&&Blob.prototype.isPrototypeOf(v)?this._bodyBlob=v:g.formData&&FormData.prototype.isPrototypeOf(v)?this._bodyFormData=v:g.searchParams&&URLSearchParams.prototype.isPrototypeOf(v)?this._bodyText=v.toString():g.arrayBuffer&&g.blob&&b(v)?(this._bodyArrayBuffer=q(v.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(v)||_(v))?this._bodyArrayBuffer=q(v):this._bodyText=v=Object.prototype.toString.call(v):this._bodyText="",this.headers.get("content-type")||(typeof v=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(v)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var v=Q(this);if(v)return v;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?Q(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(le)}),this.text=function(){var v=Q(this);if(v)return v;if(this._bodyBlob)return C(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(F(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(ue)}),this.json=function(){return this.text().then(JSON.parse)},this}var x=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function j(v){var S=v.toUpperCase();return x.indexOf(S)>-1?S:v}function k(v,S){S=S||{};var re=S.body;if(v instanceof k){if(v.bodyUsed)throw new TypeError("Already read");this.url=v.url,this.credentials=v.credentials,S.headers||(this.headers=new $(v.headers)),this.method=v.method,this.mode=v.mode,this.signal=v.signal,!re&&v._bodyInit!=null&&(re=v._bodyInit,v.bodyUsed=!0)}else this.url=String(v);if(this.credentials=S.credentials||this.credentials||"same-origin",(S.headers||!this.headers)&&(this.headers=new $(S.headers)),this.method=j(S.method||this.method||"GET"),this.mode=S.mode||this.mode||null,this.signal=S.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&re)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(re)}k.prototype.clone=function(){return new k(this,{body:this._bodyInit})};function ue(v){var S=new FormData;return v.trim().split("&").forEach(function(re){if(re){var pe=re.split("="),Y=pe.shift().replace(/\+/g," "),G=pe.join("=").replace(/\+/g," ");S.append(decodeURIComponent(Y),decodeURIComponent(G))}}),S}function ae(v){var S=new $,re=v.replace(/\r?\n[\t ]+/g," ");return re.split(/\r?\n/).forEach(function(pe){var Y=pe.split(":"),G=Y.shift().trim();if(G){var J=Y.join(":").trim();S.append(G,J)}}),S}U.call(k.prototype);function ge(v,S){S||(S={}),this.type="default",this.status=S.status===void 0?200:S.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in S?S.statusText:"OK",this.headers=new $(S.headers),this.url=S.url||"",this._initBody(v)}U.call(ge.prototype),ge.prototype.clone=function(){return new ge(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new $(this.headers),url:this.url})},ge.error=function(){var v=new ge(null,{status:0,statusText:""});return v.type="error",v};var Te=[301,302,303,307,308];ge.redirect=function(v,S){if(Te.indexOf(S)===-1)throw new RangeError("Invalid status code");return new ge(null,{status:S,headers:{location:v}})},f.DOMException=h.DOMException;try{new f.DOMException}catch{f.DOMException=function(S,re){this.message=S,this.name=re;var pe=Error(S);this.stack=pe.stack},f.DOMException.prototype=Object.create(Error.prototype),f.DOMException.prototype.constructor=f.DOMException}function qe(v,S){return new Promise(function(re,pe){var Y=new k(v,S);if(Y.signal&&Y.signal.aborted)return pe(new f.DOMException("Aborted","AbortError"));var G=new XMLHttpRequest;function J(){G.abort()}G.onload=function(){var X={status:G.status,statusText:G.statusText,headers:ae(G.getAllResponseHeaders()||"")};X.url="responseURL"in G?G.responseURL:X.headers.get("X-Request-URL");var Je="response"in G?G.response:G.responseText;re(new ge(Je,X))},G.onerror=function(){pe(new TypeError("Network request failed"))},G.ontimeout=function(){pe(new TypeError("Network request failed"))},G.onabort=function(){pe(new f.DOMException("Aborted","AbortError"))},G.open(Y.method,Y.url,!0),Y.credentials==="include"?G.withCredentials=!0:Y.credentials==="omit"&&(G.withCredentials=!1),"responseType"in G&&g.blob&&(G.responseType="blob"),Y.headers.forEach(function(X,Je){G.setRequestHeader(Je,X)}),Y.signal&&(Y.signal.addEventListener("abort",J),G.onreadystatechange=function(){G.readyState===4&&Y.signal.removeEventListener("abort",J)}),G.send(typeof Y._bodyInit>"u"?null:Y._bodyInit)})}return qe.polyfill=!0,h.fetch||(h.fetch=qe,h.Headers=$,h.Request=k,h.Response=ge),f.Headers=$,f.Request=k,f.Response=ge,f.fetch=qe,Object.defineProperty(f,"__esModule",{value:!0}),f})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var a=n;t=a.fetch,t.default=a.fetch,t.fetch=a.fetch,t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response,s.exports=t})(Lc,Lc.exports);var cx=Lc.exports;const uf=Pf(cx),ux={Accept:"application/json","Content-Type":"application/json"},hx="POST",hf={headers:ux,method:hx},lf=10;class Ni{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new $r.EventEmitter,this.isAvailable=!1,this.registering=!1,!jl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t,r){this.isAvailable||await this.register();try{const n=Qi(t),h=await(await uf(this.url,Object.assign(Object.assign({},hf),{body:n}))).json();this.onPayload({data:h})}catch(n){this.onError(t.id,n)}}async register(t=this.url){if(!jl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,a)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),a(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return a(new Error("HTTP connection is missing or invalid"));n()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=Qi({id:1,jsonrpc:"2.0",method:"test",params:[]});await uf(t,Object.assign(Object.assign({},hf),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?ds(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),a=n.message||n.toString(),h=Lo(t,a);this.events.emit("payload",h)}parseError(t,r=this.url){return Wf(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>lf&&this.events.setMaxListeners(lf)}}const ff="error",lx="wss://relay.walletconnect.com",fx="wc",dx="universal_provider",df=`${fx}@2:${dx}:`,px="https://rpc.walletconnect.com/v1/",mi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var is=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(s,t){(function(){var r,n="4.17.21",a=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",g="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",y=500,_="__lodash_placeholder__",P=1,N=2,H=4,$=1,Q=2,se=1,le=2,C=4,F=8,q=16,U=32,x=64,j=128,k=256,ue=512,ae=30,ge="...",Te=800,qe=16,v=1,S=2,re=3,pe=1/0,Y=9007199254740991,G=17976931348623157e292,J=0/0,X=4294967295,Je=X-1,He=X>>>1,Br=[["ary",j],["bind",se],["bindKey",le],["curry",F],["curryRight",q],["flip",ue],["partial",U],["partialRight",x],["rearg",k]],Ie="[object Arguments]",xt="[object Array]",M="[object AsyncFunction]",L="[object Boolean]",T="[object Date]",u="[object DOMException]",I="[object Error]",ne="[object Function]",ye="[object GeneratorFunction]",_e="[object Map]",Ne="[object Number]",De="[object Null]",Pe="[object Object]",St="[object Promise]",vt="[object Proxy]",ot="[object RegExp]",Le="[object Set]",Ye="[object String]",Xe="[object Symbol]",at="[object Undefined]",ze="[object WeakMap]",Ze="[object WeakSet]",$e="[object ArrayBuffer]",Be="[object DataView]",ht="[object Float32Array]",Me="[object Float64Array]",Pt="[object Int8Array]",Ft="[object Int16Array]",Ht="[object Int32Array]",Bt="[object Uint8Array]",Mt="[object Uint8ClampedArray]",Qt="[object Uint16Array]",or="[object Uint32Array]",Kr=/\b__p \+= '';/g,Yt=/\b(__p \+=) '' \+/g,Zr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,vi=/&(?:amp|lt|gt|quot|#39);/g,$i=/[&<>"']/g,lt=RegExp(vi.source),rt=RegExp($i.source),ft=/<%-([\s\S]+?)%>/g,dt=/<%([\s\S]+?)%>/g,ct=/<%=([\s\S]+?)%>/g,it=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,At=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pt=/[\\^$.*+?()[\]{}|]/g,Rt=RegExp(pt.source),gt=/^\s+/,wt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Qe=/\{\n\/\* \[wrapped with (.+)\] \*/,Ct=/,? & /,Tt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,qo=/[()=,{}\[\]\/\s]/,zo=/\\(\\)?/g,ko=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ir=/\w*$/,Ho=/^[-+]0x[0-9a-f]+$/i,Bo=/^0b[01]+$/i,Ko=/^\[object .+?Constructor\]$/,Vo=/^0o[0-7]+$/i,Go=/^(?:0|[1-9]\d*)$/,ei=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,tn=/($^)/,Wo=/['\n\r\u2028\u2029\\]/g,rn="\\ud800-\\udfff",Jo="\\u0300-\\u036f",Qo="\\ufe20-\\ufe2f",nn="\\u20d0-\\u20ff",gs=Jo+Qo+nn,ys="\\u2700-\\u27bf",Dr="a-z\\xdf-\\xf6\\xf8-\\xff",Yo="\\xac\\xb1\\xd7\\xf7",Xo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Zo="\\u2000-\\u206f",ea=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ms="A-Z\\xc0-\\xd6\\xd8-\\xde",vs="\\ufe0e\\ufe0f",Di=Yo+Xo+Zo+ea,Nn="['’]",Fi="["+rn+"]",$n="["+Di+"]",Li="["+gs+"]",ws="\\d+",ta="["+ys+"]",bs="["+Dr+"]",_s="[^"+rn+Di+ws+ys+Dr+ms+"]",sn="\\ud83c[\\udffb-\\udfff]",ra="(?:"+Li+"|"+sn+")",Es="[^"+rn+"]",on="(?:\\ud83c[\\udde6-\\uddff]){2}",wi="[\\ud800-\\udbff][\\udc00-\\udfff]",yr="["+ms+"]",Is="\\u200d",xs="(?:"+bs+"|"+_s+")",Vr="(?:"+yr+"|"+_s+")",Ss="(?:"+Nn+"(?:d|ll|m|re|s|t|ve))?",Ps="(?:"+Nn+"(?:D|LL|M|RE|S|T|VE))?",Os=ra+"?",As="["+vs+"]?",ia="(?:"+Is+"(?:"+[Es,on,wi].join("|")+")"+As+Os+")*",ti="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Rs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Cs=As+Os+ia,an="(?:"+[ta,on,wi].join("|")+")"+Cs,na="(?:"+[Es+Li+"?",Li,on,wi,Fi].join("|")+")",Dn=RegExp(Nn,"g"),sa=RegExp(Li,"g"),cn=RegExp(sn+"(?="+sn+")|"+na+Cs,"g"),Ts=RegExp([yr+"?"+bs+"+"+Ss+"(?="+[$n,yr,"$"].join("|")+")",Vr+"+"+Ps+"(?="+[$n,yr+xs,"$"].join("|")+")",yr+"?"+xs+"+"+Ss,yr+"+"+Ps,Rs,ti,ws,an].join("|"),"g"),Ns=RegExp("["+Is+rn+gs+vs+"]"),ji=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,$s=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],oa=-1,Ke={};Ke[ht]=Ke[Me]=Ke[Pt]=Ke[Ft]=Ke[Ht]=Ke[Bt]=Ke[Mt]=Ke[Qt]=Ke[or]=!0,Ke[Ie]=Ke[xt]=Ke[$e]=Ke[L]=Ke[Be]=Ke[T]=Ke[I]=Ke[ne]=Ke[_e]=Ke[Ne]=Ke[Pe]=Ke[ot]=Ke[Le]=Ke[Ye]=Ke[ze]=!1;var ke={};ke[Ie]=ke[xt]=ke[$e]=ke[Be]=ke[L]=ke[T]=ke[ht]=ke[Me]=ke[Pt]=ke[Ft]=ke[Ht]=ke[_e]=ke[Ne]=ke[Pe]=ke[ot]=ke[Le]=ke[Ye]=ke[Xe]=ke[Bt]=ke[Mt]=ke[Qt]=ke[or]=!0,ke[I]=ke[ne]=ke[ze]=!1;var m={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},O={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},V={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},te={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,ve=parseInt,et=typeof is=="object"&&is&&is.Object===Object&&is,Nt=typeof self=="object"&&self&&self.Object===Object&&self,Ae=et||Nt||Function("return this")(),Ge=t&&!t.nodeType&&t,bt=Ge&&!0&&s&&!s.nodeType&&s,ar=bt&&bt.exports===Ge,$t=ar&&et.process,tt=function(){try{var A=bt&&bt.require&&bt.require("util").types;return A||$t&&$t.binding&&$t.binding("util")}catch{}}(),Xt=tt&&tt.isArrayBuffer,Fr=tt&&tt.isDate,xr=tt&&tt.isMap,Gr=tt&&tt.isRegExp,Fn=tt&&tt.isSet,Mi=tt&&tt.isTypedArray;function Ut(A,z,D){switch(D.length){case 0:return A.call(z);case 1:return A.call(z,D[0]);case 2:return A.call(z,D[0],D[1]);case 3:return A.call(z,D[0],D[1],D[2])}return A.apply(z,D)}function bd(A,z,D,ie){for(var me=-1,Fe=A==null?0:A.length;++me<Fe;){var Lt=A[me];z(ie,Lt,D(Lt),A)}return ie}function Sr(A,z){for(var D=-1,ie=A==null?0:A.length;++D<ie&&z(A[D],D,A)!==!1;);return A}function _d(A,z){for(var D=A==null?0:A.length;D--&&z(A[D],D,A)!==!1;);return A}function iu(A,z){for(var D=-1,ie=A==null?0:A.length;++D<ie;)if(!z(A[D],D,A))return!1;return!0}function bi(A,z){for(var D=-1,ie=A==null?0:A.length,me=0,Fe=[];++D<ie;){var Lt=A[D];z(Lt,D,A)&&(Fe[me++]=Lt)}return Fe}function Ds(A,z){var D=A==null?0:A.length;return!!D&&un(A,z,0)>-1}function aa(A,z,D){for(var ie=-1,me=A==null?0:A.length;++ie<me;)if(D(z,A[ie]))return!0;return!1}function nt(A,z){for(var D=-1,ie=A==null?0:A.length,me=Array(ie);++D<ie;)me[D]=z(A[D],D,A);return me}function _i(A,z){for(var D=-1,ie=z.length,me=A.length;++D<ie;)A[me+D]=z[D];return A}function ca(A,z,D,ie){var me=-1,Fe=A==null?0:A.length;for(ie&&Fe&&(D=A[++me]);++me<Fe;)D=z(D,A[me],me,A);return D}function Ed(A,z,D,ie){var me=A==null?0:A.length;for(ie&&me&&(D=A[--me]);me--;)D=z(D,A[me],me,A);return D}function ua(A,z){for(var D=-1,ie=A==null?0:A.length;++D<ie;)if(z(A[D],D,A))return!0;return!1}var Id=ha("length");function xd(A){return A.split("")}function Sd(A){return A.match(Tt)||[]}function nu(A,z,D){var ie;return D(A,function(me,Fe,Lt){if(z(me,Fe,Lt))return ie=Fe,!1}),ie}function Fs(A,z,D,ie){for(var me=A.length,Fe=D+(ie?1:-1);ie?Fe--:++Fe<me;)if(z(A[Fe],Fe,A))return Fe;return-1}function un(A,z,D){return z===z?jd(A,z,D):Fs(A,su,D)}function Pd(A,z,D,ie){for(var me=D-1,Fe=A.length;++me<Fe;)if(ie(A[me],z))return me;return-1}function su(A){return A!==A}function ou(A,z){var D=A==null?0:A.length;return D?fa(A,z)/D:J}function ha(A){return function(z){return z==null?r:z[A]}}function la(A){return function(z){return A==null?r:A[z]}}function au(A,z,D,ie,me){return me(A,function(Fe,Lt,We){D=ie?(ie=!1,Fe):z(D,Fe,Lt,We)}),D}function Od(A,z){var D=A.length;for(A.sort(z);D--;)A[D]=A[D].value;return A}function fa(A,z){for(var D,ie=-1,me=A.length;++ie<me;){var Fe=z(A[ie]);Fe!==r&&(D=D===r?Fe:D+Fe)}return D}function da(A,z){for(var D=-1,ie=Array(A);++D<A;)ie[D]=z(D);return ie}function Ad(A,z){return nt(z,function(D){return[D,A[D]]})}function cu(A){return A&&A.slice(0,fu(A)+1).replace(gt,"")}function mr(A){return function(z){return A(z)}}function pa(A,z){return nt(z,function(D){return A[D]})}function Ln(A,z){return A.has(z)}function uu(A,z){for(var D=-1,ie=A.length;++D<ie&&un(z,A[D],0)>-1;);return D}function hu(A,z){for(var D=A.length;D--&&un(z,A[D],0)>-1;);return D}function Rd(A,z){for(var D=A.length,ie=0;D--;)A[D]===z&&++ie;return ie}var Cd=la(m),Td=la(O);function Nd(A){return"\\"+te[A]}function $d(A,z){return A==null?r:A[z]}function hn(A){return Ns.test(A)}function Dd(A){return ji.test(A)}function Fd(A){for(var z,D=[];!(z=A.next()).done;)D.push(z.value);return D}function ga(A){var z=-1,D=Array(A.size);return A.forEach(function(ie,me){D[++z]=[me,ie]}),D}function lu(A,z){return function(D){return A(z(D))}}function Ei(A,z){for(var D=-1,ie=A.length,me=0,Fe=[];++D<ie;){var Lt=A[D];(Lt===z||Lt===_)&&(A[D]=_,Fe[me++]=D)}return Fe}function Ls(A){var z=-1,D=Array(A.size);return A.forEach(function(ie){D[++z]=ie}),D}function Ld(A){var z=-1,D=Array(A.size);return A.forEach(function(ie){D[++z]=[ie,ie]}),D}function jd(A,z,D){for(var ie=D-1,me=A.length;++ie<me;)if(A[ie]===z)return ie;return-1}function Md(A,z,D){for(var ie=D+1;ie--;)if(A[ie]===z)return ie;return ie}function ln(A){return hn(A)?qd(A):Id(A)}function Lr(A){return hn(A)?zd(A):xd(A)}function fu(A){for(var z=A.length;z--&&wt.test(A.charAt(z)););return z}var Ud=la(V);function qd(A){for(var z=cn.lastIndex=0;cn.test(A);)++z;return z}function zd(A){return A.match(cn)||[]}function kd(A){return A.match(Ts)||[]}var Hd=function A(z){z=z==null?Ae:fn.defaults(Ae.Object(),z,fn.pick(Ae,$s));var D=z.Array,ie=z.Date,me=z.Error,Fe=z.Function,Lt=z.Math,We=z.Object,ya=z.RegExp,Bd=z.String,Pr=z.TypeError,js=D.prototype,Kd=Fe.prototype,dn=We.prototype,Ms=z["__core-js_shared__"],Us=Kd.toString,Ue=dn.hasOwnProperty,Vd=0,du=function(){var e=/[^.]+$/.exec(Ms&&Ms.keys&&Ms.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),qs=dn.toString,Gd=Us.call(We),Wd=Ae._,Jd=ya("^"+Us.call(Ue).replace(pt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zs=ar?z.Buffer:r,Ii=z.Symbol,ks=z.Uint8Array,pu=zs?zs.allocUnsafe:r,Hs=lu(We.getPrototypeOf,We),gu=We.create,yu=dn.propertyIsEnumerable,Bs=js.splice,mu=Ii?Ii.isConcatSpreadable:r,jn=Ii?Ii.iterator:r,Ui=Ii?Ii.toStringTag:r,Ks=function(){try{var e=Bi(We,"defineProperty");return e({},"",{}),e}catch{}}(),Qd=z.clearTimeout!==Ae.clearTimeout&&z.clearTimeout,Yd=ie&&ie.now!==Ae.Date.now&&ie.now,Xd=z.setTimeout!==Ae.setTimeout&&z.setTimeout,Vs=Lt.ceil,Gs=Lt.floor,ma=We.getOwnPropertySymbols,Zd=zs?zs.isBuffer:r,vu=z.isFinite,ep=js.join,tp=lu(We.keys,We),jt=Lt.max,Gt=Lt.min,rp=ie.now,ip=z.parseInt,wu=Lt.random,np=js.reverse,va=Bi(z,"DataView"),Mn=Bi(z,"Map"),wa=Bi(z,"Promise"),pn=Bi(z,"Set"),Un=Bi(z,"WeakMap"),qn=Bi(We,"create"),Ws=Un&&new Un,gn={},sp=Ki(va),op=Ki(Mn),ap=Ki(wa),cp=Ki(pn),up=Ki(Un),Js=Ii?Ii.prototype:r,zn=Js?Js.valueOf:r,bu=Js?Js.toString:r;function d(e){if(mt(e)&&!we(e)&&!(e instanceof Oe)){if(e instanceof Or)return e;if(Ue.call(e,"__wrapped__"))return _h(e)}return new Or(e)}var yn=function(){function e(){}return function(i){if(!ut(i))return{};if(gu)return gu(i);e.prototype=i;var o=new e;return e.prototype=r,o}}();function Qs(){}function Or(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}d.templateSettings={escape:ft,evaluate:dt,interpolate:ct,variable:"",imports:{_:d}},d.prototype=Qs.prototype,d.prototype.constructor=d,Or.prototype=yn(Qs.prototype),Or.prototype.constructor=Or;function Oe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=X,this.__views__=[]}function hp(){var e=new Oe(this.__wrapped__);return e.__actions__=cr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=cr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=cr(this.__views__),e}function lp(){if(this.__filtered__){var e=new Oe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function fp(){var e=this.__wrapped__.value(),i=this.__dir__,o=we(e),c=i<0,l=o?e.length:0,p=xg(0,l,this.__views__),w=p.start,E=p.end,R=E-w,B=c?E:w-1,K=this.__iteratees__,W=K.length,ee=0,oe=Gt(R,this.__takeCount__);if(!o||!c&&l==R&&oe==R)return Bu(e,this.__actions__);var fe=[];e:for(;R--&&ee<oe;){B+=i;for(var Ee=-1,de=e[B];++Ee<W;){var Se=K[Ee],Re=Se.iteratee,br=Se.type,tr=Re(de);if(br==S)de=tr;else if(!tr){if(br==v)continue e;break e}}fe[ee++]=de}return fe}Oe.prototype=yn(Qs.prototype),Oe.prototype.constructor=Oe;function qi(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function dp(){this.__data__=qn?qn(null):{},this.size=0}function pp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function gp(e){var i=this.__data__;if(qn){var o=i[e];return o===b?r:o}return Ue.call(i,e)?i[e]:r}function yp(e){var i=this.__data__;return qn?i[e]!==r:Ue.call(i,e)}function mp(e,i){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=qn&&i===r?b:i,this}qi.prototype.clear=dp,qi.prototype.delete=pp,qi.prototype.get=gp,qi.prototype.has=yp,qi.prototype.set=mp;function ri(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function vp(){this.__data__=[],this.size=0}function wp(e){var i=this.__data__,o=Ys(i,e);if(o<0)return!1;var c=i.length-1;return o==c?i.pop():Bs.call(i,o,1),--this.size,!0}function bp(e){var i=this.__data__,o=Ys(i,e);return o<0?r:i[o][1]}function _p(e){return Ys(this.__data__,e)>-1}function Ep(e,i){var o=this.__data__,c=Ys(o,e);return c<0?(++this.size,o.push([e,i])):o[c][1]=i,this}ri.prototype.clear=vp,ri.prototype.delete=wp,ri.prototype.get=bp,ri.prototype.has=_p,ri.prototype.set=Ep;function ii(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function Ip(){this.size=0,this.__data__={hash:new qi,map:new(Mn||ri),string:new qi}}function xp(e){var i=uo(this,e).delete(e);return this.size-=i?1:0,i}function Sp(e){return uo(this,e).get(e)}function Pp(e){return uo(this,e).has(e)}function Op(e,i){var o=uo(this,e),c=o.size;return o.set(e,i),this.size+=o.size==c?0:1,this}ii.prototype.clear=Ip,ii.prototype.delete=xp,ii.prototype.get=Sp,ii.prototype.has=Pp,ii.prototype.set=Op;function zi(e){var i=-1,o=e==null?0:e.length;for(this.__data__=new ii;++i<o;)this.add(e[i])}function Ap(e){return this.__data__.set(e,b),this}function Rp(e){return this.__data__.has(e)}zi.prototype.add=zi.prototype.push=Ap,zi.prototype.has=Rp;function jr(e){var i=this.__data__=new ri(e);this.size=i.size}function Cp(){this.__data__=new ri,this.size=0}function Tp(e){var i=this.__data__,o=i.delete(e);return this.size=i.size,o}function Np(e){return this.__data__.get(e)}function $p(e){return this.__data__.has(e)}function Dp(e,i){var o=this.__data__;if(o instanceof ri){var c=o.__data__;if(!Mn||c.length<a-1)return c.push([e,i]),this.size=++o.size,this;o=this.__data__=new ii(c)}return o.set(e,i),this.size=o.size,this}jr.prototype.clear=Cp,jr.prototype.delete=Tp,jr.prototype.get=Np,jr.prototype.has=$p,jr.prototype.set=Dp;function _u(e,i){var o=we(e),c=!o&&Vi(e),l=!o&&!c&&Ai(e),p=!o&&!c&&!l&&bn(e),w=o||c||l||p,E=w?da(e.length,Bd):[],R=E.length;for(var B in e)(i||Ue.call(e,B))&&!(w&&(B=="length"||l&&(B=="offset"||B=="parent")||p&&(B=="buffer"||B=="byteLength"||B=="byteOffset")||ai(B,R)))&&E.push(B);return E}function Eu(e){var i=e.length;return i?e[Ca(0,i-1)]:r}function Fp(e,i){return ho(cr(e),ki(i,0,e.length))}function Lp(e){return ho(cr(e))}function ba(e,i,o){(o!==r&&!Mr(e[i],o)||o===r&&!(i in e))&&ni(e,i,o)}function kn(e,i,o){var c=e[i];(!(Ue.call(e,i)&&Mr(c,o))||o===r&&!(i in e))&&ni(e,i,o)}function Ys(e,i){for(var o=e.length;o--;)if(Mr(e[o][0],i))return o;return-1}function jp(e,i,o,c){return xi(e,function(l,p,w){i(c,l,o(l),w)}),c}function Iu(e,i){return e&&Jr(i,qt(i),e)}function Mp(e,i){return e&&Jr(i,hr(i),e)}function ni(e,i,o){i=="__proto__"&&Ks?Ks(e,i,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[i]=o}function _a(e,i){for(var o=-1,c=i.length,l=D(c),p=e==null;++o<c;)l[o]=p?r:tc(e,i[o]);return l}function ki(e,i,o){return e===e&&(o!==r&&(e=e<=o?e:o),i!==r&&(e=e>=i?e:i)),e}function Ar(e,i,o,c,l,p){var w,E=i&P,R=i&N,B=i&H;if(o&&(w=l?o(e,c,l,p):o(e)),w!==r)return w;if(!ut(e))return e;var K=we(e);if(K){if(w=Pg(e),!E)return cr(e,w)}else{var W=Wt(e),ee=W==ne||W==ye;if(Ai(e))return Gu(e,E);if(W==Pe||W==Ie||ee&&!l){if(w=R||ee?{}:fh(e),!E)return R?gg(e,Mp(w,e)):pg(e,Iu(w,e))}else{if(!ke[W])return l?e:{};w=Og(e,W,E)}}p||(p=new jr);var oe=p.get(e);if(oe)return oe;p.set(e,w),zh(e)?e.forEach(function(de){w.add(Ar(de,i,o,de,e,p))}):Uh(e)&&e.forEach(function(de,Se){w.set(Se,Ar(de,i,o,Se,e,p))});var fe=B?R?za:qa:R?hr:qt,Ee=K?r:fe(e);return Sr(Ee||e,function(de,Se){Ee&&(Se=de,de=e[Se]),kn(w,Se,Ar(de,i,o,Se,e,p))}),w}function Up(e){var i=qt(e);return function(o){return xu(o,e,i)}}function xu(e,i,o){var c=o.length;if(e==null)return!c;for(e=We(e);c--;){var l=o[c],p=i[l],w=e[l];if(w===r&&!(l in e)||!p(w))return!1}return!0}function Su(e,i,o){if(typeof e!="function")throw new Pr(f);return Jn(function(){e.apply(r,o)},i)}function Hn(e,i,o,c){var l=-1,p=Ds,w=!0,E=e.length,R=[],B=i.length;if(!E)return R;o&&(i=nt(i,mr(o))),c?(p=aa,w=!1):i.length>=a&&(p=Ln,w=!1,i=new zi(i));e:for(;++l<E;){var K=e[l],W=o==null?K:o(K);if(K=c||K!==0?K:0,w&&W===W){for(var ee=B;ee--;)if(i[ee]===W)continue e;R.push(K)}else p(i,W,c)||R.push(K)}return R}var xi=Xu(Wr),Pu=Xu(Ia,!0);function qp(e,i){var o=!0;return xi(e,function(c,l,p){return o=!!i(c,l,p),o}),o}function Xs(e,i,o){for(var c=-1,l=e.length;++c<l;){var p=e[c],w=i(p);if(w!=null&&(E===r?w===w&&!wr(w):o(w,E)))var E=w,R=p}return R}function zp(e,i,o,c){var l=e.length;for(o=be(o),o<0&&(o=-o>l?0:l+o),c=c===r||c>l?l:be(c),c<0&&(c+=l),c=o>c?0:Hh(c);o<c;)e[o++]=i;return e}function Ou(e,i){var o=[];return xi(e,function(c,l,p){i(c,l,p)&&o.push(c)}),o}function Kt(e,i,o,c,l){var p=-1,w=e.length;for(o||(o=Rg),l||(l=[]);++p<w;){var E=e[p];i>0&&o(E)?i>1?Kt(E,i-1,o,c,l):_i(l,E):c||(l[l.length]=E)}return l}var Ea=Zu(),Au=Zu(!0);function Wr(e,i){return e&&Ea(e,i,qt)}function Ia(e,i){return e&&Au(e,i,qt)}function Zs(e,i){return bi(i,function(o){return ci(e[o])})}function Hi(e,i){i=Pi(i,e);for(var o=0,c=i.length;e!=null&&o<c;)e=e[Qr(i[o++])];return o&&o==c?e:r}function Ru(e,i,o){var c=i(e);return we(e)?c:_i(c,o(e))}function Zt(e){return e==null?e===r?at:De:Ui&&Ui in We(e)?Ig(e):Lg(e)}function xa(e,i){return e>i}function kp(e,i){return e!=null&&Ue.call(e,i)}function Hp(e,i){return e!=null&&i in We(e)}function Bp(e,i,o){return e>=Gt(i,o)&&e<jt(i,o)}function Sa(e,i,o){for(var c=o?aa:Ds,l=e[0].length,p=e.length,w=p,E=D(p),R=1/0,B=[];w--;){var K=e[w];w&&i&&(K=nt(K,mr(i))),R=Gt(K.length,R),E[w]=!o&&(i||l>=120&&K.length>=120)?new zi(w&&K):r}K=e[0];var W=-1,ee=E[0];e:for(;++W<l&&B.length<R;){var oe=K[W],fe=i?i(oe):oe;if(oe=o||oe!==0?oe:0,!(ee?Ln(ee,fe):c(B,fe,o))){for(w=p;--w;){var Ee=E[w];if(!(Ee?Ln(Ee,fe):c(e[w],fe,o)))continue e}ee&&ee.push(fe),B.push(oe)}}return B}function Kp(e,i,o,c){return Wr(e,function(l,p,w){i(c,o(l),p,w)}),c}function Bn(e,i,o){i=Pi(i,e),e=yh(e,i);var c=e==null?e:e[Qr(Cr(i))];return c==null?r:Ut(c,e,o)}function Cu(e){return mt(e)&&Zt(e)==Ie}function Vp(e){return mt(e)&&Zt(e)==$e}function Gp(e){return mt(e)&&Zt(e)==T}function Kn(e,i,o,c,l){return e===i?!0:e==null||i==null||!mt(e)&&!mt(i)?e!==e&&i!==i:Wp(e,i,o,c,Kn,l)}function Wp(e,i,o,c,l,p){var w=we(e),E=we(i),R=w?xt:Wt(e),B=E?xt:Wt(i);R=R==Ie?Pe:R,B=B==Ie?Pe:B;var K=R==Pe,W=B==Pe,ee=R==B;if(ee&&Ai(e)){if(!Ai(i))return!1;w=!0,K=!1}if(ee&&!K)return p||(p=new jr),w||bn(e)?uh(e,i,o,c,l,p):_g(e,i,R,o,c,l,p);if(!(o&$)){var oe=K&&Ue.call(e,"__wrapped__"),fe=W&&Ue.call(i,"__wrapped__");if(oe||fe){var Ee=oe?e.value():e,de=fe?i.value():i;return p||(p=new jr),l(Ee,de,o,c,p)}}return ee?(p||(p=new jr),Eg(e,i,o,c,l,p)):!1}function Jp(e){return mt(e)&&Wt(e)==_e}function Pa(e,i,o,c){var l=o.length,p=l,w=!c;if(e==null)return!p;for(e=We(e);l--;){var E=o[l];if(w&&E[2]?E[1]!==e[E[0]]:!(E[0]in e))return!1}for(;++l<p;){E=o[l];var R=E[0],B=e[R],K=E[1];if(w&&E[2]){if(B===r&&!(R in e))return!1}else{var W=new jr;if(c)var ee=c(B,K,R,e,i,W);if(!(ee===r?Kn(K,B,$|Q,c,W):ee))return!1}}return!0}function Tu(e){if(!ut(e)||Tg(e))return!1;var i=ci(e)?Jd:Ko;return i.test(Ki(e))}function Qp(e){return mt(e)&&Zt(e)==ot}function Yp(e){return mt(e)&&Wt(e)==Le}function Xp(e){return mt(e)&&mo(e.length)&&!!Ke[Zt(e)]}function Nu(e){return typeof e=="function"?e:e==null?lr:typeof e=="object"?we(e)?Fu(e[0],e[1]):Du(e):el(e)}function Oa(e){if(!Wn(e))return tp(e);var i=[];for(var o in We(e))Ue.call(e,o)&&o!="constructor"&&i.push(o);return i}function Zp(e){if(!ut(e))return Fg(e);var i=Wn(e),o=[];for(var c in e)c=="constructor"&&(i||!Ue.call(e,c))||o.push(c);return o}function Aa(e,i){return e<i}function $u(e,i){var o=-1,c=ur(e)?D(e.length):[];return xi(e,function(l,p,w){c[++o]=i(l,p,w)}),c}function Du(e){var i=Ha(e);return i.length==1&&i[0][2]?ph(i[0][0],i[0][1]):function(o){return o===e||Pa(o,e,i)}}function Fu(e,i){return Ka(e)&&dh(i)?ph(Qr(e),i):function(o){var c=tc(o,e);return c===r&&c===i?rc(o,e):Kn(i,c,$|Q)}}function eo(e,i,o,c,l){e!==i&&Ea(i,function(p,w){if(l||(l=new jr),ut(p))eg(e,i,w,o,eo,c,l);else{var E=c?c(Ga(e,w),p,w+"",e,i,l):r;E===r&&(E=p),ba(e,w,E)}},hr)}function eg(e,i,o,c,l,p,w){var E=Ga(e,o),R=Ga(i,o),B=w.get(R);if(B){ba(e,o,B);return}var K=p?p(E,R,o+"",e,i,w):r,W=K===r;if(W){var ee=we(R),oe=!ee&&Ai(R),fe=!ee&&!oe&&bn(R);K=R,ee||oe||fe?we(E)?K=E:_t(E)?K=cr(E):oe?(W=!1,K=Gu(R,!0)):fe?(W=!1,K=Wu(R,!0)):K=[]:Qn(R)||Vi(R)?(K=E,Vi(E)?K=Bh(E):(!ut(E)||ci(E))&&(K=fh(R))):W=!1}W&&(w.set(R,K),l(K,R,c,p,w),w.delete(R)),ba(e,o,K)}function Lu(e,i){var o=e.length;if(o)return i+=i<0?o:0,ai(i,o)?e[i]:r}function ju(e,i,o){i.length?i=nt(i,function(p){return we(p)?function(w){return Hi(w,p.length===1?p[0]:p)}:p}):i=[lr];var c=-1;i=nt(i,mr(he()));var l=$u(e,function(p,w,E){var R=nt(i,function(B){return B(p)});return{criteria:R,index:++c,value:p}});return Od(l,function(p,w){return dg(p,w,o)})}function tg(e,i){return Mu(e,i,function(o,c){return rc(e,c)})}function Mu(e,i,o){for(var c=-1,l=i.length,p={};++c<l;){var w=i[c],E=Hi(e,w);o(E,w)&&Vn(p,Pi(w,e),E)}return p}function rg(e){return function(i){return Hi(i,e)}}function Ra(e,i,o,c){var l=c?Pd:un,p=-1,w=i.length,E=e;for(e===i&&(i=cr(i)),o&&(E=nt(e,mr(o)));++p<w;)for(var R=0,B=i[p],K=o?o(B):B;(R=l(E,K,R,c))>-1;)E!==e&&Bs.call(E,R,1),Bs.call(e,R,1);return e}function Uu(e,i){for(var o=e?i.length:0,c=o-1;o--;){var l=i[o];if(o==c||l!==p){var p=l;ai(l)?Bs.call(e,l,1):$a(e,l)}}return e}function Ca(e,i){return e+Gs(wu()*(i-e+1))}function ig(e,i,o,c){for(var l=-1,p=jt(Vs((i-e)/(o||1)),0),w=D(p);p--;)w[c?p:++l]=e,e+=o;return w}function Ta(e,i){var o="";if(!e||i<1||i>Y)return o;do i%2&&(o+=e),i=Gs(i/2),i&&(e+=e);while(i);return o}function xe(e,i){return Wa(gh(e,i,lr),e+"")}function ng(e){return Eu(_n(e))}function sg(e,i){var o=_n(e);return ho(o,ki(i,0,o.length))}function Vn(e,i,o,c){if(!ut(e))return e;i=Pi(i,e);for(var l=-1,p=i.length,w=p-1,E=e;E!=null&&++l<p;){var R=Qr(i[l]),B=o;if(R==="__proto__"||R==="constructor"||R==="prototype")return e;if(l!=w){var K=E[R];B=c?c(K,R,E):r,B===r&&(B=ut(K)?K:ai(i[l+1])?[]:{})}kn(E,R,B),E=E[R]}return e}var qu=Ws?function(e,i){return Ws.set(e,i),e}:lr,og=Ks?function(e,i){return Ks(e,"toString",{configurable:!0,enumerable:!1,value:nc(i),writable:!0})}:lr;function ag(e){return ho(_n(e))}function Rr(e,i,o){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),o=o>l?l:o,o<0&&(o+=l),l=i>o?0:o-i>>>0,i>>>=0;for(var p=D(l);++c<l;)p[c]=e[c+i];return p}function cg(e,i){var o;return xi(e,function(c,l,p){return o=i(c,l,p),!o}),!!o}function to(e,i,o){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=He){for(;c<l;){var p=c+l>>>1,w=e[p];w!==null&&!wr(w)&&(o?w<=i:w<i)?c=p+1:l=p}return l}return Na(e,i,lr,o)}function Na(e,i,o,c){var l=0,p=e==null?0:e.length;if(p===0)return 0;i=o(i);for(var w=i!==i,E=i===null,R=wr(i),B=i===r;l<p;){var K=Gs((l+p)/2),W=o(e[K]),ee=W!==r,oe=W===null,fe=W===W,Ee=wr(W);if(w)var de=c||fe;else B?de=fe&&(c||ee):E?de=fe&&ee&&(c||!oe):R?de=fe&&ee&&!oe&&(c||!Ee):oe||Ee?de=!1:de=c?W<=i:W<i;de?l=K+1:p=K}return Gt(p,Je)}function zu(e,i){for(var o=-1,c=e.length,l=0,p=[];++o<c;){var w=e[o],E=i?i(w):w;if(!o||!Mr(E,R)){var R=E;p[l++]=w===0?0:w}}return p}function ku(e){return typeof e=="number"?e:wr(e)?J:+e}function vr(e){if(typeof e=="string")return e;if(we(e))return nt(e,vr)+"";if(wr(e))return bu?bu.call(e):"";var i=e+"";return i=="0"&&1/e==-pe?"-0":i}function Si(e,i,o){var c=-1,l=Ds,p=e.length,w=!0,E=[],R=E;if(o)w=!1,l=aa;else if(p>=a){var B=i?null:wg(e);if(B)return Ls(B);w=!1,l=Ln,R=new zi}else R=i?[]:E;e:for(;++c<p;){var K=e[c],W=i?i(K):K;if(K=o||K!==0?K:0,w&&W===W){for(var ee=R.length;ee--;)if(R[ee]===W)continue e;i&&R.push(W),E.push(K)}else l(R,W,o)||(R!==E&&R.push(W),E.push(K))}return E}function $a(e,i){return i=Pi(i,e),e=yh(e,i),e==null||delete e[Qr(Cr(i))]}function Hu(e,i,o,c){return Vn(e,i,o(Hi(e,i)),c)}function ro(e,i,o,c){for(var l=e.length,p=c?l:-1;(c?p--:++p<l)&&i(e[p],p,e););return o?Rr(e,c?0:p,c?p+1:l):Rr(e,c?p+1:0,c?l:p)}function Bu(e,i){var o=e;return o instanceof Oe&&(o=o.value()),ca(i,function(c,l){return l.func.apply(l.thisArg,_i([c],l.args))},o)}function Da(e,i,o){var c=e.length;if(c<2)return c?Si(e[0]):[];for(var l=-1,p=D(c);++l<c;)for(var w=e[l],E=-1;++E<c;)E!=l&&(p[l]=Hn(p[l]||w,e[E],i,o));return Si(Kt(p,1),i,o)}function Ku(e,i,o){for(var c=-1,l=e.length,p=i.length,w={};++c<l;){var E=c<p?i[c]:r;o(w,e[c],E)}return w}function Fa(e){return _t(e)?e:[]}function La(e){return typeof e=="function"?e:lr}function Pi(e,i){return we(e)?e:Ka(e,i)?[e]:bh(je(e))}var ug=xe;function Oi(e,i,o){var c=e.length;return o=o===r?c:o,!i&&o>=c?e:Rr(e,i,o)}var Vu=Qd||function(e){return Ae.clearTimeout(e)};function Gu(e,i){if(i)return e.slice();var o=e.length,c=pu?pu(o):new e.constructor(o);return e.copy(c),c}function ja(e){var i=new e.constructor(e.byteLength);return new ks(i).set(new ks(e)),i}function hg(e,i){var o=i?ja(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function lg(e){var i=new e.constructor(e.source,Ir.exec(e));return i.lastIndex=e.lastIndex,i}function fg(e){return zn?We(zn.call(e)):{}}function Wu(e,i){var o=i?ja(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function Ju(e,i){if(e!==i){var o=e!==r,c=e===null,l=e===e,p=wr(e),w=i!==r,E=i===null,R=i===i,B=wr(i);if(!E&&!B&&!p&&e>i||p&&w&&R&&!E&&!B||c&&w&&R||!o&&R||!l)return 1;if(!c&&!p&&!B&&e<i||B&&o&&l&&!c&&!p||E&&o&&l||!w&&l||!R)return-1}return 0}function dg(e,i,o){for(var c=-1,l=e.criteria,p=i.criteria,w=l.length,E=o.length;++c<w;){var R=Ju(l[c],p[c]);if(R){if(c>=E)return R;var B=o[c];return R*(B=="desc"?-1:1)}}return e.index-i.index}function Qu(e,i,o,c){for(var l=-1,p=e.length,w=o.length,E=-1,R=i.length,B=jt(p-w,0),K=D(R+B),W=!c;++E<R;)K[E]=i[E];for(;++l<w;)(W||l<p)&&(K[o[l]]=e[l]);for(;B--;)K[E++]=e[l++];return K}function Yu(e,i,o,c){for(var l=-1,p=e.length,w=-1,E=o.length,R=-1,B=i.length,K=jt(p-E,0),W=D(K+B),ee=!c;++l<K;)W[l]=e[l];for(var oe=l;++R<B;)W[oe+R]=i[R];for(;++w<E;)(ee||l<p)&&(W[oe+o[w]]=e[l++]);return W}function cr(e,i){var o=-1,c=e.length;for(i||(i=D(c));++o<c;)i[o]=e[o];return i}function Jr(e,i,o,c){var l=!o;o||(o={});for(var p=-1,w=i.length;++p<w;){var E=i[p],R=c?c(o[E],e[E],E,o,e):r;R===r&&(R=e[E]),l?ni(o,E,R):kn(o,E,R)}return o}function pg(e,i){return Jr(e,Ba(e),i)}function gg(e,i){return Jr(e,hh(e),i)}function io(e,i){return function(o,c){var l=we(o)?bd:jp,p=i?i():{};return l(o,e,he(c,2),p)}}function mn(e){return xe(function(i,o){var c=-1,l=o.length,p=l>1?o[l-1]:r,w=l>2?o[2]:r;for(p=e.length>3&&typeof p=="function"?(l--,p):r,w&&er(o[0],o[1],w)&&(p=l<3?r:p,l=1),i=We(i);++c<l;){var E=o[c];E&&e(i,E,c,p)}return i})}function Xu(e,i){return function(o,c){if(o==null)return o;if(!ur(o))return e(o,c);for(var l=o.length,p=i?l:-1,w=We(o);(i?p--:++p<l)&&c(w[p],p,w)!==!1;);return o}}function Zu(e){return function(i,o,c){for(var l=-1,p=We(i),w=c(i),E=w.length;E--;){var R=w[e?E:++l];if(o(p[R],R,p)===!1)break}return i}}function yg(e,i,o){var c=i&se,l=Gn(e);function p(){var w=this&&this!==Ae&&this instanceof p?l:e;return w.apply(c?o:this,arguments)}return p}function eh(e){return function(i){i=je(i);var o=hn(i)?Lr(i):r,c=o?o[0]:i.charAt(0),l=o?Oi(o,1).join(""):i.slice(1);return c[e]()+l}}function vn(e){return function(i){return ca(Xh(Yh(i).replace(Dn,"")),e,"")}}function Gn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var o=yn(e.prototype),c=e.apply(o,i);return ut(c)?c:o}}function mg(e,i,o){var c=Gn(e);function l(){for(var p=arguments.length,w=D(p),E=p,R=wn(l);E--;)w[E]=arguments[E];var B=p<3&&w[0]!==R&&w[p-1]!==R?[]:Ei(w,R);if(p-=B.length,p<o)return sh(e,i,no,l.placeholder,r,w,B,r,r,o-p);var K=this&&this!==Ae&&this instanceof l?c:e;return Ut(K,this,w)}return l}function th(e){return function(i,o,c){var l=We(i);if(!ur(i)){var p=he(o,3);i=qt(i),o=function(E){return p(l[E],E,l)}}var w=e(i,o,c);return w>-1?l[p?i[w]:w]:r}}function rh(e){return oi(function(i){var o=i.length,c=o,l=Or.prototype.thru;for(e&&i.reverse();c--;){var p=i[c];if(typeof p!="function")throw new Pr(f);if(l&&!w&&co(p)=="wrapper")var w=new Or([],!0)}for(c=w?c:o;++c<o;){p=i[c];var E=co(p),R=E=="wrapper"?ka(p):r;R&&Va(R[0])&&R[1]==(j|F|U|k)&&!R[4].length&&R[9]==1?w=w[co(R[0])].apply(w,R[3]):w=p.length==1&&Va(p)?w[E]():w.thru(p)}return function(){var B=arguments,K=B[0];if(w&&B.length==1&&we(K))return w.plant(K).value();for(var W=0,ee=o?i[W].apply(this,B):K;++W<o;)ee=i[W].call(this,ee);return ee}})}function no(e,i,o,c,l,p,w,E,R,B){var K=i&j,W=i&se,ee=i&le,oe=i&(F|q),fe=i&ue,Ee=ee?r:Gn(e);function de(){for(var Se=arguments.length,Re=D(Se),br=Se;br--;)Re[br]=arguments[br];if(oe)var tr=wn(de),_r=Rd(Re,tr);if(c&&(Re=Qu(Re,c,l,oe)),p&&(Re=Yu(Re,p,w,oe)),Se-=_r,oe&&Se<B){var Et=Ei(Re,tr);return sh(e,i,no,de.placeholder,o,Re,Et,E,R,B-Se)}var Ur=W?o:this,hi=ee?Ur[e]:e;return Se=Re.length,E?Re=jg(Re,E):fe&&Se>1&&Re.reverse(),K&&R<Se&&(Re.length=R),this&&this!==Ae&&this instanceof de&&(hi=Ee||Gn(hi)),hi.apply(Ur,Re)}return de}function ih(e,i){return function(o,c){return Kp(o,e,i(c),{})}}function so(e,i){return function(o,c){var l;if(o===r&&c===r)return i;if(o!==r&&(l=o),c!==r){if(l===r)return c;typeof o=="string"||typeof c=="string"?(o=vr(o),c=vr(c)):(o=ku(o),c=ku(c)),l=e(o,c)}return l}}function Ma(e){return oi(function(i){return i=nt(i,mr(he())),xe(function(o){var c=this;return e(i,function(l){return Ut(l,c,o)})})})}function oo(e,i){i=i===r?" ":vr(i);var o=i.length;if(o<2)return o?Ta(i,e):i;var c=Ta(i,Vs(e/ln(i)));return hn(i)?Oi(Lr(c),0,e).join(""):c.slice(0,e)}function vg(e,i,o,c){var l=i&se,p=Gn(e);function w(){for(var E=-1,R=arguments.length,B=-1,K=c.length,W=D(K+R),ee=this&&this!==Ae&&this instanceof w?p:e;++B<K;)W[B]=c[B];for(;R--;)W[B++]=arguments[++E];return Ut(ee,l?o:this,W)}return w}function nh(e){return function(i,o,c){return c&&typeof c!="number"&&er(i,o,c)&&(o=c=r),i=ui(i),o===r?(o=i,i=0):o=ui(o),c=c===r?i<o?1:-1:ui(c),ig(i,o,c,e)}}function ao(e){return function(i,o){return typeof i=="string"&&typeof o=="string"||(i=Tr(i),o=Tr(o)),e(i,o)}}function sh(e,i,o,c,l,p,w,E,R,B){var K=i&F,W=K?w:r,ee=K?r:w,oe=K?p:r,fe=K?r:p;i|=K?U:x,i&=~(K?x:U),i&C||(i&=~(se|le));var Ee=[e,i,l,oe,W,fe,ee,E,R,B],de=o.apply(r,Ee);return Va(e)&&mh(de,Ee),de.placeholder=c,vh(de,e,i)}function Ua(e){var i=Lt[e];return function(o,c){if(o=Tr(o),c=c==null?0:Gt(be(c),292),c&&vu(o)){var l=(je(o)+"e").split("e"),p=i(l[0]+"e"+(+l[1]+c));return l=(je(p)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(o)}}var wg=pn&&1/Ls(new pn([,-0]))[1]==pe?function(e){return new pn(e)}:ac;function oh(e){return function(i){var o=Wt(i);return o==_e?ga(i):o==Le?Ld(i):Ad(i,e(i))}}function si(e,i,o,c,l,p,w,E){var R=i&le;if(!R&&typeof e!="function")throw new Pr(f);var B=c?c.length:0;if(B||(i&=~(U|x),c=l=r),w=w===r?w:jt(be(w),0),E=E===r?E:be(E),B-=l?l.length:0,i&x){var K=c,W=l;c=l=r}var ee=R?r:ka(e),oe=[e,i,o,c,l,K,W,p,w,E];if(ee&&Dg(oe,ee),e=oe[0],i=oe[1],o=oe[2],c=oe[3],l=oe[4],E=oe[9]=oe[9]===r?R?0:e.length:jt(oe[9]-B,0),!E&&i&(F|q)&&(i&=~(F|q)),!i||i==se)var fe=yg(e,i,o);else i==F||i==q?fe=mg(e,i,E):(i==U||i==(se|U))&&!l.length?fe=vg(e,i,o,c):fe=no.apply(r,oe);var Ee=ee?qu:mh;return vh(Ee(fe,oe),e,i)}function ah(e,i,o,c){return e===r||Mr(e,dn[o])&&!Ue.call(c,o)?i:e}function ch(e,i,o,c,l,p){return ut(e)&&ut(i)&&(p.set(i,e),eo(e,i,r,ch,p),p.delete(i)),e}function bg(e){return Qn(e)?r:e}function uh(e,i,o,c,l,p){var w=o&$,E=e.length,R=i.length;if(E!=R&&!(w&&R>E))return!1;var B=p.get(e),K=p.get(i);if(B&&K)return B==i&&K==e;var W=-1,ee=!0,oe=o&Q?new zi:r;for(p.set(e,i),p.set(i,e);++W<E;){var fe=e[W],Ee=i[W];if(c)var de=w?c(Ee,fe,W,i,e,p):c(fe,Ee,W,e,i,p);if(de!==r){if(de)continue;ee=!1;break}if(oe){if(!ua(i,function(Se,Re){if(!Ln(oe,Re)&&(fe===Se||l(fe,Se,o,c,p)))return oe.push(Re)})){ee=!1;break}}else if(!(fe===Ee||l(fe,Ee,o,c,p))){ee=!1;break}}return p.delete(e),p.delete(i),ee}function _g(e,i,o,c,l,p,w){switch(o){case Be:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case $e:return!(e.byteLength!=i.byteLength||!p(new ks(e),new ks(i)));case L:case T:case Ne:return Mr(+e,+i);case I:return e.name==i.name&&e.message==i.message;case ot:case Ye:return e==i+"";case _e:var E=ga;case Le:var R=c&$;if(E||(E=Ls),e.size!=i.size&&!R)return!1;var B=w.get(e);if(B)return B==i;c|=Q,w.set(e,i);var K=uh(E(e),E(i),c,l,p,w);return w.delete(e),K;case Xe:if(zn)return zn.call(e)==zn.call(i)}return!1}function Eg(e,i,o,c,l,p){var w=o&$,E=qa(e),R=E.length,B=qa(i),K=B.length;if(R!=K&&!w)return!1;for(var W=R;W--;){var ee=E[W];if(!(w?ee in i:Ue.call(i,ee)))return!1}var oe=p.get(e),fe=p.get(i);if(oe&&fe)return oe==i&&fe==e;var Ee=!0;p.set(e,i),p.set(i,e);for(var de=w;++W<R;){ee=E[W];var Se=e[ee],Re=i[ee];if(c)var br=w?c(Re,Se,ee,i,e,p):c(Se,Re,ee,e,i,p);if(!(br===r?Se===Re||l(Se,Re,o,c,p):br)){Ee=!1;break}de||(de=ee=="constructor")}if(Ee&&!de){var tr=e.constructor,_r=i.constructor;tr!=_r&&"constructor"in e&&"constructor"in i&&!(typeof tr=="function"&&tr instanceof tr&&typeof _r=="function"&&_r instanceof _r)&&(Ee=!1)}return p.delete(e),p.delete(i),Ee}function oi(e){return Wa(gh(e,r,xh),e+"")}function qa(e){return Ru(e,qt,Ba)}function za(e){return Ru(e,hr,hh)}var ka=Ws?function(e){return Ws.get(e)}:ac;function co(e){for(var i=e.name+"",o=gn[i],c=Ue.call(gn,i)?o.length:0;c--;){var l=o[c],p=l.func;if(p==null||p==e)return l.name}return i}function wn(e){var i=Ue.call(d,"placeholder")?d:e;return i.placeholder}function he(){var e=d.iteratee||sc;return e=e===sc?Nu:e,arguments.length?e(arguments[0],arguments[1]):e}function uo(e,i){var o=e.__data__;return Cg(i)?o[typeof i=="string"?"string":"hash"]:o.map}function Ha(e){for(var i=qt(e),o=i.length;o--;){var c=i[o],l=e[c];i[o]=[c,l,dh(l)]}return i}function Bi(e,i){var o=$d(e,i);return Tu(o)?o:r}function Ig(e){var i=Ue.call(e,Ui),o=e[Ui];try{e[Ui]=r;var c=!0}catch{}var l=qs.call(e);return c&&(i?e[Ui]=o:delete e[Ui]),l}var Ba=ma?function(e){return e==null?[]:(e=We(e),bi(ma(e),function(i){return yu.call(e,i)}))}:cc,hh=ma?function(e){for(var i=[];e;)_i(i,Ba(e)),e=Hs(e);return i}:cc,Wt=Zt;(va&&Wt(new va(new ArrayBuffer(1)))!=Be||Mn&&Wt(new Mn)!=_e||wa&&Wt(wa.resolve())!=St||pn&&Wt(new pn)!=Le||Un&&Wt(new Un)!=ze)&&(Wt=function(e){var i=Zt(e),o=i==Pe?e.constructor:r,c=o?Ki(o):"";if(c)switch(c){case sp:return Be;case op:return _e;case ap:return St;case cp:return Le;case up:return ze}return i});function xg(e,i,o){for(var c=-1,l=o.length;++c<l;){var p=o[c],w=p.size;switch(p.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=Gt(i,e+w);break;case"takeRight":e=jt(e,i-w);break}}return{start:e,end:i}}function Sg(e){var i=e.match(Qe);return i?i[1].split(Ct):[]}function lh(e,i,o){i=Pi(i,e);for(var c=-1,l=i.length,p=!1;++c<l;){var w=Qr(i[c]);if(!(p=e!=null&&o(e,w)))break;e=e[w]}return p||++c!=l?p:(l=e==null?0:e.length,!!l&&mo(l)&&ai(w,l)&&(we(e)||Vi(e)))}function Pg(e){var i=e.length,o=new e.constructor(i);return i&&typeof e[0]=="string"&&Ue.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function fh(e){return typeof e.constructor=="function"&&!Wn(e)?yn(Hs(e)):{}}function Og(e,i,o){var c=e.constructor;switch(i){case $e:return ja(e);case L:case T:return new c(+e);case Be:return hg(e,o);case ht:case Me:case Pt:case Ft:case Ht:case Bt:case Mt:case Qt:case or:return Wu(e,o);case _e:return new c;case Ne:case Ye:return new c(e);case ot:return lg(e);case Le:return new c;case Xe:return fg(e)}}function Ag(e,i){var o=i.length;if(!o)return e;var c=o-1;return i[c]=(o>1?"& ":"")+i[c],i=i.join(o>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+i+`] */
`)}function Rg(e){return we(e)||Vi(e)||!!(mu&&e&&e[mu])}function ai(e,i){var o=typeof e;return i=i??Y,!!i&&(o=="number"||o!="symbol"&&Go.test(e))&&e>-1&&e%1==0&&e<i}function er(e,i,o){if(!ut(o))return!1;var c=typeof i;return(c=="number"?ur(o)&&ai(i,o.length):c=="string"&&i in o)?Mr(o[i],e):!1}function Ka(e,i){if(we(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||wr(e)?!0:Ot.test(e)||!it.test(e)||i!=null&&e in We(i)}function Cg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Va(e){var i=co(e),o=d[i];if(typeof o!="function"||!(i in Oe.prototype))return!1;if(e===o)return!0;var c=ka(o);return!!c&&e===c[0]}function Tg(e){return!!du&&du in e}var Ng=Ms?ci:uc;function Wn(e){var i=e&&e.constructor,o=typeof i=="function"&&i.prototype||dn;return e===o}function dh(e){return e===e&&!ut(e)}function ph(e,i){return function(o){return o==null?!1:o[e]===i&&(i!==r||e in We(o))}}function $g(e){var i=go(e,function(c){return o.size===y&&o.clear(),c}),o=i.cache;return i}function Dg(e,i){var o=e[1],c=i[1],l=o|c,p=l<(se|le|j),w=c==j&&o==F||c==j&&o==k&&e[7].length<=i[8]||c==(j|k)&&i[7].length<=i[8]&&o==F;if(!(p||w))return e;c&se&&(e[2]=i[2],l|=o&se?0:C);var E=i[3];if(E){var R=e[3];e[3]=R?Qu(R,E,i[4]):E,e[4]=R?Ei(e[3],_):i[4]}return E=i[5],E&&(R=e[5],e[5]=R?Yu(R,E,i[6]):E,e[6]=R?Ei(e[5],_):i[6]),E=i[7],E&&(e[7]=E),c&j&&(e[8]=e[8]==null?i[8]:Gt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function Fg(e){var i=[];if(e!=null)for(var o in We(e))i.push(o);return i}function Lg(e){return qs.call(e)}function gh(e,i,o){return i=jt(i===r?e.length-1:i,0),function(){for(var c=arguments,l=-1,p=jt(c.length-i,0),w=D(p);++l<p;)w[l]=c[i+l];l=-1;for(var E=D(i+1);++l<i;)E[l]=c[l];return E[i]=o(w),Ut(e,this,E)}}function yh(e,i){return i.length<2?e:Hi(e,Rr(i,0,-1))}function jg(e,i){for(var o=e.length,c=Gt(i.length,o),l=cr(e);c--;){var p=i[c];e[c]=ai(p,o)?l[p]:r}return e}function Ga(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var mh=wh(qu),Jn=Xd||function(e,i){return Ae.setTimeout(e,i)},Wa=wh(og);function vh(e,i,o){var c=i+"";return Wa(e,Ag(c,Mg(Sg(c),o)))}function wh(e){var i=0,o=0;return function(){var c=rp(),l=qe-(c-o);if(o=c,l>0){if(++i>=Te)return arguments[0]}else i=0;return e.apply(r,arguments)}}function ho(e,i){var o=-1,c=e.length,l=c-1;for(i=i===r?c:i;++o<i;){var p=Ca(o,l),w=e[p];e[p]=e[o],e[o]=w}return e.length=i,e}var bh=$g(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(At,function(o,c,l,p){i.push(l?p.replace(zo,"$1"):c||o)}),i});function Qr(e){if(typeof e=="string"||wr(e))return e;var i=e+"";return i=="0"&&1/e==-pe?"-0":i}function Ki(e){if(e!=null){try{return Us.call(e)}catch{}try{return e+""}catch{}}return""}function Mg(e,i){return Sr(Br,function(o){var c="_."+o[0];i&o[1]&&!Ds(e,c)&&e.push(c)}),e.sort()}function _h(e){if(e instanceof Oe)return e.clone();var i=new Or(e.__wrapped__,e.__chain__);return i.__actions__=cr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Ug(e,i,o){(o?er(e,i,o):i===r)?i=1:i=jt(be(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,p=0,w=D(Vs(c/i));l<c;)w[p++]=Rr(e,l,l+=i);return w}function qg(e){for(var i=-1,o=e==null?0:e.length,c=0,l=[];++i<o;){var p=e[i];p&&(l[c++]=p)}return l}function zg(){var e=arguments.length;if(!e)return[];for(var i=D(e-1),o=arguments[0],c=e;c--;)i[c-1]=arguments[c];return _i(we(o)?cr(o):[o],Kt(i,1))}var kg=xe(function(e,i){return _t(e)?Hn(e,Kt(i,1,_t,!0)):[]}),Hg=xe(function(e,i){var o=Cr(i);return _t(o)&&(o=r),_t(e)?Hn(e,Kt(i,1,_t,!0),he(o,2)):[]}),Bg=xe(function(e,i){var o=Cr(i);return _t(o)&&(o=r),_t(e)?Hn(e,Kt(i,1,_t,!0),r,o):[]});function Kg(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:be(i),Rr(e,i<0?0:i,c)):[]}function Vg(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:be(i),i=c-i,Rr(e,0,i<0?0:i)):[]}function Gg(e,i){return e&&e.length?ro(e,he(i,3),!0,!0):[]}function Wg(e,i){return e&&e.length?ro(e,he(i,3),!0):[]}function Jg(e,i,o,c){var l=e==null?0:e.length;return l?(o&&typeof o!="number"&&er(e,i,o)&&(o=0,c=l),zp(e,i,o,c)):[]}function Eh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=o==null?0:be(o);return l<0&&(l=jt(c+l,0)),Fs(e,he(i,3),l)}function Ih(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return o!==r&&(l=be(o),l=o<0?jt(c+l,0):Gt(l,c-1)),Fs(e,he(i,3),l,!0)}function xh(e){var i=e==null?0:e.length;return i?Kt(e,1):[]}function Qg(e){var i=e==null?0:e.length;return i?Kt(e,pe):[]}function Yg(e,i){var o=e==null?0:e.length;return o?(i=i===r?1:be(i),Kt(e,i)):[]}function Xg(e){for(var i=-1,o=e==null?0:e.length,c={};++i<o;){var l=e[i];c[l[0]]=l[1]}return c}function Sh(e){return e&&e.length?e[0]:r}function Zg(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=o==null?0:be(o);return l<0&&(l=jt(c+l,0)),un(e,i,l)}function ey(e){var i=e==null?0:e.length;return i?Rr(e,0,-1):[]}var ty=xe(function(e){var i=nt(e,Fa);return i.length&&i[0]===e[0]?Sa(i):[]}),ry=xe(function(e){var i=Cr(e),o=nt(e,Fa);return i===Cr(o)?i=r:o.pop(),o.length&&o[0]===e[0]?Sa(o,he(i,2)):[]}),iy=xe(function(e){var i=Cr(e),o=nt(e,Fa);return i=typeof i=="function"?i:r,i&&o.pop(),o.length&&o[0]===e[0]?Sa(o,r,i):[]});function ny(e,i){return e==null?"":ep.call(e,i)}function Cr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function sy(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=c;return o!==r&&(l=be(o),l=l<0?jt(c+l,0):Gt(l,c-1)),i===i?Md(e,i,l):Fs(e,su,l,!0)}function oy(e,i){return e&&e.length?Lu(e,be(i)):r}var ay=xe(Ph);function Ph(e,i){return e&&e.length&&i&&i.length?Ra(e,i):e}function cy(e,i,o){return e&&e.length&&i&&i.length?Ra(e,i,he(o,2)):e}function uy(e,i,o){return e&&e.length&&i&&i.length?Ra(e,i,r,o):e}var hy=oi(function(e,i){var o=e==null?0:e.length,c=_a(e,i);return Uu(e,nt(i,function(l){return ai(l,o)?+l:l}).sort(Ju)),c});function ly(e,i){var o=[];if(!(e&&e.length))return o;var c=-1,l=[],p=e.length;for(i=he(i,3);++c<p;){var w=e[c];i(w,c,e)&&(o.push(w),l.push(c))}return Uu(e,l),o}function Ja(e){return e==null?e:np.call(e)}function fy(e,i,o){var c=e==null?0:e.length;return c?(o&&typeof o!="number"&&er(e,i,o)?(i=0,o=c):(i=i==null?0:be(i),o=o===r?c:be(o)),Rr(e,i,o)):[]}function dy(e,i){return to(e,i)}function py(e,i,o){return Na(e,i,he(o,2))}function gy(e,i){var o=e==null?0:e.length;if(o){var c=to(e,i);if(c<o&&Mr(e[c],i))return c}return-1}function yy(e,i){return to(e,i,!0)}function my(e,i,o){return Na(e,i,he(o,2),!0)}function vy(e,i){var o=e==null?0:e.length;if(o){var c=to(e,i,!0)-1;if(Mr(e[c],i))return c}return-1}function wy(e){return e&&e.length?zu(e):[]}function by(e,i){return e&&e.length?zu(e,he(i,2)):[]}function _y(e){var i=e==null?0:e.length;return i?Rr(e,1,i):[]}function Ey(e,i,o){return e&&e.length?(i=o||i===r?1:be(i),Rr(e,0,i<0?0:i)):[]}function Iy(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:be(i),i=c-i,Rr(e,i<0?0:i,c)):[]}function xy(e,i){return e&&e.length?ro(e,he(i,3),!1,!0):[]}function Sy(e,i){return e&&e.length?ro(e,he(i,3)):[]}var Py=xe(function(e){return Si(Kt(e,1,_t,!0))}),Oy=xe(function(e){var i=Cr(e);return _t(i)&&(i=r),Si(Kt(e,1,_t,!0),he(i,2))}),Ay=xe(function(e){var i=Cr(e);return i=typeof i=="function"?i:r,Si(Kt(e,1,_t,!0),r,i)});function Ry(e){return e&&e.length?Si(e):[]}function Cy(e,i){return e&&e.length?Si(e,he(i,2)):[]}function Ty(e,i){return i=typeof i=="function"?i:r,e&&e.length?Si(e,r,i):[]}function Qa(e){if(!(e&&e.length))return[];var i=0;return e=bi(e,function(o){if(_t(o))return i=jt(o.length,i),!0}),da(i,function(o){return nt(e,ha(o))})}function Oh(e,i){if(!(e&&e.length))return[];var o=Qa(e);return i==null?o:nt(o,function(c){return Ut(i,r,c)})}var Ny=xe(function(e,i){return _t(e)?Hn(e,i):[]}),$y=xe(function(e){return Da(bi(e,_t))}),Dy=xe(function(e){var i=Cr(e);return _t(i)&&(i=r),Da(bi(e,_t),he(i,2))}),Fy=xe(function(e){var i=Cr(e);return i=typeof i=="function"?i:r,Da(bi(e,_t),r,i)}),Ly=xe(Qa);function jy(e,i){return Ku(e||[],i||[],kn)}function My(e,i){return Ku(e||[],i||[],Vn)}var Uy=xe(function(e){var i=e.length,o=i>1?e[i-1]:r;return o=typeof o=="function"?(e.pop(),o):r,Oh(e,o)});function Ah(e){var i=d(e);return i.__chain__=!0,i}function qy(e,i){return i(e),e}function lo(e,i){return i(e)}var zy=oi(function(e){var i=e.length,o=i?e[0]:0,c=this.__wrapped__,l=function(p){return _a(p,e)};return i>1||this.__actions__.length||!(c instanceof Oe)||!ai(o)?this.thru(l):(c=c.slice(o,+o+(i?1:0)),c.__actions__.push({func:lo,args:[l],thisArg:r}),new Or(c,this.__chain__).thru(function(p){return i&&!p.length&&p.push(r),p}))});function ky(){return Ah(this)}function Hy(){return new Or(this.value(),this.__chain__)}function By(){this.__values__===r&&(this.__values__=kh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Ky(){return this}function Vy(e){for(var i,o=this;o instanceof Qs;){var c=_h(o);c.__index__=0,c.__values__=r,i?l.__wrapped__=c:i=c;var l=c;o=o.__wrapped__}return l.__wrapped__=e,i}function Gy(){var e=this.__wrapped__;if(e instanceof Oe){var i=e;return this.__actions__.length&&(i=new Oe(this)),i=i.reverse(),i.__actions__.push({func:lo,args:[Ja],thisArg:r}),new Or(i,this.__chain__)}return this.thru(Ja)}function Wy(){return Bu(this.__wrapped__,this.__actions__)}var Jy=io(function(e,i,o){Ue.call(e,o)?++e[o]:ni(e,o,1)});function Qy(e,i,o){var c=we(e)?iu:qp;return o&&er(e,i,o)&&(i=r),c(e,he(i,3))}function Yy(e,i){var o=we(e)?bi:Ou;return o(e,he(i,3))}var Xy=th(Eh),Zy=th(Ih);function em(e,i){return Kt(fo(e,i),1)}function tm(e,i){return Kt(fo(e,i),pe)}function rm(e,i,o){return o=o===r?1:be(o),Kt(fo(e,i),o)}function Rh(e,i){var o=we(e)?Sr:xi;return o(e,he(i,3))}function Ch(e,i){var o=we(e)?_d:Pu;return o(e,he(i,3))}var im=io(function(e,i,o){Ue.call(e,o)?e[o].push(i):ni(e,o,[i])});function nm(e,i,o,c){e=ur(e)?e:_n(e),o=o&&!c?be(o):0;var l=e.length;return o<0&&(o=jt(l+o,0)),vo(e)?o<=l&&e.indexOf(i,o)>-1:!!l&&un(e,i,o)>-1}var sm=xe(function(e,i,o){var c=-1,l=typeof i=="function",p=ur(e)?D(e.length):[];return xi(e,function(w){p[++c]=l?Ut(i,w,o):Bn(w,i,o)}),p}),om=io(function(e,i,o){ni(e,o,i)});function fo(e,i){var o=we(e)?nt:$u;return o(e,he(i,3))}function am(e,i,o,c){return e==null?[]:(we(i)||(i=i==null?[]:[i]),o=c?r:o,we(o)||(o=o==null?[]:[o]),ju(e,i,o))}var cm=io(function(e,i,o){e[o?0:1].push(i)},function(){return[[],[]]});function um(e,i,o){var c=we(e)?ca:au,l=arguments.length<3;return c(e,he(i,4),o,l,xi)}function hm(e,i,o){var c=we(e)?Ed:au,l=arguments.length<3;return c(e,he(i,4),o,l,Pu)}function lm(e,i){var o=we(e)?bi:Ou;return o(e,yo(he(i,3)))}function fm(e){var i=we(e)?Eu:ng;return i(e)}function dm(e,i,o){(o?er(e,i,o):i===r)?i=1:i=be(i);var c=we(e)?Fp:sg;return c(e,i)}function pm(e){var i=we(e)?Lp:ag;return i(e)}function gm(e){if(e==null)return 0;if(ur(e))return vo(e)?ln(e):e.length;var i=Wt(e);return i==_e||i==Le?e.size:Oa(e).length}function ym(e,i,o){var c=we(e)?ua:cg;return o&&er(e,i,o)&&(i=r),c(e,he(i,3))}var mm=xe(function(e,i){if(e==null)return[];var o=i.length;return o>1&&er(e,i[0],i[1])?i=[]:o>2&&er(i[0],i[1],i[2])&&(i=[i[0]]),ju(e,Kt(i,1),[])}),po=Yd||function(){return Ae.Date.now()};function vm(e,i){if(typeof i!="function")throw new Pr(f);return e=be(e),function(){if(--e<1)return i.apply(this,arguments)}}function Th(e,i,o){return i=o?r:i,i=e&&i==null?e.length:i,si(e,j,r,r,r,r,i)}function Nh(e,i){var o;if(typeof i!="function")throw new Pr(f);return e=be(e),function(){return--e>0&&(o=i.apply(this,arguments)),e<=1&&(i=r),o}}var Ya=xe(function(e,i,o){var c=se;if(o.length){var l=Ei(o,wn(Ya));c|=U}return si(e,c,i,o,l)}),$h=xe(function(e,i,o){var c=se|le;if(o.length){var l=Ei(o,wn($h));c|=U}return si(i,c,e,o,l)});function Dh(e,i,o){i=o?r:i;var c=si(e,F,r,r,r,r,r,i);return c.placeholder=Dh.placeholder,c}function Fh(e,i,o){i=o?r:i;var c=si(e,q,r,r,r,r,r,i);return c.placeholder=Fh.placeholder,c}function Lh(e,i,o){var c,l,p,w,E,R,B=0,K=!1,W=!1,ee=!0;if(typeof e!="function")throw new Pr(f);i=Tr(i)||0,ut(o)&&(K=!!o.leading,W="maxWait"in o,p=W?jt(Tr(o.maxWait)||0,i):p,ee="trailing"in o?!!o.trailing:ee);function oe(Et){var Ur=c,hi=l;return c=l=r,B=Et,w=e.apply(hi,Ur),w}function fe(Et){return B=Et,E=Jn(Se,i),K?oe(Et):w}function Ee(Et){var Ur=Et-R,hi=Et-B,tl=i-Ur;return W?Gt(tl,p-hi):tl}function de(Et){var Ur=Et-R,hi=Et-B;return R===r||Ur>=i||Ur<0||W&&hi>=p}function Se(){var Et=po();if(de(Et))return Re(Et);E=Jn(Se,Ee(Et))}function Re(Et){return E=r,ee&&c?oe(Et):(c=l=r,w)}function br(){E!==r&&Vu(E),B=0,c=R=l=E=r}function tr(){return E===r?w:Re(po())}function _r(){var Et=po(),Ur=de(Et);if(c=arguments,l=this,R=Et,Ur){if(E===r)return fe(R);if(W)return Vu(E),E=Jn(Se,i),oe(R)}return E===r&&(E=Jn(Se,i)),w}return _r.cancel=br,_r.flush=tr,_r}var wm=xe(function(e,i){return Su(e,1,i)}),bm=xe(function(e,i,o){return Su(e,Tr(i)||0,o)});function _m(e){return si(e,ue)}function go(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Pr(f);var o=function(){var c=arguments,l=i?i.apply(this,c):c[0],p=o.cache;if(p.has(l))return p.get(l);var w=e.apply(this,c);return o.cache=p.set(l,w)||p,w};return o.cache=new(go.Cache||ii),o}go.Cache=ii;function yo(e){if(typeof e!="function")throw new Pr(f);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Em(e){return Nh(2,e)}var Im=ug(function(e,i){i=i.length==1&&we(i[0])?nt(i[0],mr(he())):nt(Kt(i,1),mr(he()));var o=i.length;return xe(function(c){for(var l=-1,p=Gt(c.length,o);++l<p;)c[l]=i[l].call(this,c[l]);return Ut(e,this,c)})}),Xa=xe(function(e,i){var o=Ei(i,wn(Xa));return si(e,U,r,i,o)}),jh=xe(function(e,i){var o=Ei(i,wn(jh));return si(e,x,r,i,o)}),xm=oi(function(e,i){return si(e,k,r,r,r,i)});function Sm(e,i){if(typeof e!="function")throw new Pr(f);return i=i===r?i:be(i),xe(e,i)}function Pm(e,i){if(typeof e!="function")throw new Pr(f);return i=i==null?0:jt(be(i),0),xe(function(o){var c=o[i],l=Oi(o,0,i);return c&&_i(l,c),Ut(e,this,l)})}function Om(e,i,o){var c=!0,l=!0;if(typeof e!="function")throw new Pr(f);return ut(o)&&(c="leading"in o?!!o.leading:c,l="trailing"in o?!!o.trailing:l),Lh(e,i,{leading:c,maxWait:i,trailing:l})}function Am(e){return Th(e,1)}function Rm(e,i){return Xa(La(i),e)}function Cm(){if(!arguments.length)return[];var e=arguments[0];return we(e)?e:[e]}function Tm(e){return Ar(e,H)}function Nm(e,i){return i=typeof i=="function"?i:r,Ar(e,H,i)}function $m(e){return Ar(e,P|H)}function Dm(e,i){return i=typeof i=="function"?i:r,Ar(e,P|H,i)}function Fm(e,i){return i==null||xu(e,i,qt(i))}function Mr(e,i){return e===i||e!==e&&i!==i}var Lm=ao(xa),jm=ao(function(e,i){return e>=i}),Vi=Cu(function(){return arguments}())?Cu:function(e){return mt(e)&&Ue.call(e,"callee")&&!yu.call(e,"callee")},we=D.isArray,Mm=Xt?mr(Xt):Vp;function ur(e){return e!=null&&mo(e.length)&&!ci(e)}function _t(e){return mt(e)&&ur(e)}function Um(e){return e===!0||e===!1||mt(e)&&Zt(e)==L}var Ai=Zd||uc,qm=Fr?mr(Fr):Gp;function zm(e){return mt(e)&&e.nodeType===1&&!Qn(e)}function km(e){if(e==null)return!0;if(ur(e)&&(we(e)||typeof e=="string"||typeof e.splice=="function"||Ai(e)||bn(e)||Vi(e)))return!e.length;var i=Wt(e);if(i==_e||i==Le)return!e.size;if(Wn(e))return!Oa(e).length;for(var o in e)if(Ue.call(e,o))return!1;return!0}function Hm(e,i){return Kn(e,i)}function Bm(e,i,o){o=typeof o=="function"?o:r;var c=o?o(e,i):r;return c===r?Kn(e,i,r,o):!!c}function Za(e){if(!mt(e))return!1;var i=Zt(e);return i==I||i==u||typeof e.message=="string"&&typeof e.name=="string"&&!Qn(e)}function Km(e){return typeof e=="number"&&vu(e)}function ci(e){if(!ut(e))return!1;var i=Zt(e);return i==ne||i==ye||i==M||i==vt}function Mh(e){return typeof e=="number"&&e==be(e)}function mo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Y}function ut(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function mt(e){return e!=null&&typeof e=="object"}var Uh=xr?mr(xr):Jp;function Vm(e,i){return e===i||Pa(e,i,Ha(i))}function Gm(e,i,o){return o=typeof o=="function"?o:r,Pa(e,i,Ha(i),o)}function Wm(e){return qh(e)&&e!=+e}function Jm(e){if(Ng(e))throw new me(h);return Tu(e)}function Qm(e){return e===null}function Ym(e){return e==null}function qh(e){return typeof e=="number"||mt(e)&&Zt(e)==Ne}function Qn(e){if(!mt(e)||Zt(e)!=Pe)return!1;var i=Hs(e);if(i===null)return!0;var o=Ue.call(i,"constructor")&&i.constructor;return typeof o=="function"&&o instanceof o&&Us.call(o)==Gd}var ec=Gr?mr(Gr):Qp;function Xm(e){return Mh(e)&&e>=-Y&&e<=Y}var zh=Fn?mr(Fn):Yp;function vo(e){return typeof e=="string"||!we(e)&&mt(e)&&Zt(e)==Ye}function wr(e){return typeof e=="symbol"||mt(e)&&Zt(e)==Xe}var bn=Mi?mr(Mi):Xp;function Zm(e){return e===r}function ev(e){return mt(e)&&Wt(e)==ze}function tv(e){return mt(e)&&Zt(e)==Ze}var rv=ao(Aa),iv=ao(function(e,i){return e<=i});function kh(e){if(!e)return[];if(ur(e))return vo(e)?Lr(e):cr(e);if(jn&&e[jn])return Fd(e[jn]());var i=Wt(e),o=i==_e?ga:i==Le?Ls:_n;return o(e)}function ui(e){if(!e)return e===0?e:0;if(e=Tr(e),e===pe||e===-pe){var i=e<0?-1:1;return i*G}return e===e?e:0}function be(e){var i=ui(e),o=i%1;return i===i?o?i-o:i:0}function Hh(e){return e?ki(be(e),0,X):0}function Tr(e){if(typeof e=="number")return e;if(wr(e))return J;if(ut(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ut(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=cu(e);var o=Bo.test(e);return o||Vo.test(e)?ve(e.slice(2),o?2:8):Ho.test(e)?J:+e}function Bh(e){return Jr(e,hr(e))}function nv(e){return e?ki(be(e),-Y,Y):e===0?e:0}function je(e){return e==null?"":vr(e)}var sv=mn(function(e,i){if(Wn(i)||ur(i)){Jr(i,qt(i),e);return}for(var o in i)Ue.call(i,o)&&kn(e,o,i[o])}),Kh=mn(function(e,i){Jr(i,hr(i),e)}),wo=mn(function(e,i,o,c){Jr(i,hr(i),e,c)}),ov=mn(function(e,i,o,c){Jr(i,qt(i),e,c)}),av=oi(_a);function cv(e,i){var o=yn(e);return i==null?o:Iu(o,i)}var uv=xe(function(e,i){e=We(e);var o=-1,c=i.length,l=c>2?i[2]:r;for(l&&er(i[0],i[1],l)&&(c=1);++o<c;)for(var p=i[o],w=hr(p),E=-1,R=w.length;++E<R;){var B=w[E],K=e[B];(K===r||Mr(K,dn[B])&&!Ue.call(e,B))&&(e[B]=p[B])}return e}),hv=xe(function(e){return e.push(r,ch),Ut(Vh,r,e)});function lv(e,i){return nu(e,he(i,3),Wr)}function fv(e,i){return nu(e,he(i,3),Ia)}function dv(e,i){return e==null?e:Ea(e,he(i,3),hr)}function pv(e,i){return e==null?e:Au(e,he(i,3),hr)}function gv(e,i){return e&&Wr(e,he(i,3))}function yv(e,i){return e&&Ia(e,he(i,3))}function mv(e){return e==null?[]:Zs(e,qt(e))}function vv(e){return e==null?[]:Zs(e,hr(e))}function tc(e,i,o){var c=e==null?r:Hi(e,i);return c===r?o:c}function wv(e,i){return e!=null&&lh(e,i,kp)}function rc(e,i){return e!=null&&lh(e,i,Hp)}var bv=ih(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=qs.call(i)),e[i]=o},nc(lr)),_v=ih(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=qs.call(i)),Ue.call(e,i)?e[i].push(o):e[i]=[o]},he),Ev=xe(Bn);function qt(e){return ur(e)?_u(e):Oa(e)}function hr(e){return ur(e)?_u(e,!0):Zp(e)}function Iv(e,i){var o={};return i=he(i,3),Wr(e,function(c,l,p){ni(o,i(c,l,p),c)}),o}function xv(e,i){var o={};return i=he(i,3),Wr(e,function(c,l,p){ni(o,l,i(c,l,p))}),o}var Sv=mn(function(e,i,o){eo(e,i,o)}),Vh=mn(function(e,i,o,c){eo(e,i,o,c)}),Pv=oi(function(e,i){var o={};if(e==null)return o;var c=!1;i=nt(i,function(p){return p=Pi(p,e),c||(c=p.length>1),p}),Jr(e,za(e),o),c&&(o=Ar(o,P|N|H,bg));for(var l=i.length;l--;)$a(o,i[l]);return o});function Ov(e,i){return Gh(e,yo(he(i)))}var Av=oi(function(e,i){return e==null?{}:tg(e,i)});function Gh(e,i){if(e==null)return{};var o=nt(za(e),function(c){return[c]});return i=he(i),Mu(e,o,function(c,l){return i(c,l[0])})}function Rv(e,i,o){i=Pi(i,e);var c=-1,l=i.length;for(l||(l=1,e=r);++c<l;){var p=e==null?r:e[Qr(i[c])];p===r&&(c=l,p=o),e=ci(p)?p.call(e):p}return e}function Cv(e,i,o){return e==null?e:Vn(e,i,o)}function Tv(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:Vn(e,i,o,c)}var Wh=oh(qt),Jh=oh(hr);function Nv(e,i,o){var c=we(e),l=c||Ai(e)||bn(e);if(i=he(i,4),o==null){var p=e&&e.constructor;l?o=c?new p:[]:ut(e)?o=ci(p)?yn(Hs(e)):{}:o={}}return(l?Sr:Wr)(e,function(w,E,R){return i(o,w,E,R)}),o}function $v(e,i){return e==null?!0:$a(e,i)}function Dv(e,i,o){return e==null?e:Hu(e,i,La(o))}function Fv(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:Hu(e,i,La(o),c)}function _n(e){return e==null?[]:pa(e,qt(e))}function Lv(e){return e==null?[]:pa(e,hr(e))}function jv(e,i,o){return o===r&&(o=i,i=r),o!==r&&(o=Tr(o),o=o===o?o:0),i!==r&&(i=Tr(i),i=i===i?i:0),ki(Tr(e),i,o)}function Mv(e,i,o){return i=ui(i),o===r?(o=i,i=0):o=ui(o),e=Tr(e),Bp(e,i,o)}function Uv(e,i,o){if(o&&typeof o!="boolean"&&er(e,i,o)&&(i=o=r),o===r&&(typeof i=="boolean"?(o=i,i=r):typeof e=="boolean"&&(o=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ui(e),i===r?(i=e,e=0):i=ui(i)),e>i){var c=e;e=i,i=c}if(o||e%1||i%1){var l=wu();return Gt(e+l*(i-e+Ve("1e-"+((l+"").length-1))),i)}return Ca(e,i)}var qv=vn(function(e,i,o){return i=i.toLowerCase(),e+(o?Qh(i):i)});function Qh(e){return ic(je(e).toLowerCase())}function Yh(e){return e=je(e),e&&e.replace(ei,Cd).replace(sa,"")}function zv(e,i,o){e=je(e),i=vr(i);var c=e.length;o=o===r?c:ki(be(o),0,c);var l=o;return o-=i.length,o>=0&&e.slice(o,l)==i}function kv(e){return e=je(e),e&&rt.test(e)?e.replace($i,Td):e}function Hv(e){return e=je(e),e&&Rt.test(e)?e.replace(pt,"\\$&"):e}var Bv=vn(function(e,i,o){return e+(o?"-":"")+i.toLowerCase()}),Kv=vn(function(e,i,o){return e+(o?" ":"")+i.toLowerCase()}),Vv=eh("toLowerCase");function Gv(e,i,o){e=je(e),i=be(i);var c=i?ln(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return oo(Gs(l),o)+e+oo(Vs(l),o)}function Wv(e,i,o){e=je(e),i=be(i);var c=i?ln(e):0;return i&&c<i?e+oo(i-c,o):e}function Jv(e,i,o){e=je(e),i=be(i);var c=i?ln(e):0;return i&&c<i?oo(i-c,o)+e:e}function Qv(e,i,o){return o||i==null?i=0:i&&(i=+i),ip(je(e).replace(gt,""),i||0)}function Yv(e,i,o){return(o?er(e,i,o):i===r)?i=1:i=be(i),Ta(je(e),i)}function Xv(){var e=arguments,i=je(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Zv=vn(function(e,i,o){return e+(o?"_":"")+i.toLowerCase()});function e0(e,i,o){return o&&typeof o!="number"&&er(e,i,o)&&(i=o=r),o=o===r?X:o>>>0,o?(e=je(e),e&&(typeof i=="string"||i!=null&&!ec(i))&&(i=vr(i),!i&&hn(e))?Oi(Lr(e),0,o):e.split(i,o)):[]}var t0=vn(function(e,i,o){return e+(o?" ":"")+ic(i)});function r0(e,i,o){return e=je(e),o=o==null?0:ki(be(o),0,e.length),i=vr(i),e.slice(o,o+i.length)==i}function i0(e,i,o){var c=d.templateSettings;o&&er(e,i,o)&&(i=r),e=je(e),i=wo({},i,c,ah);var l=wo({},i.imports,c.imports,ah),p=qt(l),w=pa(l,p),E,R,B=0,K=i.interpolate||tn,W="__p += '",ee=ya((i.escape||tn).source+"|"+K.source+"|"+(K===ct?ko:tn).source+"|"+(i.evaluate||tn).source+"|$","g"),oe="//# sourceURL="+(Ue.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++oa+"]")+`
`;e.replace(ee,function(de,Se,Re,br,tr,_r){return Re||(Re=br),W+=e.slice(B,_r).replace(Wo,Nd),Se&&(E=!0,W+=`' +
__e(`+Se+`) +
'`),tr&&(R=!0,W+=`';
`+tr+`;
__p += '`),Re&&(W+=`' +
((__t = (`+Re+`)) == null ? '' : __t) +
'`),B=_r+de.length,de}),W+=`';
`;var fe=Ue.call(i,"variable")&&i.variable;if(!fe)W=`with (obj) {
`+W+`
}
`;else if(qo.test(fe))throw new me(g);W=(R?W.replace(Kr,""):W).replace(Yt,"$1").replace(Zr,"$1;"),W="function("+(fe||"obj")+`) {
`+(fe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(E?", __e = _.escape":"")+(R?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+W+`return __p
}`;var Ee=Zh(function(){return Fe(p,oe+"return "+W).apply(r,w)});if(Ee.source=W,Za(Ee))throw Ee;return Ee}function n0(e){return je(e).toLowerCase()}function s0(e){return je(e).toUpperCase()}function o0(e,i,o){if(e=je(e),e&&(o||i===r))return cu(e);if(!e||!(i=vr(i)))return e;var c=Lr(e),l=Lr(i),p=uu(c,l),w=hu(c,l)+1;return Oi(c,p,w).join("")}function a0(e,i,o){if(e=je(e),e&&(o||i===r))return e.slice(0,fu(e)+1);if(!e||!(i=vr(i)))return e;var c=Lr(e),l=hu(c,Lr(i))+1;return Oi(c,0,l).join("")}function c0(e,i,o){if(e=je(e),e&&(o||i===r))return e.replace(gt,"");if(!e||!(i=vr(i)))return e;var c=Lr(e),l=uu(c,Lr(i));return Oi(c,l).join("")}function u0(e,i){var o=ae,c=ge;if(ut(i)){var l="separator"in i?i.separator:l;o="length"in i?be(i.length):o,c="omission"in i?vr(i.omission):c}e=je(e);var p=e.length;if(hn(e)){var w=Lr(e);p=w.length}if(o>=p)return e;var E=o-ln(c);if(E<1)return c;var R=w?Oi(w,0,E).join(""):e.slice(0,E);if(l===r)return R+c;if(w&&(E+=R.length-E),ec(l)){if(e.slice(E).search(l)){var B,K=R;for(l.global||(l=ya(l.source,je(Ir.exec(l))+"g")),l.lastIndex=0;B=l.exec(K);)var W=B.index;R=R.slice(0,W===r?E:W)}}else if(e.indexOf(vr(l),E)!=E){var ee=R.lastIndexOf(l);ee>-1&&(R=R.slice(0,ee))}return R+c}function h0(e){return e=je(e),e&&lt.test(e)?e.replace(vi,Ud):e}var l0=vn(function(e,i,o){return e+(o?" ":"")+i.toUpperCase()}),ic=eh("toUpperCase");function Xh(e,i,o){return e=je(e),i=o?r:i,i===r?Dd(e)?kd(e):Sd(e):e.match(i)||[]}var Zh=xe(function(e,i){try{return Ut(e,r,i)}catch(o){return Za(o)?o:new me(o)}}),f0=oi(function(e,i){return Sr(i,function(o){o=Qr(o),ni(e,o,Ya(e[o],e))}),e});function d0(e){var i=e==null?0:e.length,o=he();return e=i?nt(e,function(c){if(typeof c[1]!="function")throw new Pr(f);return[o(c[0]),c[1]]}):[],xe(function(c){for(var l=-1;++l<i;){var p=e[l];if(Ut(p[0],this,c))return Ut(p[1],this,c)}})}function p0(e){return Up(Ar(e,P))}function nc(e){return function(){return e}}function g0(e,i){return e==null||e!==e?i:e}var y0=rh(),m0=rh(!0);function lr(e){return e}function sc(e){return Nu(typeof e=="function"?e:Ar(e,P))}function v0(e){return Du(Ar(e,P))}function w0(e,i){return Fu(e,Ar(i,P))}var b0=xe(function(e,i){return function(o){return Bn(o,e,i)}}),_0=xe(function(e,i){return function(o){return Bn(e,o,i)}});function oc(e,i,o){var c=qt(i),l=Zs(i,c);o==null&&!(ut(i)&&(l.length||!c.length))&&(o=i,i=e,e=this,l=Zs(i,qt(i)));var p=!(ut(o)&&"chain"in o)||!!o.chain,w=ci(e);return Sr(l,function(E){var R=i[E];e[E]=R,w&&(e.prototype[E]=function(){var B=this.__chain__;if(p||B){var K=e(this.__wrapped__),W=K.__actions__=cr(this.__actions__);return W.push({func:R,args:arguments,thisArg:e}),K.__chain__=B,K}return R.apply(e,_i([this.value()],arguments))})}),e}function E0(){return Ae._===this&&(Ae._=Wd),this}function ac(){}function I0(e){return e=be(e),xe(function(i){return Lu(i,e)})}var x0=Ma(nt),S0=Ma(iu),P0=Ma(ua);function el(e){return Ka(e)?ha(Qr(e)):rg(e)}function O0(e){return function(i){return e==null?r:Hi(e,i)}}var A0=nh(),R0=nh(!0);function cc(){return[]}function uc(){return!1}function C0(){return{}}function T0(){return""}function N0(){return!0}function $0(e,i){if(e=be(e),e<1||e>Y)return[];var o=X,c=Gt(e,X);i=he(i),e-=X;for(var l=da(c,i);++o<e;)i(o);return l}function D0(e){return we(e)?nt(e,Qr):wr(e)?[e]:cr(bh(je(e)))}function F0(e){var i=++Vd;return je(e)+i}var L0=so(function(e,i){return e+i},0),j0=Ua("ceil"),M0=so(function(e,i){return e/i},1),U0=Ua("floor");function q0(e){return e&&e.length?Xs(e,lr,xa):r}function z0(e,i){return e&&e.length?Xs(e,he(i,2),xa):r}function k0(e){return ou(e,lr)}function H0(e,i){return ou(e,he(i,2))}function B0(e){return e&&e.length?Xs(e,lr,Aa):r}function K0(e,i){return e&&e.length?Xs(e,he(i,2),Aa):r}var V0=so(function(e,i){return e*i},1),G0=Ua("round"),W0=so(function(e,i){return e-i},0);function J0(e){return e&&e.length?fa(e,lr):0}function Q0(e,i){return e&&e.length?fa(e,he(i,2)):0}return d.after=vm,d.ary=Th,d.assign=sv,d.assignIn=Kh,d.assignInWith=wo,d.assignWith=ov,d.at=av,d.before=Nh,d.bind=Ya,d.bindAll=f0,d.bindKey=$h,d.castArray=Cm,d.chain=Ah,d.chunk=Ug,d.compact=qg,d.concat=zg,d.cond=d0,d.conforms=p0,d.constant=nc,d.countBy=Jy,d.create=cv,d.curry=Dh,d.curryRight=Fh,d.debounce=Lh,d.defaults=uv,d.defaultsDeep=hv,d.defer=wm,d.delay=bm,d.difference=kg,d.differenceBy=Hg,d.differenceWith=Bg,d.drop=Kg,d.dropRight=Vg,d.dropRightWhile=Gg,d.dropWhile=Wg,d.fill=Jg,d.filter=Yy,d.flatMap=em,d.flatMapDeep=tm,d.flatMapDepth=rm,d.flatten=xh,d.flattenDeep=Qg,d.flattenDepth=Yg,d.flip=_m,d.flow=y0,d.flowRight=m0,d.fromPairs=Xg,d.functions=mv,d.functionsIn=vv,d.groupBy=im,d.initial=ey,d.intersection=ty,d.intersectionBy=ry,d.intersectionWith=iy,d.invert=bv,d.invertBy=_v,d.invokeMap=sm,d.iteratee=sc,d.keyBy=om,d.keys=qt,d.keysIn=hr,d.map=fo,d.mapKeys=Iv,d.mapValues=xv,d.matches=v0,d.matchesProperty=w0,d.memoize=go,d.merge=Sv,d.mergeWith=Vh,d.method=b0,d.methodOf=_0,d.mixin=oc,d.negate=yo,d.nthArg=I0,d.omit=Pv,d.omitBy=Ov,d.once=Em,d.orderBy=am,d.over=x0,d.overArgs=Im,d.overEvery=S0,d.overSome=P0,d.partial=Xa,d.partialRight=jh,d.partition=cm,d.pick=Av,d.pickBy=Gh,d.property=el,d.propertyOf=O0,d.pull=ay,d.pullAll=Ph,d.pullAllBy=cy,d.pullAllWith=uy,d.pullAt=hy,d.range=A0,d.rangeRight=R0,d.rearg=xm,d.reject=lm,d.remove=ly,d.rest=Sm,d.reverse=Ja,d.sampleSize=dm,d.set=Cv,d.setWith=Tv,d.shuffle=pm,d.slice=fy,d.sortBy=mm,d.sortedUniq=wy,d.sortedUniqBy=by,d.split=e0,d.spread=Pm,d.tail=_y,d.take=Ey,d.takeRight=Iy,d.takeRightWhile=xy,d.takeWhile=Sy,d.tap=qy,d.throttle=Om,d.thru=lo,d.toArray=kh,d.toPairs=Wh,d.toPairsIn=Jh,d.toPath=D0,d.toPlainObject=Bh,d.transform=Nv,d.unary=Am,d.union=Py,d.unionBy=Oy,d.unionWith=Ay,d.uniq=Ry,d.uniqBy=Cy,d.uniqWith=Ty,d.unset=$v,d.unzip=Qa,d.unzipWith=Oh,d.update=Dv,d.updateWith=Fv,d.values=_n,d.valuesIn=Lv,d.without=Ny,d.words=Xh,d.wrap=Rm,d.xor=$y,d.xorBy=Dy,d.xorWith=Fy,d.zip=Ly,d.zipObject=jy,d.zipObjectDeep=My,d.zipWith=Uy,d.entries=Wh,d.entriesIn=Jh,d.extend=Kh,d.extendWith=wo,oc(d,d),d.add=L0,d.attempt=Zh,d.camelCase=qv,d.capitalize=Qh,d.ceil=j0,d.clamp=jv,d.clone=Tm,d.cloneDeep=$m,d.cloneDeepWith=Dm,d.cloneWith=Nm,d.conformsTo=Fm,d.deburr=Yh,d.defaultTo=g0,d.divide=M0,d.endsWith=zv,d.eq=Mr,d.escape=kv,d.escapeRegExp=Hv,d.every=Qy,d.find=Xy,d.findIndex=Eh,d.findKey=lv,d.findLast=Zy,d.findLastIndex=Ih,d.findLastKey=fv,d.floor=U0,d.forEach=Rh,d.forEachRight=Ch,d.forIn=dv,d.forInRight=pv,d.forOwn=gv,d.forOwnRight=yv,d.get=tc,d.gt=Lm,d.gte=jm,d.has=wv,d.hasIn=rc,d.head=Sh,d.identity=lr,d.includes=nm,d.indexOf=Zg,d.inRange=Mv,d.invoke=Ev,d.isArguments=Vi,d.isArray=we,d.isArrayBuffer=Mm,d.isArrayLike=ur,d.isArrayLikeObject=_t,d.isBoolean=Um,d.isBuffer=Ai,d.isDate=qm,d.isElement=zm,d.isEmpty=km,d.isEqual=Hm,d.isEqualWith=Bm,d.isError=Za,d.isFinite=Km,d.isFunction=ci,d.isInteger=Mh,d.isLength=mo,d.isMap=Uh,d.isMatch=Vm,d.isMatchWith=Gm,d.isNaN=Wm,d.isNative=Jm,d.isNil=Ym,d.isNull=Qm,d.isNumber=qh,d.isObject=ut,d.isObjectLike=mt,d.isPlainObject=Qn,d.isRegExp=ec,d.isSafeInteger=Xm,d.isSet=zh,d.isString=vo,d.isSymbol=wr,d.isTypedArray=bn,d.isUndefined=Zm,d.isWeakMap=ev,d.isWeakSet=tv,d.join=ny,d.kebabCase=Bv,d.last=Cr,d.lastIndexOf=sy,d.lowerCase=Kv,d.lowerFirst=Vv,d.lt=rv,d.lte=iv,d.max=q0,d.maxBy=z0,d.mean=k0,d.meanBy=H0,d.min=B0,d.minBy=K0,d.stubArray=cc,d.stubFalse=uc,d.stubObject=C0,d.stubString=T0,d.stubTrue=N0,d.multiply=V0,d.nth=oy,d.noConflict=E0,d.noop=ac,d.now=po,d.pad=Gv,d.padEnd=Wv,d.padStart=Jv,d.parseInt=Qv,d.random=Uv,d.reduce=um,d.reduceRight=hm,d.repeat=Yv,d.replace=Xv,d.result=Rv,d.round=G0,d.runInContext=A,d.sample=fm,d.size=gm,d.snakeCase=Zv,d.some=ym,d.sortedIndex=dy,d.sortedIndexBy=py,d.sortedIndexOf=gy,d.sortedLastIndex=yy,d.sortedLastIndexBy=my,d.sortedLastIndexOf=vy,d.startCase=t0,d.startsWith=r0,d.subtract=W0,d.sum=J0,d.sumBy=Q0,d.template=i0,d.times=$0,d.toFinite=ui,d.toInteger=be,d.toLength=Hh,d.toLower=n0,d.toNumber=Tr,d.toSafeInteger=nv,d.toString=je,d.toUpper=s0,d.trim=o0,d.trimEnd=a0,d.trimStart=c0,d.truncate=u0,d.unescape=h0,d.uniqueId=F0,d.upperCase=l0,d.upperFirst=ic,d.each=Rh,d.eachRight=Ch,d.first=Sh,oc(d,function(){var e={};return Wr(d,function(i,o){Ue.call(d.prototype,o)||(e[o]=i)}),e}(),{chain:!1}),d.VERSION=n,Sr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),Sr(["drop","take"],function(e,i){Oe.prototype[e]=function(o){o=o===r?1:jt(be(o),0);var c=this.__filtered__&&!i?new Oe(this):this.clone();return c.__filtered__?c.__takeCount__=Gt(o,c.__takeCount__):c.__views__.push({size:Gt(o,X),type:e+(c.__dir__<0?"Right":"")}),c},Oe.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),Sr(["filter","map","takeWhile"],function(e,i){var o=i+1,c=o==v||o==re;Oe.prototype[e]=function(l){var p=this.clone();return p.__iteratees__.push({iteratee:he(l,3),type:o}),p.__filtered__=p.__filtered__||c,p}}),Sr(["head","last"],function(e,i){var o="take"+(i?"Right":"");Oe.prototype[e]=function(){return this[o](1).value()[0]}}),Sr(["initial","tail"],function(e,i){var o="drop"+(i?"":"Right");Oe.prototype[e]=function(){return this.__filtered__?new Oe(this):this[o](1)}}),Oe.prototype.compact=function(){return this.filter(lr)},Oe.prototype.find=function(e){return this.filter(e).head()},Oe.prototype.findLast=function(e){return this.reverse().find(e)},Oe.prototype.invokeMap=xe(function(e,i){return typeof e=="function"?new Oe(this):this.map(function(o){return Bn(o,e,i)})}),Oe.prototype.reject=function(e){return this.filter(yo(he(e)))},Oe.prototype.slice=function(e,i){e=be(e);var o=this;return o.__filtered__&&(e>0||i<0)?new Oe(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),i!==r&&(i=be(i),o=i<0?o.dropRight(-i):o.take(i-e)),o)},Oe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Oe.prototype.toArray=function(){return this.take(X)},Wr(Oe.prototype,function(e,i){var o=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=d[c?"take"+(i=="last"?"Right":""):i],p=c||/^find/.test(i);l&&(d.prototype[i]=function(){var w=this.__wrapped__,E=c?[1]:arguments,R=w instanceof Oe,B=E[0],K=R||we(w),W=function(Se){var Re=l.apply(d,_i([Se],E));return c&&ee?Re[0]:Re};K&&o&&typeof B=="function"&&B.length!=1&&(R=K=!1);var ee=this.__chain__,oe=!!this.__actions__.length,fe=p&&!ee,Ee=R&&!oe;if(!p&&K){w=Ee?w:new Oe(this);var de=e.apply(w,E);return de.__actions__.push({func:lo,args:[W],thisArg:r}),new Or(de,ee)}return fe&&Ee?e.apply(this,E):(de=this.thru(W),fe?c?de.value()[0]:de.value():de)})}),Sr(["pop","push","shift","sort","splice","unshift"],function(e){var i=js[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var p=this.value();return i.apply(we(p)?p:[],l)}return this[o](function(w){return i.apply(we(w)?w:[],l)})}}),Wr(Oe.prototype,function(e,i){var o=d[i];if(o){var c=o.name+"";Ue.call(gn,c)||(gn[c]=[]),gn[c].push({name:i,func:o})}}),gn[no(r,le).name]=[{name:"wrapper",func:r}],Oe.prototype.clone=hp,Oe.prototype.reverse=lp,Oe.prototype.value=fp,d.prototype.at=zy,d.prototype.chain=ky,d.prototype.commit=Hy,d.prototype.next=By,d.prototype.plant=Vy,d.prototype.reverse=Gy,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=Wy,d.prototype.first=d.prototype.head,jn&&(d.prototype[jn]=Ky),d},fn=Hd();bt?((bt.exports=fn)._=fn,Ge._=fn):Ae._=fn}).call(is)})(jc,jc.exports);var gx=Object.defineProperty,yx=Object.defineProperties,mx=Object.getOwnPropertyDescriptors,pf=Object.getOwnPropertySymbols,vx=Object.prototype.hasOwnProperty,wx=Object.prototype.propertyIsEnumerable,gf=(s,t,r)=>t in s?gx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,xo=(s,t)=>{for(var r in t||(t={}))vx.call(t,r)&&gf(s,r,t[r]);if(pf)for(var r of pf(t))wx.call(t,r)&&gf(s,r,t[r]);return s},bx=(s,t)=>yx(s,mx(t));function Ti(s,t,r){var n;const a=x1(s);return((n=t.rpcMap)==null?void 0:n[a.reference])||`${px}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function en(s){return s.includes(":")?s.split(":")[1]:s}function vd(s){return s.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function _x(s,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(s));if(!r.length)return[];const n=[];return r.forEach(a=>{const h=t.namespaces[a].accounts;n.push(...h)}),n}function Ex(s={},t={}){const r=yf(s),n=yf(t);return jc.exports.merge(r,n)}function yf(s){var t,r,n,a;const h={};if(!Sn(s))return h;for(const[f,g]of Object.entries(s)){const b=Kc(f)?[f]:g.chains,y=g.methods||[],_=g.events||[],P=g.rpcMap||{},N=ns(f);h[N]=bx(xo(xo({},h[N]),g),{chains:hc(b,(t=h[N])==null?void 0:t.chains),methods:hc(y,(r=h[N])==null?void 0:r.methods),events:hc(_,(n=h[N])==null?void 0:n.events),rpcMap:xo(xo({},P),(a=h[N])==null?void 0:a.rpcMap)})}return h}function Ix(s){return s.includes(":")?s.split(":")[2]:s}function xx(s){const t={};for(const[r,n]of Object.entries(s)){const a=n.methods||[],h=n.events||[],f=n.accounts||[],g=Kc(r)?[r]:n.chains?n.chains:vd(n.accounts);t[r]={chains:g,methods:a,events:h,accounts:f}}return t}function Ic(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):s.includes(":")?Number(s.split(":")[1]):Number(s)}const wd={},st=s=>wd[s],xc=(s,t)=>{wd[s]=t};class Sx{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=en(r);t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Ti(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new yi(new Ni(n,st("disableProviderPing")))}}class Px{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const n=r||Ti(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new yi(new Ni(n,st("disableProviderPing")))}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=parseInt(en(r));t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,n;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const h=parseInt(a,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class Ox{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=en(r);t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Ti(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new yi(new Ni(n,st("disableProviderPing")))}}class Ax{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=en(r);t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Ti(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new yi(new Ni(n,st("disableProviderPing")))}}class Rx{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),a=en(r);t[a]=this.createHttpProvider(a,n)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||this.getCardanoRPCUrl(t);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new yi(new Ni(n,st("disableProviderPing")))}}class Cx{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=en(r);t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Ti(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new yi(new Ni(n,st("disableProviderPing")))}}class Tx{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=en(r);t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Ti(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new yi(new Ni(n,st("disableProviderPing")))}}class Nx{constructor(t){this.name="near",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const n=r||Ti(`${this.name}:${t}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,n)}this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;t[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Ti(t,this.namespace);return typeof n>"u"?void 0:new yi(new Ni(n,st("disableProviderPing")))}}var $x=Object.defineProperty,Dx=Object.defineProperties,Fx=Object.getOwnPropertyDescriptors,mf=Object.getOwnPropertySymbols,Lx=Object.prototype.hasOwnProperty,jx=Object.prototype.propertyIsEnumerable,vf=(s,t,r)=>t in s?$x(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,So=(s,t)=>{for(var r in t||(t={}))Lx.call(t,r)&&vf(s,r,t[r]);if(mf)for(var r of mf(t))jx.call(t,r)&&vf(s,r,t[r]);return s},Sc=(s,t)=>Dx(s,Fx(t));class tu{constructor(t){this.events=new zc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||ff})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new tu(t);return await r.initialize(),r}async request(t,r){const[n,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:So({},t),chainId:`${n}:${a}`,topic:this.session.topic})}sendAsync(t,r,n){this.request(t,n).then(a=>r(null,a)).catch(a=>r(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:It("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await a().then(h=>{this.session=h,this.namespaces||(this.namespaces=xx(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==yd)throw h;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[n,a]=this.validateChain(t);this.getProvider(n).setDefaultChain(a,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Xr(r)){for(const n of r)t.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ax.init({logger:this.providerOpts.logger||ff,relayUrl:this.providerOpts.relayUrl||lx,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>ns(r)))];xc("client",this.client),xc("events",this.events),xc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const n=_x(r,this.session),a=vd(n),h=Ex(this.namespaces,this.optionalNamespaces),f=Sc(So({},h[r]),{accounts:n,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new Px({namespace:f});break;case"solana":this.rpcProviders[r]=new Ox({namespace:f});break;case"cosmos":this.rpcProviders[r]=new Ax({namespace:f});break;case"polkadot":this.rpcProviders[r]=new Sx({namespace:f});break;case"cip34":this.rpcProviders[r]=new Rx({namespace:f});break;case"elrond":this.rpcProviders[r]=new Cx({namespace:f});break;case"multiversx":this.rpcProviders[r]=new Tx({namespace:f});break;case"near":this.rpcProviders[r]=new Nx({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:n}=r;if(n.name==="accountsChanged"){const a=n.data;a&&Xr(a)&&this.events.emit("accountsChanged",a.map(Ix))}else if(n.name==="chainChanged"){const a=r.chainId,h=r.event.data,f=ns(a),g=Ic(a)!==Ic(h)?`${f}:${Ic(h)}`:a;this.onChainChanged(g)}else this.events.emit(n.name,n.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var n;const{namespaces:a}=r,h=(n=this.client)==null?void 0:n.session.get(t);this.session=Sc(So({},h),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",Sc(So({},It("USER_DISCONNECTED")),{data:t.topic}))}),this.on(mi.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:n,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(t){const[r,n]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(f=>ns(f)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const a=ns(Object.keys(this.namespaces)[0]),h=this.rpcProviders[a].getDefaultChain();return[a,h]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var n;if(!this.namespaces)return;const[a,h]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(h),((n=this.namespaces[a])!=null?n:this.namespaces[`${a}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${df}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${df}/${t}`)}}const Mx=tu,Ux="wc",qx="ethereum_provider",zx=`${Ux}@2:${qx}:`,kx="https://rpc.walletconnect.com/v1/",Mc=["eth_sendTransaction","personal_sign"],Hx=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Uc=["chainChanged","accountsChanged"],Bx=["chainChanged","accountsChanged","message","disconnect","connect"];var Kx=Object.defineProperty,Vx=Object.defineProperties,Gx=Object.getOwnPropertyDescriptors,wf=Object.getOwnPropertySymbols,Wx=Object.prototype.hasOwnProperty,Jx=Object.prototype.propertyIsEnumerable,bf=(s,t,r)=>t in s?Kx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,os=(s,t)=>{for(var r in t||(t={}))Wx.call(t,r)&&bf(s,r,t[r]);if(wf)for(var r of wf(t))Jx.call(t,r)&&bf(s,r,t[r]);return s},_f=(s,t)=>Vx(s,Gx(t));function Do(s){return Number(s[0].split(":")[1])}function Pc(s){return`0x${s.toString(16)}`}function Qx(s){const{chains:t,optionalChains:r,methods:n,optionalMethods:a,events:h,optionalEvents:f,rpcMap:g}=s;if(!Xr(t))throw new Error("Invalid chains");const b={chains:t,methods:n||Mc,events:h||Uc,rpcMap:os({},t.length?{[Do(t)]:g[Do(t)]}:{})},y=h==null?void 0:h.filter(H=>!Uc.includes(H)),_=n==null?void 0:n.filter(H=>!Mc.includes(H));if(!r&&!f&&!a&&!(y!=null&&y.length)&&!(_!=null&&_.length))return{required:t.length?b:void 0};const P=(y==null?void 0:y.length)&&(_==null?void 0:_.length)||!r,N={chains:[...new Set(P?b.chains.concat(r||[]):r)],methods:[...new Set(b.methods.concat(a!=null&&a.length?a:Hx))],events:[...new Set(b.events.concat(f!=null&&f.length?f:Bx))],rpcMap:g};return{required:t.length?b:void 0,optional:r.length?N:void 0}}class ru{constructor(){this.events=new $r.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=zx,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new ru;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:n}=Qx(this.rpc);try{const a=await new Promise(async(f,g)=>{var b;this.rpc.showQrModal&&((b=this.modal)==null||b.subscribeModal(y=>{!y.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(_f(os({namespaces:os({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(y=>{f(y)}).catch(y=>{g(new Error(y.message))})});if(!a)return;const h=S1(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:Pc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Pc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",_f(os({},It("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Pc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,n,a]=t.split(":");return{chainId:`${r}:${n}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,n;const a=(r=t==null?void 0:t.chains)!=null?r:[],h=(n=t==null?void 0:t.optionalChains)!=null?n:[],f=a.concat(h);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?(t==null?void 0:t.methods)||Mc:[],b=a.length?(t==null?void 0:t.events)||Uc:[],y=(t==null?void 0:t.optionalMethods)||[],_=(t==null?void 0:t.optionalEvents)||[],P=(t==null?void 0:t.rpcMap)||this.buildRpcMap(f,t.projectId),N=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(H=>this.formatChainId(H)),optionalChains:h.map(H=>this.formatChainId(H)),methods:g,events:b,optionalMethods:y,optionalEvents:_,rpcMap:P,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:N,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const n={};return t.forEach(a=>{n[a]=this.getRpcUrl(a,r)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Do(this.rpc.chains):Do(this.rpc.optionalChains),this.signer=await Mx.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await c1(()=>import("./index-c0f51a4b.js").then(a=>a.i),["assets/index-c0f51a4b.js","assets/index-1959a7a0.js","assets/index-e972a045.css"]);r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(os({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:n,rpcMap:a}=t;r&&Xr(r)&&(this.rpc.chains=r.map(h=>this.formatChainId(h)),r.forEach(h=>{this.rpc.rpcMap[h]=(a==null?void 0:a[h])||this.getRpcUrl(h)})),n&&Xr(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(h=>this.formatChainId(h)),n.forEach(h=>{this.rpc.rpcMap[h]=(a==null?void 0:a[h])||this.getRpcUrl(h)}))}getRpcUrl(t,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[t])||`${kx}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const pS=ru;export{pS as EthereumProvider,Bx as OPTIONAL_EVENTS,Hx as OPTIONAL_METHODS,Uc as REQUIRED_EVENTS,Mc as REQUIRED_METHODS,ru as default};
